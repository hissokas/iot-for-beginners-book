<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="keywords" content="IoT, ESP8266, IoTs, WoT">
<meta name="author" content="Tuan PM">
<meta name="copyright" content="@2017 Tuan PM">
<title>Internet Of Things (IoT) : for beginners</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>Internet Of Things (IoT) : for beginners</h1>
<div class="details">
<span id="author" class="author">Tuan PM</span><br>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Internet Of Things (IoT)</strong> –  <strong>The Internet of Things</strong> seems to be in the forefront of a modern, civilized world. It&#8217;s a scenario where everything can be connected via the wireless Internet. Businesses are increasingly adopting IoT technology into production because of the potential market for innovation and lower production costs.</p>
</div>
<div class="paragraph">
<p>Seeing the fast-paced development of IoT technology products and the potential start-up technology market, this book provides IoT content with a coherence, fact, towards young people who have been and want to focus their energies on the Internet of Things. Desire to create unique products, creative, increasingly perfect and synchronized to meet the needs of life.</p>
</div>
<div class="paragraph">
<p>The content is designed essentially to give students an overview of system construction, equipment production and easy access to the IoT.</p>
</div>
<div class="sect2">
<h3 id="_about_author">About author</h3>
<div class="paragraph">
<p>The author of book is a Mr. <a href="https://twitter.com/tuanpmt">Phạm Minh Tuấn</a>(<a href="https://github.com/tuanpmt">TuanPM</a>), he has many years of experience working in the IoT and developing the open source library for the community. He wants to share a little of his knowledge to the development very potential this industry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_terminology_used">Terminology used</h3>
<div class="ulist">
<ul>
<li>
<p><code>IoT</code> - Internet Of Things.</p>
</li>
<li>
<p><code>ESP8266</code> - Wi-Fi microcontroller.</p>
</li>
<li>
<p><code>Git</code> - version control system .</p>
</li>
<li>
<p><code>Github</code> - A social network for developer based on Git.</p>
</li>
<li>
<p><code>IDE</code> -  Integrated Development Enviroment.</p>
</li>
<li>
<p><code>Compiler</code> - A software program that transforms high-level source code that is written by a developer in a high-level programming language into a low level object code (binary code) in machine language.</p>
</li>
<li>
<p><code>Logic Level</code> - The voltage level for the chip to understand (1 or 0).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_explain_the_source_code">Explain the source code</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void setup()
{
    //comment <i class="conum" data-value="1"></i><b>(1)</b>
    int a = 1;
    a ++; <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line explains this as a comment.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This line explains the variable <code>a</code> which adds 1 unit.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_contents">Introduction to contents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The contents of this book include detailed instructions for IoT application developers using the popular WiFi chip ESP8266, to connect to the server, send and receive data, and execute commands from the server. Internet Of Things depends on the Internet connection, so the content is also focused on protocols, management methods as well as connection configuration.</p>
</div>
<div class="paragraph">
<p>The main hardware used is System On Chip (SoC). <strong> ESP8266 </strong> - WiFi and programmable with cheap price and popular in the world. The circuit board used is the hardware open. <a href="https://github.com/iotmakervn/iot-wifi-uno-hw">IoT WiFi Uno</a>  has a legacy mapping board compatible with Arduino Uno.</p>
</div>
<div class="paragraph">
<p>The software used on the computer for the ESP8266 chip is <a href="https://arduino.cc"><strong>Arduino</strong></a>, the <code>C/C++</code> programming language.</p>
</div>
<div class="paragraph">
<p>The parts related to Server running on the computer use <a href="https://nodejs.org">NodeJS</a> and <code>Javascript</code> programming.</p>
</div>
<div class="paragraph">
<p>In addition, you will need to learn some of the tools and concepts that are frequently used in this book:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Git</strong> - is a version control system for tracking changes in computer files and coordinating work on those files among multiple people, <strong>Github</strong> is a social network for developer based on Git. Git helps you manage source code, group work, merge operations, source code history &#8230;&#8203; Probably in the process of working with this book, you will need to use open source libraries for Arduino from Github, so the installation and use of the tool is quite necessary for that. It will help you manage the source code and project more and more professional.</p>
</li>
<li>
<p><strong>Sublime Text</strong> - A popular, fast, lightweight and feature rich editÚe Use for programming. Javascript (NodeJS)</p>
</li>
<li>
<p>Code formater - Used to format the source code, easy to read, easy to repair.</p>
</li>
<li>
<p>Editorconfig - An additional tool for the Editor, which helps to synchronize standards such as Indent, Align, Space &#8230;&#8203; to ensure that code is opened in the Editor is not changed.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the official hardware is hardware open <a href="https://github.com/iotmakervn/iot-wifi-uno-hw">IoT WiFi Uno</a>, but you can use any board ESP8266 on the market for this book, eg: <code>NODEMCU</code>,` Wemos`, &#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The content in this book focuses on protocol guidance, how to work with systems using ESP8266, Server &#8230;&#8203;, and sample projects.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All Code sections do not explain the API details for each feature. Instead, it is provided in the Appendix Cheat Sheet (Arduino and C).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_who_can_use">Who can use?</h3>
<div class="ulist">
<ul>
<li>
<p>Software developers / Mobile App, Web App &#8230;&#8203;the person who wants to participate as <code>IoT</code> products.</p>
</li>
<li>
<p>Students want to improve their skills and additional knowledge.</p>
</li>
<li>
<p>Individuals want to make their own products for life, serving the work.</p>
</li>
<li>
<p>Startup Tech does not specialize in hardware or software.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_target_of_this_book">Target of this book</h3>
<div class="ulist">
<ul>
<li>
<p>Help for non-hardware approach to make the product easy IoT.</p>
</li>
<li>
<p>Can be integrated system development for IoT products.</p>
</li>
<li>
<p>Understanding the process of creating hardware products, go into the production of equipment.</p>
</li>
<li>
<p>Avoid unnecessary errors when developing and designing the system.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_preparation">Preparation</h3>
<div class="ulist">
<ul>
<li>
<p>You need a programmable ESP8266 board, it is best to use a board that is compatible with the Arduino IDE (which has modules for the chip).</p>
</li>
<li>
<p>There should be additional modules such as sensors, motors to practice, a set of StarterKit is suitable.</p>
</li>
<li>
<p>1 personal computer (Windows, MacOS or Linux).</p>
</li>
<li>
<p>C &amp; Arduino ESP8266 Cheatsheet (Contents at the end of this book).</p>
</li>
</ul>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Content</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_about_author">About author</a></li>
<li><a href="#_terminology_used">Terminology used</a></li>
<li><a href="#_explain_the_source_code">Explain the source code</a></li>
</ul>
</li>
<li><a href="#_introduction_to_contents">Introduction to contents</a>
<ul class="sectlevel2">
<li><a href="#_who_can_use">Who can use?</a></li>
<li><a href="#_target_of_this_book">Target of this book</a></li>
<li><a href="#_preparation">Preparation</a></li>
</ul>
</li>
<li><a href="#_getting_started">Basic knowledge</a>
<ul class="sectlevel1">
<li><a href="#_internet_of_things_iot">Internet Of Things (IoT)</a>
<ul class="sectlevel2">
<li><a href="#_what_is_internet_of_things_iot">What is Internet of Things (IoT)?</a></li>
<li><a href="#_internet_of_things_iot_system">Internet of Things(IoT) system</a></li>
<li><a href="#_real_world_applications_of_internet_of_things">Real World Applications of Internet of Things</a></li>
</ul>
</li>
<li><a href="#_esp8266">ESP8266</a>
<ul class="sectlevel2">
<li><a href="#_pin_mapping">Pin mapping</a></li>
<li><a href="#_hardware_description">Hardware description</a></li>
<li><a href="#_officially_supported_sdk">Officially supported SDK</a></li>
<li><a href="#_esp8285">ESP8285</a></li>
<li><a href="#_module_and_development_board">Module and development board</a></li>
<li><a href="#_esp8266_development_board">ESP8266 development board</a></li>
</ul>
</li>
<li><a href="#_what_is_arduino">What is Arduino?</a>
<ul class="sectlevel2">
<li><a href="#_some_of_arduino_s_features">Some of Arduino&#8217;s features</a></li>
<li><a href="#_benefits_of_using_arduino">Benefits of using Arduino</a></li>
<li><a href="#_arduino_community_around_the_world">Arduino community around the world</a></li>
<li><a href="#_arduino_for_esp8266_esp8266_wifi_uno_board">Arduino for ESP8266 &amp; ESP8266 WiFi Uno Board</a></li>
</ul>
</li>
<li><a href="#_node_js">Node.js</a>
<ul class="sectlevel2">
<li><a href="#_why_we_use_node_js_in_this_book">Why we use Node.js in this book</a></li>
<li><a href="#_does_this_book_teach_node_js">Does this book teach Node.js ?</a></li>
</ul>
</li>
<li><a href="#_sublime_text">Sublime Text</a></li>
<li><a href="#_installation_and_preparation_requirements">Installation and Preparation Requirements</a>
<ul class="sectlevel2">
<li><a href="#_arduino_ide">Arduino IDE</a></li>
<li><a href="#install-library">Install arduino library</a></li>
<li><a href="#_usb_cdc_driver">USB CDC driver.</a></li>
<li><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></li>
<li><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></li>
<li><a href="#export-binary">export firmware binary in Arduino IDE</a></li>
<li><a href="#_serial_terminal">Serial Terminal</a></li>
<li><a href="#_node_js_2">Node.js</a></li>
<li><a href="#_sublime_text_2">Sublime Text</a></li>
<li><a href="#_git">Git</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_hello_world">Hello World</a>
<ul class="sectlevel1">
<li><a href="#_led_blinking">LED Blinking</a>
<ul class="sectlevel2">
<li><a href="#_knowledge">Knowledge</a></li>
<li><a href="#_wiring">Wiring</a></li>
<li><a href="#_source_code_for_blinking_using_delay">Source code for blinking using Delay</a></li>
<li><a href="#_source_code_for_blinking_using_timer">Source code for blinking using timer</a></li>
<li><a href="#_digital_io">Digital IO</a></li>
<li><a href="#_summary_2">Summary</a></li>
<li><a href="#_knowledge_2">Knowledge</a></li>
<li><a href="#_source_code_using_polling">Source code using polling</a></li>
<li><a href="#_source_code_using_interrupt">Source code using interrupt</a></li>
<li><a href="#_some_concepts">Some concepts</a></li>
</ul>
</li>
<li><a href="#_oled">OLED</a>
<ul class="sectlevel2">
<li><a href="#_oled_display">OLED display</a></li>
<li><a href="#_ssd1306_oled_display">SSD1306 OLED display</a></li>
<li><a href="#_i2c_interface">I2C interface</a></li>
<li><a href="#_oled_display_with_esp8266">OLED Display with ESP8266</a></li>
</ul>
</li>
<li><a href="#_summary_3">Summary</a></li>
</ul>
</li>
<li><a href="#_wifi">ESP8266 WiFi</a>
<ul class="sectlevel1">
<li><a href="#_wifi_station_mode">WiFi Station Mode</a>
<ul class="sectlevel2">
<li><a href="#_knownledge">Knownledge</a></li>
<li><a href="#_connecting_to_a_local_network">Connecting to a local network</a></li>
<li><a href="#_using_wifimulti">Using WiFiMulti</a></li>
</ul>
</li>
<li><a href="#_http_client">HTTP Client</a>
<ul class="sectlevel2">
<li><a href="#_http_protocol">HTTP Protocol</a></li>
<li><a href="#_json">JSON</a></li>
<li><a href="#_bitcoin_value_monitoring_application">Bitcoin value monitoring application</a></li>
</ul>
</li>
<li><a href="#_wifi_access_point_mode">WiFi Access Point Mode</a>
<ul class="sectlevel2">
<li><a href="#_esp8266_in_access_point_mode">ESP8266 in Access Point Mode</a></li>
<li><a href="#_establish_wifi_network_using_esp8266">Establish WiFi network using ESP8266</a></li>
</ul>
</li>
<li><a href="#web-server">Web Server</a>
<ul class="sectlevel2">
<li><a href="#_what_is_web_server">What is Web Server?</a></li>
<li><a href="#_html_javascript_css">HTML - Javascript - CSS</a></li>
<li><a href="#_controlling_a_led_using_webserver">Controlling a LED using WebServer</a></li>
<li><a href="#_esp8266_web_server">ESP8266 Web Server</a></li>
<li><a href="#_combining_wifi_api_and_web_server">Combining WiFi API and Web Server</a></li>
</ul>
</li>
<li><a href="#_data_exchange_between_2_esp8266">Data exchange between 2 ESP8266</a>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_procedure">Procedure</a></li>
<li><a href="#_code">Code</a></li>
</ul>
</li>
<li><a href="#_summary_4">Summary</a></li>
</ul>
</li>
<li><a href="#_DHT11_logger">Temperature and Humidity Monitor using DHT11, ESP8266 and Node.js server</a>
<ul class="sectlevel1">
<li><a href="#_the_project_diagram">The Project Diagram</a>
<ul class="sectlevel2">
<li><a href="#_requirements_2">Requirements</a></li>
<li><a href="#_project_analysis">Project Analysis</a></li>
<li><a href="#_project_related_knowledge">Project-related Knowledge</a></li>
<li><a href="#_building_the_project">Building the Project:</a></li>
</ul>
</li>
<li><a href="#server-nodejs">Server Nodejs</a></li>
<li><a href="#_code_on_esp8266">Code on ESP8266</a>
<ul class="sectlevel2">
<li><a href="#_preparation_2">Preparation:</a></li>
</ul>
</li>
<li><a href="#_extending_your_application">Extending your application</a>
<ul class="sectlevel2">
<li><a href="#_esp8266_web_server_2">ESP8266 Web Server</a></li>
</ul>
</li>
<li><a href="#_summary_5">Summary</a></li>
</ul>
</li>
<li><a href="#_wifi_config">WiFi configuration on ESP8266</a>
<ul class="sectlevel1">
<li><a href="#_smartconfig">Smartconfig</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_running_smartconfig_on_esp8266">Running SmartConfig on ESP8266</a></li>
<li><a href="#_code_2">Code</a></li>
</ul>
</li>
<li><a href="#_wps">WPS</a>
<ul class="sectlevel2">
<li><a href="#_what_is_wps">What is WPS?</a></li>
<li><a href="#_connect_to_wifi_network_on_esp8266_using_wps">Connect to WiFi network on ESP8266 using WPS</a></li>
<li><a href="#_code_3">Code</a></li>
</ul>
</li>
<li><a href="#_wifi_manager">Wifi Manager</a>
<ul class="sectlevel2">
<li><a href="#_how_it_works">How it works?</a></li>
<li><a href="#_preparation_3">Preparation</a></li>
<li><a href="#_source_code">Source Code</a></li>
<li><a href="#_extending_your_knowledge">Extending your knowledge:</a></li>
</ul>
</li>
<li><a href="#_summary_6">Summary</a></li>
</ul>
</li>
<li><a href="#_mqtt">MQTT</a>
<ul class="sectlevel2">
<li><a href="#_publish_subscribe">Publish, subscribe</a></li>
<li><a href="#_qos">QoS</a></li>
<li><a href="#_retain">Retain</a></li>
<li><a href="#_lwt">LWT</a></li>
<li><a href="#_mqtt_client">MQTT Client</a>
<ul class="sectlevel2">
<li><a href="#_mqtt_lens">MQTT Lens</a></li>
<li><a href="#_mqtt_js">MQTT.js</a></li>
<li><a href="#_esp8266_mqtt_client">ESP8266 MQTT Client</a></li>
</ul>
</li>
<li><a href="#_mqtt_broker">MQTT Broker</a>
<ul class="sectlevel2">
<li><a href="#_mosca">MOSCA</a></li>
<li><a href="#_some_mqtt_brokers_used_for_real_life_products">Some MQTT Brokers used for real life products</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_summary_7">Summary:</a></li>
<li><a href="#_websocket">Websocket</a>
<ul class="sectlevel2">
<li><a href="#_advantages">Advantages</a></li>
<li><a href="#_disadvantages">Disadvantages</a></li>
<li><a href="#_using_esp8266_as_websockets_server">Using ESP8266 as WebSockets Server</a>
<ul class="sectlevel2">
<li><a href="#_requirement">Requirement</a></li>
<li><a href="#_prepare">Prepare</a></li>
<li><a href="#_javascript_snippet_code_to_create_web_socket_connection">Javascript snippet code to create Web Socket connection</a></li>
<li><a href="#_embedded_html_file_include_js_code_into_esp8266">Embedded HTML file include JS code into ESP8266</a></li>
<li><a href="#_completed_program_for_esp8266">Completed program for ESP8266</a></li>
<li><a href="#_result_2">Result</a></li>
<li><a href="#_result_video">Result video</a></li>
</ul>
</li>
<li><a href="#_using_esp8266_as_websocket_client">Using ESP8266 as Websocket Client</a>
<ul class="sectlevel2">
<li><a href="#_websocket_client_javascript_on_web_browser">Websocket Client Javascript on web browser</a></li>
<li><a href="#_node_js_websocket_server">Node.js Websocket Server</a></li>
<li><a href="#_esp8266_websocket_client">ESP8266 Websocket Client</a></li>
</ul>
</li>
<li><a href="#_summary_8">Summary</a></li>
</ul>
</li>
<li><a href="#_fota">Firmware update over the air (FOTA)</a>
<ul class="sectlevel1">
<li><a href="#_firmware_update_over_the_air">Firmware update over the air</a>
<ul class="sectlevel2">
<li><a href="#_security">Security</a></li>
<li><a href="#_safety">Safety</a></li>
<li><a href="#_fundamental_requirements">Fundamental requirements</a></li>
<li><a href="#_update_process_memory_view">Update process - memory view</a></li>
</ul>
</li>
<li><a href="#_ota_using_arduino_ide">OTA using Arduino IDE</a>
<ul class="sectlevel2">
<li><a href="#ota-step1">Step 1: Upload OTA supported firmware via serial ports</a></li>
<li><a href="#_step_2_chose_uploading_port_via_ota">Step 2: Chose uploading port via OTA</a></li>
<li><a href="#_step_3_modify_new_firmware_and_re_upload_via_wifi">Step 3: Modify new firmware and re-upload via WiFi</a></li>
<li><a href="#_using_password">Using password</a></li>
<li><a href="#_common_errors">Common errors</a></li>
</ul>
</li>
<li><a href="#_firmware_using_web_browser">Firmware using Web Browser</a>
<ul class="sectlevel2">
<li><a href="#_implementation">Implementation</a></li>
<li><a href="#_security_2">Security</a></li>
</ul>
</li>
<li><a href="#_http_server">HTTP Server</a>
<ul class="sectlevel2">
<li><a href="#esp8266-ESPhttpUpdate">ESP8266 ESPhttpUpdate</a></li>
</ul>
</li>
<li><a href="#_node_js_ota_server">Node.js OTA Server</a></li>
</ul>
</li>
<li><a href="#_cheat_sheet">Cheatsheet</a>
<ul class="sectlevel1">
<li><a href="#_arduino_esp8266_cheatsheet">Arduino - ESP8266 Cheatsheet</a></li>
<li><a href="#_c_cheatsheet">C - Cheatsheet</a></li>
</ul>
</li>
<li><a href="#_the_ending">The ending</a>
<ul class="sectlevel2">
<li><a href="#_contributors">Contributors.</a></li>
<li><a href="#_thank_you">Thank you</a></li>
<li><a href="#_license_to_use_documents">License to use documents.</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_getting_started" class="sect0">Basic knowledge</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>In this chapter, we start off with an overview of <strong>IoT</strong> system, <strong>ESP8266</strong> product line, and then how to set up a <strong>Arduino</strong> working environment on your computer. Next we proceed to some sample programs, which library to use. After this chapter, you will have a general view on an IoT system, and grapse how to use the tools necessary for prgramming ESP8266</p>
</div>
<div class="paragraph">
<p>A quick look at the chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IoT</code> and pratical applications.</p>
</li>
<li>
<p>Get to know <code>ESP8266</code> WiFi chip.</p>
</li>
<li>
<p><code>Arduino IDE</code> using Arduino with ESP8266.</p>
</li>
<li>
<p><code>Starter Kit</code>, an <code>IoT</code> starter kit.</p>
</li>
<li>
<p><code>Node.js - Javascript</code>, server-side programming language.</p>
</li>
<li>
<p><code>Installing</code> all necessary tools.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those who are familiar with ESP8266, have worked with an IoT system, or are proficient in <strong>C/C++</strong> programming can skip this part.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internet_of_things_iot">Internet Of Things (IoT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_internet_of_things_iot">What is Internet of Things (IoT)?</h3>
<div class="quoteblock">
<blockquote>
Internet of Things (IoT) - The Internet of things is the network of physical devices, vehicles, home appliances, and other items embedded with electronics, software, sensors, actuators, and network connectivity which enable these objects to connect and exchange data. Each thing is uniquely identifiable through its embedded computing system but is able to inter-operate within the existing Internet infrastructure.
<strong>Link</strong>: <a href="https://en.wikipedia.org/wiki/Internet_of_things" class="bare">en.wikipedia.org/wiki/Internet_of_things</a>
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p>Internet of Things (IoT) refers to objects that can be identified as well as their existence in a connected, interconnected architecture: a network of things connected to the Internet, or simply <code>Things</code>.</p>
</div>
<div class="paragraph">
<p>IoT can be a sensor that is assembled in a refrigerator to record temperature, is a heart transplanted in the human body,&#8230;&#8203;Understandably, IoT makes things easier to communicate with each other The biggest advantage of <code>smart</code> is the ability to prevent and warn anywhere.</p>
</div>
<div class="paragraph">
<p>The term "the Internet of things" was coined by Kevin Ashton of Procter &amp; Gamble, later MIT&#8217;s Auto-ID Center, in 1999, after that, it was used extensively in publications by manufacturers and analysts. They identified IoT as a complex system, because it contains many connections between machines, equipment and services. Initially, IoT was not meant to be automatic and intelligent. Later, it was thought to combine the two concepts IoT - Autonomous control together. It can observe change and feedback with the surroundings, also can control itself without network connection. Integrating intelligence into IoT can also help devices, machines and software collect and analyze human electronic data when we interact with them. In the future, people will be able to communicate with machines via wireless internet without any additional intermediaries.</p>
</div>
<div class="paragraph">
<p>The question is, what helps IoT "smart" and "understand" people? Initially, people thought that the Internet of things was primarily about M2M communication (devices connected via another device). But when it comes to "intelligence", It&#8217;s not just M2M communication that we need to mention the sensors. And do not be mistaken that the Sensor is a machine that operates under the control of other devices that are essentially similar to human eyes and ears with continuous recognition of measurements. After all, Internet of Things provides a connection between machines and sensors, and the cloud data to encrypt data. Cloud computing applications are the key to making Internet of Things work by analyzing, processing and using the data the sensors collect.</p>
</div>
<div class="paragraph">
<p>In the world today, the impact of the IOT is diverse and active in many areas: infrastructure management, health, construction and automation, transportation &#8230;&#8203;. John Chambers (CEO of Cisco) announced: By 2024 there will be 500 billion connected devices. In fact, this number is nearly 100 times greater than the number of people on Earth, That shows that <code>things</code> are more than people very much. We all know the IoT application can <code>talk</code> to people through the keyboard, and the device is also designed with more and more sensors to communicate in the fastest and most accurate way, it help to collect simple data from each of us. But most importantly, although it communicates with humans, the IoT application is not human.
The people said that IoT is the key to success, it is the turning point and great opportunity of the future. In order not to fall behind, governments and businesses need to innovate and invest more aggressively in developing products that apply Internet of things technology.</p>
</div>
<div class="paragraph">
<p>The hashtag: <a href="https://www.google.com/search?q=iot"><strong>#IoT</strong></a> <a href="https://www.google.com/search?q=iot"><strong>#InternetOfThings</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_internet_of_things_iot_system">Internet of Things(IoT) system</h3>
<div class="paragraph">
<p>source: <a href="https://www.linkedin.com/pulse/internet-things-overview-part-1-nishant-tiwari-" class="bare">www.linkedin.com/pulse/internet-things-overview-part-1-nishant-tiwari-</a></p>
</div>
<div class="paragraph">
<p>IoT systems allow users to achieve deeper automation, analysis, and integration within a system. They improve the reach of these areas and their accuracy. IoT utilizes existing and emerging technology for sensing, networking, and robotics.</p>
</div>
<div class="paragraph">
<p>IoT exploits recent advances in software, falling hardware prices, and modern attitudes towards technology. Its new and advanced elements bring major changes in the delivery of products, goods, and services; and the social, economic, and political impact of those changes.</p>
</div>
<div class="sect3">
<h4 id="_iot_key_features">IoT − Key Features</h4>
<div class="paragraph">
<p>The most important features of IoT include artificial intelligence, connectivity, sensors, active engagement, and small device use. A brief review of these features is given below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AI (Artifical Intelligence)</strong> - H IoT essentially makes virtually anything “smart”, meaning it enhances every aspect of life with the power of data collection, artificial intelligence algorithms, and networks. This can mean something as simple as enhancing your refrigerator and cabinets to detect when milk and your favorite cereal run low, and to then place an order with your preferred grocer.</p>
</li>
<li>
<p><strong>Connectivity</strong> - New enabling technologies for networking, and specifically IoT networking, mean networks are no longer exclusively tied to major providers. Networks can exist on a much smaller and cheaper scale while still being practical. IoT creates these small networks between its system devices.</p>
</li>
<li>
<p><strong>Sensors</strong> - IoT loses its distinction without sensors. They act as defining instruments which transform IoT from a standard passive network of devices into an active system capable of real-world integration.</p>
</li>
<li>
<p><strong>Active Engagement</strong> Much of today&#8217;s interaction with connected technology happens through passive engagement. IoT introduces a new paradigm for active content, product, or service engagement.</p>
</li>
<li>
<p><strong>Small Devices</strong> - Devices, as predicted, have become smaller, cheaper, and more powerful over time. IoT exploits purpose-built small devices to deliver its precision, scalability, and versatility.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_iot_advantages">IoT − Advantages</h4>
<div class="paragraph">
<p>The advantages of IoT span across every area of lifestyle and business. Here is a list of some of the advantages that IoT has to offer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Improved Customer Engagement</strong> - Current analytics suffer from blind-spots and significant flaws in accuracy; and as noted, engagement remains passive. IoT completely transforms this to achieve richer and more effective engagement with audiences.</p>
</li>
<li>
<p><strong>Technology Optimization</strong> - The same technologies and data which improve the customer experience also improve device use, and aid in more potent improvements to technology. IoT unlocks a world of critical functional and field data.</p>
</li>
<li>
<p><strong>Reduced Waste</strong> - IoT makes areas of improvement clear. Current analytics give us superficial insight, but IoT provides real-world information leading to more effective management of resources.</p>
</li>
<li>
<p><strong>Enhanced Data Collection</strong> - Modern data collection suffers from its limitations and its design for passive use. IoT breaks it out of those spaces, and places it exactly where humans really want to go to analyze our world. It allows an accurate picture of everything.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_iot_disadvantages">IoT − Disadvantages</h4>
<div class="paragraph">
<p>Though IoT delivers an impressive set of benefits, it also presents a significant set of challenges. Here is a list of some its major issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Security</strong> - IoT creates an ecosystem of constantly connected devices communicating over networks. The system offers little control despite any security measures. This leaves users exposed to various kinds of attackers.</p>
</li>
<li>
<p><strong>Privacy</strong> - The sophistication of IoT provides substantial personal data in extreme detail without the user&#8217;s active participatSome find IoT systems complicated in terms of design, deployment, and maintenance given their use of multiple technologies and a large set of new enabling technologies.</p>
</li>
<li>
<p><strong>Flexibility</strong> - Many are concerned about the flexibility of an IoT system to integrate easily with another. They worry about finding themselves with several conflicting or locked systems.</p>
</li>
<li>
<p><strong>Compliance</strong> - IoT, like any other technology in the realm of business, must comply with regulations. Its complexity makes the issue of compliance seem incredibly challenging when many consider standard software compliance a battle.</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.iot-concept.png" alt="Hình minh họa IoT" width="500">
</div>
<div class="title">Figure 1. vignette IoT</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.iot_growth_technology.png" alt="Sự phát triển của iot dự đoán đến năm 2020" width="500">
</div>
<div class="title">Figure 2. Predictably by 2020, the world will have some 50 billion IoT devices</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_real_world_applications_of_internet_of_things">Real World Applications of Internet of Things</h3>
<div class="paragraph">
<p>To help clarify how the Internet of Things works, we&#8217;ve laid out some applications for the IoT, along with some specific devices and examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Smart Home</strong> - According to statistics, smart home is the most searched IoT related applications on Google search. Smart Home is a home with lots of automatic features such as turn on the air-conditioner when you&#8217;re about to go home, turn off the lights when you leave the house, unlocking when your family member is at your door, Open the garage when you drive home from work&#8230;&#8203; and other features that help improve the quality of life when using smart home.</p>
</li>
<li>
<p><strong>Wearables</strong> - Some of the devices, like the <code>Dashbon Mask</code>, this is a smart headphone. It&#8217;s help you listen to high quality music and watch HD movies with the virtual projector, or <code>AMPL SmartBag</code> a backpack with reserve cell that can charge for mobile devices, computers..</p>
</li>
<li>
<p><strong>Connected cars</strong> - Help improve the quality of service for car users, a <code>Connected car</code> can optimize its operations such as reporting when low on fuel, giving alerts when things are approaching or most recently  Tesla&#8217;s self-driving electric car&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_esp8266">ESP8266</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ESP8266 is a cheap WiFi 2.4Ghz compatible SoC which is manufactured by a Chinese semiconductor company: Espressif Systems.</p>
</div>
<div class="paragraph">
<p>It was initially designed in August 2017, packed in a ESP-07 module which was manufactured by a third-party: AI-Thinker. It comes with the ability to connect to the Internet through WiFi network with decent speed, consumes little energy and requires less external components. ESP8266 has a good ratio of cost to performance.</p>
</div>
<div class="paragraph">
<p>ESP8266 now has a large community worldwide, providing various modules bundled with open source codes, which are user-friendly and cut time-to-market.</p>
</div>
<div class="paragraph">
<p>At the time of writing, ESP8266EX is the standard in the ESP8266 family.</p>
</div>
<div class="sect2">
<h3 id="_pin_mapping">Pin mapping</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.esp8266-soc.svg" alt="ESP8266EX pin mapping" width="500">
</div>
<div class="title">Figure 3. ESP8266EX pin mapping</div>
</div>
</div>
<div class="sect2">
<h3 id="_hardware_description">Hardware description</h3>
<div class="ulist">
<ul>
<li>
<p>32-bit RISC CPU : Tensilica Xtensa LX106 running at 80 MHz</p>
</li>
<li>
<p>Support for external Flash of 512KiB to 4MiB</p>
</li>
<li>
<p>64KBytes RAM for instructions</p>
</li>
<li>
<p>96KBytes RAM for data</p>
</li>
<li>
<p>64KBytes boot ROM</p>
</li>
<li>
<p>EEE 802.11 b/g/n, Wi-Fi 2.4 GHz compatible</p>
<div class="ulist">
<ul>
<li>
<p>Integrate TR switch, balun, LNA, Power Amplification and Matching network</p>
</li>
<li>
<p>Support for WEP, WPA/WPA2, Open network</p>
</li>
</ul>
</div>
</li>
<li>
<p>Integrate TCP/IP</p>
</li>
<li>
<p>Support for many types of antennae</p>
</li>
<li>
<p>16 GPIO pins</p>
</li>
<li>
<p>SDIO 2.0, UART, SPI, I²C, PWM,I²S with DMA.</p>
</li>
<li>
<p>1 ADC 10-bit</p>
</li>
<li>
<p>Operating Temperature Range : -40C ~ 125C</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.ESP-12E.jpg" alt="Module ESP12E" width="300">
</div>
<div class="title">Figure 4. A popular integrated module (Module ESP12E)</div>
</div>
</div>
<div class="sect2">
<h3 id="_officially_supported_sdk">Officially supported SDK</h3>
<div class="paragraph">
<p>Espressif now has 3 separate SDKs, which are <strong>NONOS SDK</strong>, <strong>RTOS SDK</strong>, and <strong>Arduino</strong>. All 3 have their own perks, suitable for particular purposes and they use similar HAL APIs. At the moment, <strong>Arduino</strong> are widely used due to its ease-of-use, good software structure and making good use of libraries.</p>
</div>
<div class="sect3">
<h4 id="_esp8266_nonos_sdk">ESP8266 NONOS SDK</h4>
<div class="paragraph">
<p><strong>NONOS SDK</strong> since version <strong>2.0.0</strong> is fairly stable and provides almost all functions that ESP8266 is capable of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>APIs for Timer, System, Wifi, reading\writing SPI Flash, Sleep and hardware peripherals: GPIO, SPI, I²C, PWM, I²S với DMA.</p>
</li>
<li>
<p><code>Smartconfig</code>: Support for fast configuration of Wi-Fi.</p>
</li>
<li>
<p><code>Sniffer</code> API: Wireless packet capture at 2.4Ghz.</p>
</li>
<li>
<p><code>SNTP</code> API: Time syncing with a Time Server.</p>
</li>
<li>
<p><code>WPA2 Enterprise</code> API: Provide a management system for WiFi by using accounts form RADIUS servers.</p>
</li>
<li>
<p><code>TCP/UDP</code> API: Allows for Internet connection and supports for protocols such as: HTTP, MQTT, CoAP.</p>
</li>
<li>
<p><code>mDNS</code> API: Locating the <strong>IP</strong> of devices in a network using hostname.</p>
</li>
<li>
<p><code>MESH</code> API: Connecting ESP8266 modules in a mesh.</p>
</li>
<li>
<p><code>FOTA</code> API: Firmware Over The Air.</p>
</li>
<li>
<p><code>ESP-Now</code> API: Using wirelessly transmitted data package at 2.4GHz to communicate directly with other ESP8266s without an Access Point.</p>
</li>
<li>
<p><code>Simple Pair</code> API: Set up a secured connection between two devices.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_esp8266_rtos_sdk">ESP8266 RTOS SDK</h4>
<div class="paragraph">
<p><strong>RTOS SDK</strong> has <strong>FreeRTOS</strong> at its core, and almost all <strong>NON OS</strong> SDK APIs are compatible with <strong>RTOS SDK</strong>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_esp8285">ESP8285</h3>
<div class="paragraph">
<p>ESP8285 is a successor of ESP8266EX, they are identical except ESP8225 has an 1 MiB internal Flash, rendering SPI FLASH obsolete and in turns reducing size and manufacturing cost.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_and_development_board">Module and development board</h3>
<div class="paragraph">
<p>ESP8266 needs at least 7 extra components for proper functionality, one of which is antenna. The antenna requires top-notch equipments for manufacturing and testing. For that reason, many modules and development boards are pre-built to work out-of-the-box.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Some common ESP8266 modules</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pitch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LEDs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Antenna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shielded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.3 × 24.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-FL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.2 × 14.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceramic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.3 × 12.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.7 × 12.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-FL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.2 × 14.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-06</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">misc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.2 × 14.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceramic+U-FL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20.0 × 16.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-08</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.0 × 16.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">misc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0 × 10.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.2 × 10.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.05"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceramic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.3 × 12.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.0 × 16.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.0 × 16.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.0 × 16.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.0 x 20.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.3 x 16.2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_esp8266_development_board">ESP8266 development board</h3>
<div class="paragraph">
<p>ESP8266 module includes only ESP8266 chip and other extra components; however, to function properly, we need to <strong>program</strong> it before putting it into operation. This process is called programming binary firmware (pre-conpiled on the computer) to the ESP8266 Flash.
To put ESP8266 in <strong>Program</strong> mode, <strong>GPIO0</strong> needs connecting to logic 0 (0V - GND) while RESETing the chip. Then the chip is ready for programming.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/auto-program.jpg" alt="Automatic programmer" width="500">
</div>
<div class="title">Figure 5. An automatic programmer using USB CDC</div>
</div>
<div class="paragraph">
<p>Most development boards have a buil-in programmer, which means they will automatically configure DRT and RTS of USB CDC, put the chip in progamming mode, then download the firmware. Arduino IDE does the same thing, it will tweak all options in accordance with the reported board.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are a beginner and do not know much about hardware, it&#8217;d be best to use a development board with built-in programmer. When you start designing the hardware for your project, it&#8217;ll then be preferable to use a separate programmer cost-wise. These circuits are easy to find.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_arduino">What is Arduino?</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.arduino.png" alt="01.arduino" width="300">
</div>
<div class="title">Figure 6. Arduino Board</div>
</div>
<div class="paragraph">
<p><a href="https://arduino.cc"><strong>Arduino</strong></a> is an IDE with integrated editor, compiler, and programmer along with firmwares, pre-built libraries for ease of use. The language of use of <code>C/C++</code>. Everything is a collective effort of the community around it. Its philosophy and desgin aim at beginners, amateurs. However, its quality <code>C/C++</code> compiler and excellent libraries are what make Arduino popular and on the same league with other professional compilers.</p>
</div>
<div class="paragraph">
<p>One advocate of <strong>Arduino</strong> was initially AVR, but gradually lots of other vendors like <strong>ARM, PIC, STM32</strong> and recently <a href="https://arduino.esp8266.vn"><strong>ESP8266</strong></a>, <a href="https://esp32.vn"><strong>ESP32</strong></a>, <a href="http://riscv.vn"><strong>RISCV</strong></a> also joined in bringing in more powerful hardware and software capabilities.</p>
</div>
<div class="sect2">
<h3 id="_some_of_arduino_s_features">Some of Arduino&#8217;s features</h3>
<div class="ulist">
<ul>
<li>
<p>Arduino hides the complication of the hardware layer with simpler concepts, and the complexity of ht software with transparent instructions. Setting up a MCU&#8217;s output using registers pose a certain degree of difficulty that even professionals need to look up the datasheet regularly, but Arduino does it with a single function.</p>
</li>
<li>
<p>Thanks to its popularity and easiness and vast libraries, you only need to concern with the final product without knowing much about the protocols, datasheet, etc. These things make it more approachable for newbies and enable them to build amazing things without any prior electronics knownledge.</p>
</li>
<li>
<p>On the other hand, not knowing enough is a drawback, the majority often find it impossible to handle issues outside the scope of the libraries.</p>
</li>
<li>
<p>Prototypes made with Arduino are not durable, their purpose is to cut time-to-market.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benefits_of_using_arduino">Benefits of using Arduino</h3>
<div class="ulist">
<ul>
<li>
<p>IDE are designed to work well with many compilers and different hardwares without sacrificing for efficiency. For instance: Vanilla Arduino for AVR, but there are other versions for STM32, PIC32, ESP8266, ESP32, etc., optimising existing libraries.</p>
</li>
<li>
<p>Libraries are developed upon top layer APIs, thus these can be reused for all chips. In particular, Arduino for ESP8266 can utilise over 90% of Arduino libraries.</p>
</li>
<li>
<p>Arduino use C/C++ compiler. Did you know that ESP8266 non-os SDK and ESP8266 Arduino both use the same compiler? The end result is almost identical.</p>
</li>
<li>
<p>C/C++ libraries are structured using OOP thus benefit from layering, inheritance, and good management in large projects. MCUs will become more powerful and its applications are huge. Prior management model in C will be tough.</p>
</li>
<li>
<p>Projects for Arduino are always open source, you can use these for reference to your product for improvement and learn from the masters in the process</p>
</li>
<li>
<p>Arduino emphasises multi-platforms, high modularity, which is suitable for complex and highly complex applications. These applications are real life issues. If you are not familiar with C++, or experience problem with overcontrol then give Arduino a try</p>
</li>
<li>
<p>You can save a lot of time by focusing on what is important in these devices. Time is critical, so spend it wisely.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_arduino_community_around_the_world">Arduino community around the world</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.arduino.cc"><strong>Official Arduino website (IDE &amp; AVR/ARM/x86 Board)</strong></a> <a href="https://www.arduino.cc" class="bare">www.arduino.cc</a></p>
</li>
<li>
<p><a href="https://github.com/esp8266/Arduino"><strong>Arduino for ESP8266</strong></a> <a href="https://github.com/esp8266/Arduino" class="bare">github.com/esp8266/Arduino</a></p>
</li>
<li>
<p><a href="https://github.com/espressif/arduino-esp32"><strong>Arduino for ESP32</strong></a> <a href="https://github.com/espressif/arduino-esp32" class="bare">github.com/espressif/arduino-esp32</a></p>
</li>
<li>
<p><a href="http://chipkit.net/"><strong>Arduino for PIC32</strong></a> <a href="http://chipkit.net/" class="bare">chipkit.net/</a></p>
</li>
<li>
<p><a href="http://www.stm32duino.com/"><strong>Arduino for STM32</strong></a> <a href="http://www.stm32duino.com/" class="bare">www.stm32duino.com/</a></p>
</li>
<li>
<p><a href="https://www.hackster.io/arduino">*Arduino projects</a> <a href="https://www.hackster.io/arduino" class="bare">www.hackster.io/arduino</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_arduino_for_esp8266_esp8266_wifi_uno_board">Arduino for ESP8266 &amp; ESP8266 WiFi Uno Board</h3>
<div class="paragraph">
<p><a href="https://github.com/iotmakervn/iot-wifi-uno-hw">ESP8266 WiFi Uno Board</a> is a open source project that promotes a development environment for ESP8266 using Arduino. This allows you to write a Sketch with similar libraries and functions to those of Arduino that can run directly on ESP8266 and no additional MCU is required.</p>
</div>
<div class="paragraph">
<p>ESP8266 Arduino core are bundled with libraries for connecting WiFi that supports TCP, UDP and application protocols such as HTTP, mDNS, SSDP, DNS Servers. In addition, there are libraries for OTA firmware update, Filesystem running from Flash or SD card, servomotors, SPI, I2C peripherals.</p>
</div>
<div class="paragraph">
<p>Link: <a href="https://github.com/iotmakervn/iot-wifi-uno-hw" class="bare">github.com/iotmakervn/iot-wifi-uno-hw</a></p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/01-intro/01.Iot-wifi-uno-hw-pinout.png" alt="01.Iot wifi uno hw pinout" width="400">
</div>
<div class="title">Figure 7. PINOUT</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_node_js">Node.js</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node.js® is a JavaScript runtime built on Chrome&#8217;s V8 JavaScript engine for Chrome. Node.js allows execution of JavaScript code on server-side, accesses system resources and runs most of OS task using JavaScript and C++ linking.</p>
</div>
<div class="paragraph">
<p>Lots of companies nowsaday implement Node.js in their production system (e.g Paypal). Node.js-based microservices are also deployed in many leading tech companies.</p>
</div>
<div class="paragraph">
<p>Cloud platforms of numerous companies support executing Node.js (e.g. Amazon Lambda, Google Script, IBM Blumix, Microsoft Azure)</p>
</div>
<div class="paragraph">
<p>JavaScript is continuously improved with the latest version Ecmascript 6 (ES5, ES2015) and at an astouding pace. It comes with many benefits such as accessibility, simplicity, OOP, etc.</p>
</div>
<div class="paragraph">
<p>Another reason for Node.js popularity is that most Web and Mobile developers already know JavaScript, now Node.js enables them to deploy applications on server-side without using another lanugage (historically Java, PHP, etc.)</p>
</div>
<div class="sect2">
<h3 id="_why_we_use_node_js_in_this_book">Why we use Node.js in this book</h3>
<div class="paragraph">
<p>A full-fledged Internet of Things is undoubtedly complicated: devices, server processing, database, analysis system, data reporting, artificial intelligence. A Google Iot Core diagram</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/benefits-diagram-2x.png" alt="benefits diagram 2x" width="500">
</div>
<div class="title">Figure 8. Google IoT Core Diagram</div>
</div>
<div class="paragraph">
<p><code>Server</code> is a crucial part in an IoT system. With all its merits, Node.js is exellent for server-side development in IoT. Besides, Node.js is supported by an active community, finding a suitable package is efforless, which in turn saves lots of time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_does_this_book_teach_node_js">Does this book teach Node.js ?</h3>
<div class="paragraph">
<p>Regrettably <strong>No</strong>, but don&#8217;t feel disappointed, Node.js applications in this book are quite simple and not so intensisve, just enough so you can get started with Node.js programming.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sublime_text">Sublime Text</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have Arduino IDE for programming ESP8266, but you still need another text editor for Node.js. Aside from Sublime Text, you might prefer others such as <code>Atom</code> or <code>Visual Code</code>; however, Notepad is not recommended.</p>
</div>
<div class="paragraph">
<p>Sublime Text is among developers' first choice due to many reasons with speed is a major factor, sometimes considered to be the fastest. Also it&#8217;s free (it frequently reminds you of purchase, which many developers find content with)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/sublime.png" alt="Sublime Text" width="600">
</div>
<div class="title">Figure 9. Sublime Text</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_and_preparation_requirements">Installation and Preparation Requirements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_arduino_ide">Arduino IDE</h3>
<div class="paragraph">
<p><strong>Step 1</strong>: install the Arduino software.</p>
</div>
<div class="paragraph">
<p>Download and install Arduino IDE from arduino&#8217;s homepage. Link donwload:
<a href="https://www.arduino.cc/en/Main/Software" class="bare">www.arduino.cc/en/Main/Software</a>.</p>
</div>
<div class="paragraph">
<p>Depending on the operating system, you may choose the appropriate installation package.</p>
</div>
<div class="paragraph">
<p><strong>Step 2</strong>: Install the toolkit, compiler, SDK. That supports the ESP8266 chip in the Arudino IDE.</p>
</div>
<div class="paragraph">
<p>With this toolkit, we can easily program, compile, and use libraries for the ESP8266 directly on the Arduino IDE. Open Arduino IDE in the menu bar, select <code>File</code> &#8594; <code>Preferecens</code>, in <code>settings</code> tab, you need to choose optionsthe options like the image below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/preferences.png" alt="Thêm file hỗ trợ cài đặt board ESP8266" width="400">
</div>
<div class="title">Figure 10. Add the ESP8266 board information file</div>
</div>
<div class="paragraph">
<p><code>Sketchbook location</code> is the path, which you want to save the sketch (program file), On the Unix-like systems the default path is: <code>/home/name_your_computer/Arduino</code>. This will also be the location of the libraries that we will add later.</p>
</div>
<div class="paragraph">
<p>In the <code>Additional Board Manager URLs field</code>, enter path <code>http://arduino.esp8266.com/stable/package_esp8266com_index.json</code>.</p>
</div>
<div class="paragraph">
<p><strong>Step 3</strong>: Install ESP8266 board.</p>
</div>
<div class="paragraph">
<p>Open <code>Boards Manager</code> in the <code>Tools</code> on menu bar &#8594; find the board you want to use with keyword <code>Generic 8266</code> &#8594; select the board ti install as image below and click install.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/install_board_generic8266.png" alt="Board manager" width="400">
</div>
<div class="title">Figure 11. Install ESP8266 board</div>
</div>
</div>
<div class="sect2">
<h3 id="install-library">Install arduino library</h3>
<div class="paragraph">
<p>Some libraries published by other developers, you can install it directly using Arduino&#8217;s Library Manager.</p>
</div>
<div class="paragraph">
<p>Start the arduino IDE and select the item <code>Sketch</code> &#8658; <code>include library</code> &#8658; <code>Manage libraries</code>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/library.png" alt="Khởi động Library Manager" width="400">
</div>
<div class="title">Figure 12. start the library Manager</div>
</div>
<div class="paragraph">
<p>In the <code>libbrary manager</code> , you need to enter the contents of the library in the textbox, select the version, and then press <code>install</code>, the installed libraries will have the text <code>INSTALLED</code> displayed at the top of each library.
For example, we will find the OLED library related to ESP8266 as shown below::</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/library-1.png" alt="Cài đặt thư viện" width="400">
</div>
<div class="title">Figure 13. install library</div>
</div>
</div>
<div class="sect2">
<h3 id="_usb_cdc_driver">USB CDC driver.</h3>
<div class="paragraph">
<p>The ESP8266 WiFi Uno board is connected to the computer via a USB MicroB and uses the chip <strong>CH340</strong> to convert USB to UART. Therefore, you need to install USB driver software to communicate with the board.</p>
</div>
<div class="paragraph">
<p>Connect the USB cable to the board, making sure the LEDs in the circle the light as shown below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/connect_USB.jpg" alt="Connect USB" width="400">
</div>
<div class="title">Figure 14. Connect USB</div>
</div>
<div class="sect3">
<h4 id="_windows_linux">Windows &amp; Linux</h4>
<div class="paragraph">
<p>Download the USB driver installation for Windows <a href="http://www.wch.cn/download/CH341SER_ZIP.html" class="bare">www.wch.cn/download/CH341SER_ZIP.html</a> and Linux <a href="http://www.wch.cn/download/CH341PAR_LINUX_ZIP.html" class="bare">www.wch.cn/download/CH341PAR_LINUX_ZIP.html</a> . Follow the installation requirements.
After installation, the result is displayed on the Arduino as image</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/connect_ok.png" alt="Kết nối thành công" width="400">
</div>
<div class="title">Figure 15. Connection succeeded</div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_os">Mac OS</h4>
<div class="paragraph">
<p>Download the installation: <a href="https://arduino.esp8266.vn/_static/download/CH34x_Install_V1.3.pkg" class="bare">arduino.esp8266.vn/_static/download/CH34x_Install_V1.3.pkg</a></p>
</div>
<div class="paragraph">
<p>For <strong>Mac OS Sierra</strong> and later versions if you have problems with RESET your machine, you need to handle the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open "Terminal" <code>cmd + space</code> -&#8594; Enter Terminal</p>
</li>
<li>
<p>delete driver: <code>sudo rm -rf /System/Library/Extensions/usb.kext</code></p>
</li>
<li>
<p>With some machines, you have to do extra work <code>sudo rm -rf /Library/Extensions/usbserial.kext</code></p>
</li>
<li>
<p>If you can not do the command above, you need to change <code>Security and Privacy</code> in <code>System Preference</code>. Select <code>Allow Apps Downloaded From</code> form <code>Mac App Store and Identified Developers</code> to <code>Anywhere</code> - and download <a href="https://arduino.esp8266.vn/_static/download/CH34x_Install_V1.3.pkg">CH34x_Install_V1.3.pkg</a> to install again.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/mac.png" alt="Lựa chọn Allow Apps Downloaded From Anywhere" width="400">
</div>
<div class="title">Figure 16. Select Allow Apps Downloaded From Anywhere</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</h3>
<div class="paragraph">
<p>After the connection and installation are complete, a virtual COM port will appear on your computer. (Depending on the type of operating system that has port names like <code>COM1</code>, <code>COM2</code> &#8230;&#8203; for Windows, <code>/dev/tty.wchusbserial1420</code> on Mac OS, <code>/dev/ttyUSB0</code> on Linux)
Open Arduino IDE and select (refer to connection configuration as image below):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the configuration for the ESP8266 WiFi Uno Board
image::01-intro/port-setup.png[Cấu hình Board ESP8266 WiFi Uno, align="center", width=400]</p>
<div class="ulist">
<ul>
<li>
<p>Board: <code>Generic ESP8266 Module</code>.</p>
</li>
<li>
<p>Flash Size: <code>4M (3M SPIFFS)</code>.</p>
</li>
<li>
<p>Port: Select the port when the device plugged</p>
</li>
<li>
<p>Upload speed: choose the highest speed, if the computer loaded program is faulty, we will choose the lower speed.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="arduino-flash">Load the program file into the board using the Arduino IDE</h3>
<div class="paragraph">
<p>On the Arduino interface there are two buttons, the leftmost is the <code>Verify</code> button, for compiling the program, which is equivalent to the <code>Sketch&gt; Verify / Compile</code> function. The next button is <code>Upload</code>, which is equivalent to the function <code>Sketch&gt; Upload</code>. After selecting the appropriate board, the program has no errors, then click <code>Upload</code> to load the program into the board.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/program.png" alt="Nạp chương trình xuống board dùng Arduino IDE" width="400">
</div>
<div class="title">Figure 17. Upload program</div>
</div>
</div>
<div class="sect2">
<h3 id="export-binary">export firmware binary in Arduino IDE</h3>
<div class="paragraph">
<p>If we need a <code>binary file</code> , we can export the file by <code>Sketch&gt; Export compiled Binary</code>, and the .bin file will be in the Sketch folder.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/export-fw.png" alt="export fw" width="400">
</div>
<div class="title">Figure 18. Export Binary file</div>
</div>
</div>
<div class="sect2">
<h3 id="_serial_terminal">Serial Terminal</h3>
<div class="paragraph">
<p>There are many free applications to interact with the Serial port on your computer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows: PuTTY, realterm</p>
</li>
<li>
<p>Linux: minicom, screen</p>
</li>
<li>
<p>MacOS: minicom, screen</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="arudino-term">using Arduino IDE Serial Monitor</h4>
<div class="paragraph">
<p>Arduino has a built-in Serial Monitor, when you select the correct Serial port, you can press the Serial icon on the IDE to open:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/01-intro/term.png" alt="Nạp chương trình xuống board dùng Arduino IDE" width="400">
</div>
<div class="title">Figure 19. Arduino IDE Serial Monitor</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_node_js_2">Node.js</h3>
<div class="paragraph">
<p>Download and install Node.js : <a href="https://nodejs.org/en/download/" class="bare">nodejs.org/en/download/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_sublime_text_2">Sublime Text</h3>
<div class="paragraph">
<p>Download and install Sublime text : <a href="https://www.sublimetext.com/" class="bare">www.sublimetext.com/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_git">Git</h3>
<div class="paragraph">
<p>This is a support tool that you should also install and use, it does not help you become a programmer, but it helps a programmer become professional and effective <a href="https://git-scm.com/" class="bare">git-scm.com/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point, you have a basic understanding of the ecosystem, the tools and procedures working with ESP8266 as well as an <strong>IoT</strong> system. In addition, you can now start developing an ESP8266-based application. All the selected tools work on multiple platforms such as Mac OS, Windows, or Linux.</p>
</div>
</div>
</div>
<h1 id="_hello_world" class="sect0">Hello World</h1>
<div class="openblock partintro">
<div class="content">
Any learning journey should be taken slowly. As you first start, your knowledge and understanding about the field are limited. <code>Hello world</code> helps you with the basics: how to compile, how to upload the program, how to use libraries as well as get a hold of Arduino programming structure.
</div>
</div>
<div class="sect1">
<h2 id="_led_blinking">LED Blinking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_knowledge">Knowledge</h3>
<div class="paragraph">
<p><strong>ED</strong> = Light Emitting Diodes – a semiconductor that can emit light of different colours depending on its material. To control a LED, a voltage drop higher than Vf (datasheet) is applied between the cathode and anode of the LED, typically 3.2v, and a current lower than its maximum threshold, typically 15mA.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/LED_symbol.svg" alt="LED symbol" width="200">
</div>
<div class="title">Figure 20. LED symbol on a schematic (Cathode+, Anode-)</div>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/led.png" alt="led" width="400">
</div>
<div class="title">Figure 21. The circuit can be wired as above</div>
</div>
<div class="paragraph">
<p><strong>Arduino IDE</strong></p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/arduino-ide.png" alt="arduino ide" width="400">
</div>
<div class="title">Figure 22. Arduino IDE</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Compile the program (check if there is any error).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Compile and upload the program.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File name tab.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>ino</code> file content.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wiring">Wiring</h3>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/btn-led.png" alt="btn led" width="300">
</div>
<div class="title">Figure 23. ESP8266 WiFi Uno circuit with pre-built LED on Pin 16, and button on Pin 0</div>
</div>
<div class="paragraph">
<p>With the source code below, after having checked the program, make sure you <a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a> and <a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_source_code_for_blinking_using_delay">Source code for blinking using Delay</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int pin_led = 16;
/* put your setup code here, to run once */
void setup() {

  pinMode(pin_led, OUTPUT);    // initialize digital pin pin_led as an output
}

/* put your main code here, to run repeatedly */
void loop() {
  digitalWrite(pin_led, HIGH); // LED OFF (HIGH level)
  delay(1000);                 // delay 1s
  digitalWrite(pin_led, LOW);  // bLED ON (LOW level)
  delay(1000);                 // delay 1s
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_code_for_blinking_using_timer">Source code for blinking using timer</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int ledPin = 16;
int ledState = LOW;
unsigned long previousMillis = 0;
const long interval = 1000;

void setup() {
  pinMode(ledPin, OUTPUT);
}

void loop() {
  unsigned long currentMillis = millis();
  if (currentMillis - previousMillis &gt;= interval) {
    previousMillis = currentMillis;
    if (ledState == LOW)
      ledState = HIGH;  // change status
    else
      ledState = LOW;   // change status
    digitalWrite(ledPin, ledState);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_digital_io">Digital IO</h3>
<div class="paragraph">
<p>Pin name in Arduino (Pin number) is similar to ESP8266’s pin order. <code>pinMode</code>, <code>digitalRead</code>, and <code>digitalWrite</code> use the same Pin Number, for instance to read GPIO2, we call digitalRead(2).</p>
</div>
<div class="paragraph">
<p>GPIO0 to GPIO15 can either be <code>INPUT</code>, <code>OUTPUT</code>, or <code>INPUT_PULLUP</code>. <code>GPIO16</code> can either be <code>INPUT</code>, <code>OUTPUT</code> or <code>INPUT_PULLDOWN_16</code>. After hardware reset, all pins are configured as INPUT by default. <code>INPUT</code>.</p>
</div>
<div class="paragraph">
<p>Each pin serves a particular function; for instance <code>Serial</code>, <code>I2C</code>, <code>SPI</code>. These functions will be configured accordingly using libraries.</p>
</div>
<div class="paragraph">
<p><code>GPIO6</code> and <code>GPIO11</code> are not present as they are used to program Flash memory. Attempt to use these pins will result in errors.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Other boards and modules (i.e. ESP-12ED, NodeMCU 1.0) don’t have GPIO9 and GPIO11 since they are used for DIO mode in Flash, while ESP12 uses QIO mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GPIO Interrupt is supported with <code>attachInterrupt</code>, <code>detachInterrupt</code> GPIO Interrupt can be assigned to any GPIO except GPIO16 and it is also compatible with Arduino standard interrupt such as : <code>CHANGE</code>, <code>RISING</code>, <code>FALLING</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_2">Summary</h3>
<div class="paragraph">
<p>Extended application</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fading LED ( on or off gradually)</p>
</li>
<li>
<p>LED blinking using Ticker
== Nút nhấn</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_knowledge_2">Knowledge</h3>
<div class="paragraph">
<p>Buttons help the ESP8266 to activate a process when necessary. In many applications, we often require some sort of external trigger. Throughout this book, we will use buttons to activate some demonstrations as well as LEDs for status indication. In this part, pushing the button will change the LED status (from on &#8594; of and vice versa).</p>
</div>
<div class="paragraph">
<p>This is a simplified demonstration, in reality, processing a button is quite complicated. Mechanical button often produces a chain of pulses (noise, bouncing, etc.). Usually a logic state of a pin should be maintained for 100 milliseconds to be considered stable.</p>
</div>
<div class="paragraph">
<p>Besides using interrupt for button detection – this method also helps conserve CPU resources, which only occurs when there is an expected event, there is another method called polling: This method requires the CPU to constantly check for the button status. However its responsiveness is inferior to that of interrupt.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/button-circuit.jpg" alt="button circuit" width="300">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Requirement: button (GPIO0) for blinking LED (GPIO6) and print out to Serial port.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ESP8266 WiFi Uno with pre-built button on GPIO0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_code_using_polling">Source code using polling</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int ledPin = 16;                 // LED is connected to pin GPIO16
int btnPin = 0;                  // Push button is connected to pin GPIO0
int ledState = LOW;

void blink()
{
  if (ledState == LOW) {
    ledState = HIGH;
  } else {
    ledState = LOW;
  }
  digitalWrite(ledPin, ledState); // Reverse state of led &amp; and print out serial terminal
  Serial.println("Pressed, value=" + String(ledState));
}

bool isPressed()
{
  return (digitalRead(btnPin) == 0);
}
void setup()
{
  pinMode(ledPin, OUTPUT);       // Sets the digital pin as OUTPUT
  pinMode(btnPin, INPUT_PULLUP); // The push button is configured as a pull-up input

  Serial.begin(115200); // Sets the data rate in bits per second (baud) 115200 for serial data transmission
}

void loop()
{
  if (isPressed()) {
    blink();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_code_using_interrupt">Source code using interrupt</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int ledPin = 16;                 // LED is connected to pin GPIO16
int btnPin = 0;                  // Push button is connected to pin GPIO0
int ledState = LOW;

void blink()
{
  if (ledState == LOW) {
    ledState = HIGH;
  } else {
    ledState = LOW;
  }
  digitalWrite(ledPin, ledState);
  Serial.println("Pressed, value=" + String(ledState));
}
void setup()
{
  pinMode(ledPin, OUTPUT);      // Sets the digital pin as OUTPUT
  pinMode(btnPin, INPUT_PULLUP); // The push button is configured as a pull-up input
  attachInterrupt(btnPin, blink, FALLING); //set interrupt in btnPin
  Serial.begin(115200); // Sets the data rate in bits per second (baud) 115200 for serial data transmission
}

void loop()
{
  //do nothing
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_some_concepts">Some concepts</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Interrupt</strong> Interrupt is a hardware-related concept; an arbitrary event occurs, which requires the CPU to halt all on-going tasks to server the Interrupt routine. For instance, an interrupt is activated when there is a change from logic 1 to 0 (falling edge) of a GPIO, when the change occurs on that GPIO, CPU will immediately halt, save the main program’s context and jump to the Interrupt service routine to execute the instructions.</p>
</li>
<li>
<p><strong>pull-up/pull-down</strong> Most GPIO pins have 3 states, one is output high (logic 1), another one is output low (logic 0) and the last one is input. In input state, a GPIO assumes high impedance (Hi-Z) state or isolated state, no current can pass through although the pin can still sense voltage level. In this Hi-Z state, if no initial logic is defined, the GPIO will float, which means it is susceptible to external factors; when read it will not have a consistent logic state. Pull-up means pulling a resistor connected to a GPIO to logic 1, defining an initial logic level of 1 to ensure it remains that way unless externally modified. Similarly, pull-down defines GPIO’s initial logic level of 0.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_oled">OLED</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oled_display">OLED display</h3>
<div class="paragraph">
<p>OLED display (Organic Light Emitting Diode)  is a type of display composed of a film of organic compound situated between cathode and anode. It emits light in respond to an electric current. As it uses organic semiconductor, backlight is redundant, which is more effective than traditional LCD in terms of size and cost. Outdoor performance is decent compared to LCD.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ssd1306_oled_display">SSD1306 OLED display</h3>
<div class="paragraph">
<p>A small display ranging from 0.96 in to 1.25 in that is commonly seen in electronics. The driver MCU is SSD1306. This chip interfaces with external MCUs using I2C</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/01-intro/oled.jpg" alt="OLED SSD1306" width="400">
</div>
<div class="title">Figure 24. OLED SSD1306</div>
</div>
</div>
<div class="sect2">
<h3 id="_i2c_interface">I2C interface</h3>
<div class="paragraph">
<p>I2C (Inter-Integrated Circuit) is a serial interface developed by Philips for transmitting data between IC. I2C uses 2 transmission lines, one is serial clock (SCL) generated by a Master and another one is full-duplex serial data (SDA)</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/i2cClock.png" alt="i2cClock" width="600">
</div>
<div class="title">Figure 25. I2C Clock</div>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/01-intro/i2c-network.png" alt="Mô hình mạng I2C" width="400">
</div>
<div class="title">Figure 26. I2C Topology</div>
</div>
<div class="paragraph">
<p>are required as shown in the figure. The nominal value is usually 4k7 or 1k2, depending on the speed and distance</p>
</div>
</div>
<div class="sect2">
<h3 id="_oled_display_with_esp8266">OLED Display with ESP8266</h3>
<div class="paragraph">
<p><strong>Step 1: Wiring</strong> Connect GPIO4 of ESP8266 with SDA of OLED, and GPIO5 with SCL. Connect 3v3 with VCC and the GND for OLED. However, ESP8266 IoT Uno has default pin header for OLED, which is illustrated in the figure</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/01-intro/oled-esp.png" alt="ESP8266 với OLED" width="814">
</div>
<div class="title">Figure 27. ESP8266 with OLED</div>
</div>
<div class="paragraph">
<p><strong>Step 2: Installing library</strong> <code>ESP8266 and ESP32 OLED driver for SSD1306 display</code>, see more <a href="#install-library">Install arduino library</a></p>
</div>
<div class="paragraph">
<p><strong>Step 3: Programing</strong> We will demonstrate a digital clock on OLED Display</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;Wire.h&gt;
#include "SSD1306.h"

SSD1306  display(0x3c, 4, 5);
int thoi_gian = 0;
void setup()
{
  Serial.begin(115200);
  display.init();
  //display.flipScreenVertically(); //đảo chiều
  display.setFont(ArialMT_Plain_10);
  display.drawString(0, 0, "Hello world");
  display.display();
  delay(1000);
  display.clear();
}

void loop()
{
  int gio, phut, giay;


  delay(1000);
  thoi_gian ++;

  gio = thoi_gian/3600;
  phut = (thoi_gian%3600)/60;
  giay = thoi_gian % 60;
  display.clear();
  display.drawString(0, 0, String(gio) + ":" + String(phut) + ":" + String(giay));
  display.display();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary_3">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Through some examples with LEDs, buttons and OLED, we can extend to other uses of GPIO in ESP8266, and gain some in-depth understanding on how Arduino IDE works, how to upload and use libraries, etc.
One application that makes use of said knowledge is Flappy Bird. You can try it out here: <a href="https://github.com/esp8266vn/arduino-flappybird">https://github.com/esp8266vn/arduino-flappybird</a></p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/02-helloworld/arduino-flappybird.jpg" alt="Aduino Flappybird" width="400">
</div>
<div class="title">Figure 28. Arduino FlappyBird</div>
</div>
</div>
</div>
<h1 id="_wifi" class="sect0">ESP8266 WiFi</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>WiFi connection is ESP8266&#8217;s selling point, it can connect to existing Router at home and Access Point with the most current standard in the 2.4Ghz frequency range - in STA mode. In addition, ESP8266 also supports AP mode (Access Point), i.e. it will initiate an Access Point and allow clients to connect, or it can run in mode STA and AP mode.</p>
</div>
<div class="paragraph">
<p>STA mode is frequently used in many applications, it will connect to a local WiFi with Internet enabled and send data to a server. Other occasions see it operating in AP mode, which is is programmed to exchange data between ESP8266 and a computer (or other device with a browser), e.g. controlling a LED using ESP8266 as a Web Server</p>
</div>
<div class="paragraph">
<p>WiFi Access Point is a central networking device in charge of directing data streams, e.g. process IP packets to identify LAN address, forwarding packets from the Internet to the stations.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/router.jpg" alt="WiFi Access Point" width="400">
</div>
<div class="title">Figure 29. WiFi Access Point</div>
</div>
<div class="paragraph">
<p>A deviced connecting to an Access Point is called a Station. Any laptop or desktop with WiFi card connecting to an Access Point is identified as a Station.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/ap-sta.png" alt="WiFi Network" width="400">
</div>
<div class="title">Figure 30. WiFi Network</div>
</div>
<div class="paragraph">
<p>All Stations when attempting to connect to a Access Point need to identify a desired <code>BSSID</code>, it is commonly called <code>SSID</code> when refering to a WiFi network. A list of nearby SSIDs can be scanned on a computer when using WiFi.</p>
</div>
<div class="paragraph">
<p>The following modes will be coverd in this chapter</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Station - STA</code> mode connects to a existing Access Point.</p>
</li>
<li>
<p>Using <code>HTTPClient</code> to request and receive data from the Internet.</p>
</li>
<li>
<p><code>Access Point - AP</code> mode allows connections from other clients.</p>
</li>
<li>
<p><code>Web Server</code> running on ESP8266 for toggling LEDs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wifi_station_mode">WiFi Station Mode</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_knownledge">Knownledge</h3>
<div class="paragraph">
<p>To connect to the Internet, ESP8266 needs to connect to a local WiFi network, and this network must connect to a Internet WAN. Most modems nowsaday have WiFi Access Point intergrated, which make it easy to deploy IoT application.</p>
</div>
<div class="paragraph">
<p>ESP8266 must be in Station (STA) mode to connect to a local WiFi network, and must be supplied with a SSID and a password.</p>
</div>
<div class="paragraph">
<p>Each Access Point implements a security protocol in connections with Stations, e.g. <code>WEP</code>, <code>WPA2</code>. Howver, this would not be an issue in development since ESP8266 has pre-configured the necessary protocol.</p>
</div>
<div class="paragraph">
<p>Upon successful connection to a network, ESP8266 automatically initialise a default DHCP Client, requesting for IP before accepting any IP connection. Thus, for some reason if a DHCP Server is not available, static IP must be manually configured for ESP8266.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_to_a_local_network">Connecting to a local network</h3>
<div class="paragraph">
<p>With the provied code, if a given <code>SSID</code> and <code>PASSWORD</code> are correct and an Access Point is up and running, the module will establish a connection and print out the Serial Terminal the provided local IP of ESP866 in the LAN network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;

const char* ssid     = "your-ssid";
const char* password = "your-password";

void setup() {

  // Initiate a serial connection at 115200 bits/s
  Serial.begin(115200);
  delay(10);
  Serial.print("Connecting to ");

  // Print out the name fo the WiFi (SSID)
  Serial.println(ssid);

 // Configure the ESP8266 in station mode and connect to a pre-defined WiFi network
  WiFi.begin(ssid, password);
  // Print out . when ESP8266 trying to connect to the network
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  // Print out "WiFi connected" and IP of ESP8266
  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
}

void loop() {

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_wifimulti">Using WiFiMulti</h3>
<div class="paragraph">
<p>Nevertheless, as a precaution, having 2-3 WiFi network as backup is advisable, WiFiMulti class will prove useful. A simple monitoring function will notify other functions when a connection is made.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESP8266WiFiMulti.h&gt;
// Declare wifiMulti variable of class ESP8266WiFiMulti to use functions of this class.
ESP8266WiFiMulti wifiMulti;
// connectioWasAlive variable to check for ESP8266 wifi connection.
boolean connectioWasAlive = true;

void setup()
{
  Serial.begin(115200);
  Serial.println();
  // Add the pre-defined networks for ESP8266
  wifiMulti.addAP("primary-network-name", "pass-to-primary-network");
  wifiMulti.addAP("secondary-network-name", "pass-to-secondary-network");
  wifiMulti.addAP("tertiary-network-name", "pass-to-tertiary-network");
}

void monitorWiFi()
{
  // Check if there is no WiFi connection then set connectioWasAlive = false
  // while print out "." every 500ms when there is no connection.
  if (wifiMulti.run() != WL_CONNECTED)
  {
    if (connectioWasAlive == true)
    {
      connectioWasAlive = false;
      Serial.print("Looking for WiFi ");
    }
    Serial.print(".");
    delay(500);
  }
   // If a connection is established then set connectioWasAlive = true
  // so when the connection is terminated the program will jump into if (connectioWasAlive == true),
  // annoucing the WiFi scanning process
  else if (connectioWasAlive == false)
  {
    connectioWasAlive = true;
    Serial.printf(" connected to %s\n", WiFi.SSID().c_str());
  }
}

void loop()
{
  monitorWiFi();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_client">HTTP Client</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_http_protocol">HTTP Protocol</h3>
<div class="paragraph">
<p><code>HTTP</code> - Hypertext Transfer Protocol, is a protocol for transmitting data among computers in the <code>www</code> (World Wide Web), the data can be text, file, image, or video.</p>
</div>
<div class="paragraph">
<p>HTTP is designed for data exchange between a client and a server using TCP/IP, the working principle is <code>request/respond</code>, and <code>stateless</code>. A web browser is a client, any machine that hosts web stie is a server. A client connects to a server, sends data composed which includes headers to it. The server receives it and responds based on what it gets, the channel is terminated after each connection.</p>
</div>
<div class="paragraph">
<p>For instance, when a URL is put in the address bar and <code>Enter</code> is pressed, the Web Client will immediately send the request to the Web Server with the provided address. The Web Server will then send back the content of the web page.</p>
</div>
<div class="paragraph">
<p>In HTTP protocol, connection is only made from the client side (or HTTP Client). When the client sends the request along with the <strong>URL</strong> and the payload (what to get) to the server. Server (HTTP Server) listens for any request from the client and responds accordingly. After that, the connection is terminated.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/http1-req-res-details.png" alt="Cách thức HTTP hoạt động" width="400">
</div>
<div class="title">Figure 31. How HTTP works</div>
</div>
<div class="paragraph">
<p>When talking about HTTP, Hyperlink, or URL (Uniform Resource Locator), is a common concept.</p>
</div>
<div class="paragraph">
<p><strong>URL</strong> defines a website&#8217;s address and contains the request details from the client, which the server uses to process. Its structure is as follows:</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/http1-url-structure.png" alt="URL" width="400">
</div>
<div class="title">Figure 32. A URL structure</div>
</div>
<div class="paragraph">
<p>For instance, sending a sensor data to a server can be done via: <code>http://esp8266.vn/log.php?nhiet_do=30</code></p>
</div>
<div class="listingblock">
<div class="title">A URL structure</div>
<div class="content">
<pre class="highlightjs highlight"><code>|scheme  | host      |port |path            |query                |fragment|
 http:// server.com: 8080  /path/to/log.php ?nhiet_do=30&amp;do_am=80 #test</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>scheme</code> defines the protocol to communicate with the server, if it is <code>https</code> then it will be encrypted.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>host</code> is the server&#8217;s address.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>port</code> is where the service is provided, if not defined then port 80 will be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>path</code> information the client wants to get.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>query</code> information the client wants to send.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>fragment</code> this attribute directs the browser to a specific location.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the above URL put into the address bar, the browser will initiate a connection and send the following information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /log.php?nhiet_do=30 HTTP/1.1
Host: esp8266.vn
User-Agent: curl/7.49.1
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Received information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive

data</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On linux, curl can be used to digest raw data, type  <code>curl -v http://esp8266.vn/log.php?nhiet_do=30</code> in the terminal.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_http_defines_some_methods_for_communicating_with_server">HTTP defines some methods for communicating with Server:</h4>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> is the most common and widely used method of HTTP. <strong>GET</strong> retrieves whatever information (in the form of an entity) is identified by the URL, usually the Server returns the data based on the query information it receives without modifying it. <code>path</code> and <code>query</code> in the <strong>URL</strong> contains query information.</p>
</li>
<li>
<p><code>POST</code> Similar to <code>GET</code>, but <code>POST</code> can send data to the Server.</p>
</li>
<li>
<p><code>PUT</code> is a method for creating new resources, similar to <code>POST</code> but it informs the server that if the resource does not  exist, the server should create new resource or otherwise modify it.</p>
</li>
<li>
<p><code>DELETE</code> Similar to <code>GET</code>, but requests that the origin server deletes the resource identified by the URL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commonly used methods are <code>GET`and `POST</code>; other methods are utilised in API server (RESTful). Differences between <code>POST</code> and <code>GET</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> can be cached (saved by the browser for future use), the requested content is stored in the history and can be bookmarked.</p>
</li>
<li>
<p><code>GET</code> should not be used to send sensitive information.</p>
</li>
<li>
<p><code>GET</code> is restricted in terms of data length.</p>
</li>
<li>
<p><code>GET</code> should only be used to query for data.</p>
</li>
<li>
<p><code>POST</code> is not cached, not saved in browser history, and cannot be bookmarked.</p>
</li>
<li>
<p><code>POST</code> does not limit the payload amount.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_http_header_status_code">HTTP Header &amp; Status Code</h4>
<div class="paragraph">
<p>The response always include a header with the first line containing the Status Code <code>HTTP/1.1 200 OK</code>, i.e. status code = 200, the response is valid.
It is then followed by header pairs with information that the Server wants to exchange with the Client, which is hidden from the users. These header pairs are defined as <code>name: value</code> and are terminated with invisible control characters (<code>0x0D 0x0A</code> or <code>\r\n</code>).
In the above example, the header <code>Content-Type: text/html; charset=utf-8</code> informs the browser the return content is text, utf-8 encoding. <code>Transfer-Encoding: chunked</code> unknown data length, which is send until the server closes the connection.</p>
</div>
<div class="paragraph">
<p>Some common HTTP status code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>1xx</strong>: Informational responses. An informational response indicates that the request was received and understood. These status code is defined in <strong>HTTP/1.1</strong>, which is not available in <strong>HTTP/1.0</strong> or previous versions. These status code can be ignored. Common status codes:</p>
<div class="ulist">
<ul>
<li>
<p><strong>100 Continue</strong>: Informs the client that it can continue by sending the remainder of the request or, if the request has already been completed, ignore this response. In a POST request, the server will reject it if the body is too large. To resolve this, the client must send <strong>Expect: 100-continue</strong> after the initial header.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>2xx</strong>: Success. This class of status codes indicates the action requested by the client was received, understood, accepted, and processed successfully. Common status codes:</p>
<div class="ulist">
<ul>
<li>
<p><strong>200 OK</strong>: The request has succeeded. This can be seen in these methods <strong>GET</strong>, <strong>HEAD</strong>, <strong>POST</strong>, <strong>TRACE</strong> .</p>
</li>
<li>
<p><strong>201 Created</strong>: The request has been fulfilled, resulting in the creation of a new resource. This is used to verify <strong>PUT</strong> or <strong>POST</strong> success.</p>
</li>
<li>
<p><strong>204 No Content</strong>: The server successfully processed the request and is not returning any content.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>3xx</strong>: This class of status code indicates the client must take additional action to complete the request. Common status codes:</p>
<div class="ulist">
<ul>
<li>
<p><strong>301 Moved Permanently</strong>: The requested resource has been assigned a new permanent URI and any future references to this resource should use one of the returned URIs.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>4xx</strong>: These are intended for situations in which the error seems to have been caused by the client. The server assumes that the Client is experiencing errors with a request or an invalid resource. Common status codes:</p>
<div class="ulist">
<ul>
<li>
<p><strong>400 Bad Request</strong>: The request could not be understood by the server due to malformed syntax.</p>
</li>
<li>
<p><strong>401 Unauthorized</strong>:The request requires user authentication. The client can re-send the request a validated header. If the header includes the authentication but is still refused then the authentication data is wrong.</p>
</li>
<li>
<p><strong>403 Forbidden</strong>: The server understood the request, but is refusing to fulfill it.</p>
</li>
<li>
<p><strong>404 Not Found</strong>: The resource is invalid or cannot be found on the server.</p>
</li>
<li>
<p><strong>409 Conflict</strong>: The Server cannot complete the response because the Client intentionally modify a resource that is different to <strong>timestamp</strong> của Client. Conflicts are most likely to occur in response to a PUT request.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>5xx</strong>: These code indicate cases in which the server is aware that it has erred or is incapable of performing the request. Common status codes:</p>
<div class="ulist">
<ul>
<li>
<p><strong>500 Internal Server Eror</strong>: The server encountered an unexpected condition which prevented it from fulfilling the request.</p>
</li>
<li>
<p><strong>501 Not Implemented</strong>: The server does not recognize the request method and is not capable of supporting it for any resource.</p>
</li>
<li>
<p><strong>503 Service Unavailable</strong>: Occurs when the server is under maintenance or overloaded.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json">JSON</h3>
<div class="paragraph">
<p>is a lightweight data-interchange format. It is easy for humans to read and write. It is easy for machines to parse and generate. It is based on a subset of the JavaScript Programming Language. JSON is a text format that is completely language independent but uses conventions that are familiar to programmers of the C-family of languages, including C, C++, C#, Java, JavaScript, Perl, Python, and many others. These properties make JSON an ideal data-interchange language.</p>
</div>
<div class="paragraph">
<p>JSON is built on two structures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A collection of name/value pairs. In various languages, this is realized as an object, record, struct, dictionary, hash table, keyed list, or associative array.</p>
</li>
<li>
<p>An ordered list of values. In most languages, this is realized as an array, vector, list, or sequence.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>An object is an unordered set of name/value pairs.</p>
</li>
<li>
<p>Values are separated by , <code>,</code></p>
</li>
<li>
<p>An object (name/value) starts and ends with <code>"</code></p>
</li>
<li>
<p>All objects reside inside a pair of <code>{}</code></p>
</li>
<li>
<p>JSON data is grouped into pairs of name/value. Each name/value composes of a <code>name</code> field ( lies inside a <code>"</code>, followed by a <code>:</code>, then <code>value`field comes next (also lies inside a `"</code>. For instance: <code>"name":"John"</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "username" : "your-user-name",
    "email" : "your-email@email.com",
    "website" : "iota.edu.vn",
    "title" : "IoT Stater Cource"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bitcoin_value_monitoring_application">Bitcoin value monitoring application</h3>
<div class="paragraph">
<p>A simple application using HTTP to get Bitcoin (BTC)/USD rate form exchange market web, then display on the OLED.</p>
</div>
<div class="paragraph">
<p>There are many sites to choose from, for instance <a href="https://www.cryptocompare.com/" class="bare">www.cryptocompare.com/</a>. With the provided information, and the objective is to get the exhcnage rate of Bitcoin/USD, ESP8266 will send a HTTP Request to <a href="https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD" class="bare">min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD</a> and get back a JSON packet as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"USD":4731.44}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>USD</code> field is the desired data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most websites now offer <code>HTTP</code> encryption, basically it&#8217;s still HTTP, but the transmission process is encrypted, and verification is done before the request is sent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using HTTPS, SHA1 Fingerprint must be provied so that the Client can verify the Server. A browser can be use to access it in advance. In <code>Chrome</code>, after connecting to <a href="https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD" class="bare">min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD</a>, press Ctrl+Shift+I (Shift + ⌘ + I in MacOS), proceed to <code>Security &gt; View Certificate &gt; Details &gt; Thumbprint</code>. The result will be as follows.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/fingerprint.png" alt="HTTPS Finger print" width="500">
</div>
<div class="title">Figure 33. HTTPS Fingerprint</div>
</div>
<div class="paragraph">
<p>A source code to check for Bitcion price that repeats every 5 seconds, ESP8266 will establish a connection with Cryptocompare server to get the information and print out to the OLED display.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESP8266HTTPClient.h&gt;
#include &lt;ArduinoJson.h&gt; //https://github.com/bblanchon/ArduinoJson
#include "SSD1306.h" //https://github.com/squix78/esp8266-oled-ssd1306

const char* ssid = ".....";
const char* password = "....";
SSD1306  display(0x3c, 4, 5);
/* xem thêm https://www.cryptocompare.com/api/ */
const char* host = "https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD";
/*SHA1 fingerprint*/
const char* fingerprint = "61 DE E9 FF BB 6B AD AA E4 9A 38 95 DC EC 74 2C 61 4B 7D 07";

void getBitcoin()
{
  HTTPClient http;
  Serial.print("connecting to ");
  Serial.println(host);

  http.begin(host, fingerprint);
  int httpCode = http.GET();
  if (httpCode == HTTP_CODE_OK) {
    String payload = http.getString();
    Serial.println(payload);
    StaticJsonBuffer&lt;512&gt; jsonBuffer;
    JsonObject&amp; root = jsonBuffer.parseObject(payload);
    if (!root.success()) {
      Serial.println("parseObject() failed");
      return;
    }

    double priceUSD = root["USD"];
    display.clear();
    display.drawString(0, 0, "Bitcoin price");
    display.drawString(0, 18, String(priceUSD));
    display.display();
    Serial.println(priceUSD);
  }
  http.end();
}

void setup() {
  Serial.begin(115200);
  display.init();
  display.clear();
  display.setFont(ArialMT_Plain_16);
  display.drawString(0, 0, "Connecting to");
  display.drawString(0, 18, ssid);
  display.display();
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  display.clear();
  display.drawString(0, 0, "Connected");
  display.display();
}

void loop() {
  if (WiFi.status() == WL_CONNECTED) {
    getBitcoin();
  }
  delay(5000);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/btc.png" alt="BTC Price" width="500">
</div>
<div class="title">Figure 34. Check for Bitcoin value every 5 seconds</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wifi_access_point_mode">WiFi Access Point Mode</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_esp8266_in_access_point_mode">ESP8266 in Access Point Mode</h3>
<div class="paragraph">
<p>ESP8266 allows other devices (Station - STA) to connect when operating as an Access Point. It can initiate a local WiFi network with DHCP Client enabled to assign IP to connected Clients. Due to RAM constraints, maximum number of STA concurrent connections is 5.</p>
</div>
<div class="sect3">
<h4 id="_initiate_a_network">Initiate a network</h4>
<div class="paragraph">
<p><code>&lt;ESP8266WiFi.h&gt;</code> is needed, this library contains <code>softAP</code> which is used to configure soft Access Point (soft AP) for a WiFi network.</p>
</div>
<div class="paragraph">
<p>A simple WiFi network only needs to provide SSID without password <code>WiFi.softAP(ssid)</code>. If a password is desired, <code>WiFi.softAP(ssid, password)</code> can be called. More options are available using <code>WiFi.softAP(ssid, password, channel, hidden)</code>, default channel is 1 and initially hidden, which can be made invisible by setting <code>hidden = true</code></p>
</div>
<div class="paragraph">
<p><code>ssid</code> should not exceed 63 characters, and the (optional) password is at least 8 characters long for WPA2-PSK</p>
</div>
<div class="paragraph">
<p><code>softAP</code> will return <code>true</code> if the WiFi network is successfully established</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the WiFi network created by calling <code>softAP</code> will have a default IP of <code>192.168.4.1</code> and run a DHCP Server to provide connected clients with IP in the <code>192.168.1.x</code> range. The default IP can be modified by calling <code>softAPConfig</code>. Moreover, ESP8266 can operate in both Station and Access Point modes. Take note that the two modes operate on the same channel, softAP channel will be utilised by Station mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>WiFi.softAPConfig (local_ip, gateway, subnet)</code> is used to modify Access Point IP.</p>
</div>
<div class="listingblock">
<div class="title">Modify ESP8266 AP&#8217;s IP to <code>192.168.4.22</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">IPAddress local_IP(192,168,4,22);
IPAddress gateway(192,168,4,9);
IPAddress subnet(255,255,255,0);
WiFi.softAPConfig(local_IP, gateway, subnet)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>WiFi.softAPgetStationNum()</code> returns the number of clients connecting to the Access Point</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_establish_wifi_network_using_esp8266">Establish WiFi network using ESP8266</h3>
<div class="paragraph">
<p>With the following code, a local WiFI network with a SSID of <code>AP-XXXXXX</code> is established and available for connection for computers using the <code>password</code> password</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;

const char *password = "password";

void setup() {
  Serial.begin(115200);
  Serial.print("Configuring access point...");
  char ssid[64];
  sprintf(ssid, "AP-%06X", ESP.getChipId());
  WiFi.softAP(ssid, password);

  IPAddress myIP = WiFi.softAPIP();
  Serial.print("AP IP address: ");
  Serial.println(myIP);
}

void loop() {
  Serial.printf("Stations connected = %d\n", WiFi.softAPgetStationNum());
  delay(3000);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/03-wifi/ap.png" alt="WiFiAccesspoint" width="200">
</div>
<div class="title">Figure 35. When initiating a WiFiAccesspoint</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="web-server">Web Server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_web_server">What is Web Server?</h3>
<div class="paragraph">
<p>When there is a request from a Web Client (e.g. Web Browser), a Web Server will respond and analyse it based on the information it recevies. Web Servers process mostly HTML, JavaScript, CSS, JSON, and other binary data.</p>
</div>
<div class="paragraph">
<p>Web Servers usually process requests on Port 80, and Port 443 for websites with <code>HTTPS</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_html_javascript_css">HTML - Javascript - CSS</h3>
<div class="paragraph">
<p>HTML, Javascript, and CSS are a triad of cornerstone technologies for web development. Some basic knowledge about these would be a benefit for the upcoming chapters.</p>
</div>
<div class="sect3">
<h4 id="_html">HTML</h4>
<div class="paragraph">
<p>An acronym for <strong>Hyper Text Markup Language</strong>, HTML is used for document structuring, defining title, tables, or embedding images and other objects into a web page. Each webpage has various links to other webpages called <code>hyperlinks</code>. Each page is made of different <code>tags</code>, with each tag defined as follows</p>
</div>
<div class="listingblock">
<div class="title">A tag structure</div>
<div class="content">
<pre class="highlightjs highlight"><code>&lt;tagname&gt; nội dung tag...&lt;/tagname&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tags come in pair, starting with &lt;tagname&gt; and ending with &lt;/tagname&gt;</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ending tag must have a forward slash <code>/</code> in front of its name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A simple HTML page is arranged as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Page Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;h1&gt;This is a Heading&lt;/h1&gt;
	&lt;p&gt;This is a paragraph.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some basic tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;!DOCTYPE html&gt;</code> defines the page as HTML5.</p>
</li>
<li>
<p><code>&lt;html&gt;</code> root of a HTML page.</p>
</li>
<li>
<p><code>&lt;head&gt;</code> contains metadata.</p>
</li>
<li>
<p><code>&lt;title&gt;</code> title of the page.</p>
</li>
<li>
<p><code>&lt;body&gt;</code> the content that will be presented.</p>
</li>
<li>
<p><code>&lt;h1&gt;</code> header type 1.</p>
</li>
<li>
<p><code>&lt;p&gt;</code> paragraph.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_javascript">Javascript</h4>
<div class="paragraph">
<p>Javascript is a language designed to make a website interactive, and for Web application (Web App)</p>
</div>
<div class="paragraph">
<p>JavaScript application can be embedded directly into a web&#8217;s HTML. Depending on particular purposes, script can run when accessing a webpage, clicking, typing, sendind forms, updating data, communicating with database.</p>
</div>
<div class="paragraph">
<p>To embed a Javascript program into a HTML page, a <code>&lt;script&gt;</code> is added withh <code>type</code> element. This can be done inside <code>&lt;head&gt;</code> or <code>&lt;body&gt;</code> of the HTML content. Below is an example on how to implement Javascript inside the &lt;body&gt;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;My first JavaScript page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;


  &lt;script type="text/javascript"&gt;
    // Javascript code is written here
    // before &lt;/body&gt;
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_css">CSS</h4>
<div class="paragraph">
<p>CSS stands for <strong>Cascading Style Sheets</strong>, a language for web layout design, which is used to enhance a webpage&#8217;s presentation. CSS can control the colour, font, size, spacing, and background, etc. of a web document.</p>
</div>
<div class="paragraph">
<p>A example CSS snippet with 4 parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">selector {
   property-a: value-x;
   property-b: value-y;
   .....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A CSS implementation in HTML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;My first JavaScript page&lt;/title&gt;
  &lt;style&gt;
    .class-select {
      background-color: red;
    }

    #id-select {
      background-color: green;
    }

    div {
      color: blue;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="id-select"&gt; css select by id &lt;/div&gt;
  &lt;div class="class-select"&gt; css select by class &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above HTML document, tag div with id = <code>id-select</code> will have a green background, tag div with class = <code>class-select</code> will have a red background, and all div tag will have a green font.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_a_led_using_webserver">Controlling a LED using WebServer</h3>
<div class="paragraph">
<p>ESP8266 can act as a Web Server to process any request, which can be controlled and configured.</p>
</div>
</div>
<div class="sect2">
<h3 id="_esp8266_web_server">ESP8266 Web Server</h3>
<div class="paragraph">
<p>With this application, ESP will initiate a Web Server. When there is a client establishing a connection, ESP8266 will send back a HTML with options for the client to toggle LEDs on the board.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESP8266WebServer.h&gt;

const char* ssid = "........";
const char* password = "........";
const int led = 16; //LED pin = gpio16
/* HTML sent to the clien */
const char *html = \
"&lt;html&gt;\
  &lt;head&gt;\
    &lt;title&gt;ESP8266 Webserver&lt;/title&gt;\
  &lt;/head&gt;\
  &lt;body&gt;\
    &lt;a href=\"/on\"&gt;ON&lt;/a&gt;\
    &lt;a href=\"/off\"&gt;OFF&lt;/a&gt;\
  &lt;/body&gt;\
&lt;/html&gt;";

/* Web Server listening on port 80 */
ESP8266WebServer server(80);

/* The function is called when the browser queries '/on'
 * turn on the LED (0 = on), the redirect the browser
 * back to the main page '/'
 */
void handleOn() {
  digitalWrite(led, 0);
  server.sendHeader("Location","/");
  server.send(301);
}

/* The function is called when the browser queries '/off'
 * turn off the LED (1 = off), the redirect the browser
 * back to the main page '/'
 */
void handleOff() {
  digitalWrite(led, 1);
  server.sendHeader("Location","/");
  server.send(301);
}

/* The function is called when the browser queries the main page '/'
 * send the HTML content, providing the options to toggle the LED
 */
void handleRoot() {
  server.send(200, "text/html", html);
}

void setup(void){
  pinMode(led, OUTPUT);
  digitalWrite(led, 0);
  Serial.begin(115200);
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("");
  Serial.print("Connected to ");
  Serial.println(ssid);
  Serial.print("IP address: ");

   /* We can scan for ESP8266's IP
   * using the following function
   */
  Serial.println(WiFi.localIP());

  server.on("/", handleRoot);
  server.on("/on", handleOn);
  server.on("/off", handleOff);
  server.begin();
  Serial.println("HTTP server started");
}

void loop(void){
  server.handleClient();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_combining_wifi_api_and_web_server">Combining WiFi API and Web Server</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_exchange_between_2_esp8266">Data exchange between 2 ESP8266</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usually, communication between two ESP8266 or more requires existing router or access point, these modules then connect to a single access point and start talking to each other.</p>
</div>
<div class="paragraph">
<p>Some applications requires no Access Point when connecting 2 ESP8266 together. We can configure one board to act as an Access Point which then creates a TCP Server. Another will act as a usual WiFi Client which then connects to the previously created WiFi, and then initialise a TCP Client to connect to the TCP Server.</p>
</div>
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>No router or access point is needed, Communication between two ESP8266 is done in a WiFi network, they will exchange data every second, and then print on the Serial Terminal</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_procedure">Procedure</h3>
<div class="paragraph">
<p>Requirements for 2 ESP8266 in operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A ESP8266 will start <em>SoftAP</em> to create a WiFi network, then initialise a TCP Port for a Server.</p>
</li>
<li>
<p>Another ESP8266 acts as a client in <em>WiFi Station</em> mode and connects to the ESP8266 server above.</p>
</li>
<li>
<p>Per second, the two will communicate with each other, the one that receive data with print out to the Serial port and send an acknowledgement.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_code">Code</h3>
<div class="listingblock">
<div class="title">P2P server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;

#define PORT  23
// Limit the maximum clients
#define MAX_CLIENTS 3

// Name and passwork of the ESP8266 AP
const char *ssid = "yourSSID";
const char *password = "yourPassword";

// Creating IP address
IPAddress local_IP(192, 168, 4, 1);
IPAddress gateway(192, 168, 4, 1);
IPAddress subnet(255, 255, 255, 0);

// Creating port for client connection.
WiFiServer server(PORT);
WiFiClient clients[MAX_CLIENTS];

void setup() {
  Serial.begin(115200);
  Serial.println();
  Serial.print("Setting soft-AP configuration ... ");

  // Configure acces point and soft AP to allow client connection.
  WiFi.softAPConfig(local_IP, gateway, subnet);
  WiFi.softAP(ssid, password);

  // Print out local_IP of the AP.
  Serial.print("AP IP address: ");
  Serial.println(WiFi.softAPIP());
  Serial.println("Telnet server started");
  server.begin();
}

void loop() {
  uint8_t i;
  // Check the status of the new client connection
  if (server.hasClient())  {
    for (i = 0; i &lt; MAX_CLIENTS; i++) {
      if (!clients[i] || !clients[i].connected())
      { if (clients[i]) clients[i].stop();
        clients[i] = server.available();
        Serial.print("New client: "); Serial1.print(i);
        continue;
      }
    }
    WiFiClient serverClient = server.available();
    serverClient.stop();
  }
   // Compare the number of existing clients with MAX_CLIENTS
  // including connected clients and available clients
  // read data from the clients, and then respond.
  for (i = 0; i &lt; MAX_CLIENTS; i++) {
    if (clients[i] &amp;&amp; clients[i].connected()) {
      if (clients[i].available()) {
        String line = clients[i].readStringUntil('\r');
        Serial.print("Server receive from Client:");
        Serial.println(line);

        // Send the resonse back to the client
        String resp = String(line.reserve(line.length() - 1));
        Serial.print(" Then, response back to client:");
        Serial.println(resp);
        clients[i].write(resp.c_str());
        Serial.println();
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">P2P client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include "ESP8266WiFi.h"
// Name and password of the ESP8266 AP acting as a server
const char *ssid = "yourSSID";
const char *password = "yourPassword";

IPAddress server_ip(192, 168, 4, 1);
#define PORT  23
// Port 23 is the ESP8266 AP port.
WiFiClient client;

void setup() {
  uint8_t i = 0;
  Serial.begin(115200);
  WiFi.begin(ssid, password);

  Serial.print("\nConnecting to ");
  Serial.println(ssid);

  // Check the connection status, if none is established,
  // print out "connecting..." on the Serial Terminal.
  while (WiFi.status() != WL_CONNECTED) {
    Serial.println("Connecting...");
    delay(500);
  }
}

unsigned long previousMillis = 0;
void loop() {
  if (WiFi.status() == WL_CONNECTED) {
    // Check client(STA) connection status.
    // Continously check connection using IP and port of the AP,
    // if fail then print out "connection failed" on the Serial Terminal.
    while (!client.connected()) {
      if (!client.connect(server_ip, PORT)) {
        Serial.println("connection failed");
        delay(1000);
        return;
      }
    }
    // If client(STA) has connected to the server(AP) then read all data
    // until reaching \r and print out all received data.
    while (client.available()) {

      String line = client.readStringUntil('\r');
      Serial.print("Client receive from Server:");
      Serial.println(line);
    }
    //Send PING to server every 1000ms.
    unsigned long currentMillis = millis();
    if (currentMillis - previousMillis &gt;= 1000) {
      previousMillis = currentMillis;
      client.write("PING\r");
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Proceed after checking the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary_4">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter, we have gone through all ESP8266 modes, protocols such as TCP/IP, HTTP and the HTML, CSS, Javascript trio languages. Other than some demonstrations using ESP8266 as a HTTP Client above, HTTPClient can connect to a custom-built server, send sensor data, as well as receiving data to process.</p>
</div>
<div class="paragraph">
<p>WiFi Access Point mode and Web Server running on ESP8266 are ususally used to configure products&#8217;s specs. All computers with a web interface can access it and provice the applications with sophisticated data.</p>
</div>
</div>
</div>
<h1 id="_DHT11_logger" class="sect0">Temperature and Humidity Monitor using DHT11, ESP8266 and Node.js server</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>In this project, using DHT11 temperature and humidity sensor, we will build a small circuit to monitor the temperature and humidity of the surroundings. That data will be sent back to PC and we can read that data on an Arduino IDE terminal. We can also visit a given URL to view it and its plot on a web interface.
Some background knowledge:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The temperature</strong> is a physical quantity expressing the subjective perceptions of <code>hot and cold</code>. Temperature is measured with a thermometer, historically calibrated in various temperature scales and units of measurement. The most commonly used scales are the Celsius scale, denoted in °C (informally, degrees centigrade), the Fahrenheit scale (°F), and the Kelvin scale. The Kelvin (K) is the unit of temperature in the International System of Units (SI), in which temperature is one of the seven fundamental base units. In Vietnam and most of the world, the Celsius scale is used for most temperature measuring purposes. We are using °C in this project.</p>
</li>
<li>
<p><strong>The relative humidity</strong> is the ratio of the partial pressure of water vapor to the equilibrium vapor pressure of water at a given temperature. Relative humidity is normally expressed as a percentage; a higher percentage means that the air–water mixture is more humid.</p>
</li>
<li>
<p><strong>The DHT11</strong> is a basic and low-cost digital temperature and humidity sensor. It&#8217;s fairly simple to use and we can grab its data with 1-WIRE Protocol.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_project_diagram">The Project Diagram</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following diagram shows an overview of this project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/projectIntro.png" alt="projectIntro" height="596">
</div>
<div class="title">Figure 36. The overview of the project</div>
</div>
<div class="paragraph">
<p>In practice, when designing the application, we should notice that users usually need a user-friendly graphical interface with many useful functions such as chart or graph illustrations, data extraction in desired time intervals, the database storing or 1-click device states control from PC,&#8230;&#8203; Many larger and more complex projects will also need different methods to manage their connections and data.</p>
</div>
<div class="paragraph">
<p>To help you deal with those problems, we will guide you build a temperature and humidity monitoring application with capabilities of sending data back to a given web server and displaying it on a website. This is a simple, useful and easy IoT application, which will provide us with some basics on sensors data collecting and web server building.</p>
</div>
<div class="sect2">
<h3 id="_requirements_2">Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>DHT11: Collecting the environment temperature and humidity data; Connecting and sending data to ESP8266.</p>
</li>
<li>
<p>ESP8266: Connecting to a WiFi Access Point and sending data to an HTTP server; displaying data on Arduino terminal screen.</p>
</li>
<li>
<p>Basic functions of HTTP server: Displaying current temperature and humidity on PC screen.</p>
</li>
<li>
<p>Advanced functions of HTTP server: Storing sensor data; interpreting users' requests and returning a result HTML file to view on web browsers.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_project_analysis">Project Analysis</h3>
<div class="ulist">
<ul>
<li>
<p>We will need a web server written in Javascript and implemented by Node.js and it will keep listening to a given port on PC. In this project, we are using port 8000.</p>
</li>
<li>
<p>ESP8266 and your PC must connect to the same WiFi Access Point. ESP8266 also need to know your PC&#8217;s IP to access the PC&#8217;s server. In this project, our PC&#8217;s IP is <code>192.168.1.102</code> .</p>
</li>
<li>
<p>After successfully connected to a WiFi Access Point, ESP8266 will read the current temperature and humidity data from DHT11 and send to the server every 2 seconds.</p>
</li>
<li>
<p>Using <code>GET</code> method, web server can receive data from ESP8266. For example, <code>http://192.168.1.102/update?temp=25&amp;humd=80</code>, <code>192.168.1.102</code> is the web server IP address, <code>/update</code> is a path, <code>temp=20</code> and <code>humd=80</code> contain the temperature "20°C" and humidity "80%".</p>
</li>
<li>
<p>Web Server returns the HTTP Status = 200 (OK) and displays a logging window with current temperature and humidity.</p>
</li>
<li>
<p>Advanced Functions:&#8201;&#8212;&#8201;Web Server saves data in an array variable in RAM.&#8201;&#8212;&#8201;Web Server returns an <code>index.html</code> file to user with a special Javascript code to get the data stored in RAM and visualize it on screen.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_project_related_knowledge">Project-related Knowledge</h3>
<div class="paragraph">
<p>It would be easier to understand if you already had some basics about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Communicating between ICs with 1-Wire Protocol.</p>
</li>
<li>
<p>Using Javascript and Node.js to build a simple web server.</p>
</li>
<li>
<p>Building a simple HTML website to display sensor data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, do not get too worried when you have never done such things before, you&#8217;ll understand them more thoroughly while reading the next parts.</p>
</div>
<div class="paragraph">
<p><strong>DHT11 Sensor and 1-Wire Communication Protocol</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHT11 is a widely used, low-cost and high-stability sensor and is usually used to measure the temperature and humidity of the environment. It uses 1-Wire Communication Protocol to send data to microcontroller. For more information, visit the manufacturer&#8217;s datasheet:
<a href="http://www.micropik.com/PDF/dht11.pdf"><strong>Datasheet</strong></a></p>
</li>
<li>
<p>1-Wire is a device communication bus system designed by Dallas Semiconductor Corp. that provides low-speed data, signaling, and power over a single conductor. One distinctive feature of the bus is the possibility of using only 2 wires: data and ground. Like other communication protocols, a signal sequence of 1-Wire contains 3 steps: request &#8594; respond &#8594; data reading.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A detailed signal diagram is shown below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/DHT11TimingDialog.png" alt="DHT11TimingDialog" width="981">
</div>
<div class="title">Figure 37. The data timing diagram of 1-Wire</div>
</div>
<div class="paragraph">
<p>Summary:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the Master (ESP8266) sends the <code>START</code> signal, DHT11 will transition from low-power mode to high-speed mode.</p>
</li>
<li>
<p>DHT11 receives the signal and responds to the master, then the Master starts the data transmission.</p>
</li>
<li>
<p>During a signal period, DHT11 sends a 40 bits data packet to the bus.</p>
</li>
<li>
<p>If the Master wants to end the transmission, it will send a <code>STOP</code> signal and the process will stop.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, visit <a href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/1796"><strong>maximintegrated.com</strong></a></p>
</div>
<div class="paragraph">
<p><strong>HTML Language</strong></p>
</div>
<div class="paragraph">
<p>A popular website to help newbies learn HTML is <a href="https://www.w3schools.com/html/default.asp"><strong>w3school.com/HTML</strong></a>. But you shouldn&#8217;t dive into learning HTML at this moment because it would take a long time to completely master it. You only need to learn some basic features of HTML to complete this project.</p>
</div>
<div class="paragraph">
<p><strong>Node.js and Javascript</strong></p>
</div>
<div class="paragraph">
<p>To create a Node.js server, you need to know some basics of Javascript and Node.js. To learn Javascript, you can visit <a href="https://www.w3schools.com/js/default.asp"><strong>w3school.com/Javascript</strong></a>. A useful website for newbies to learn Node.js is <a href="https://www.codeschool.com/courses/real-time-web-with-node-js"><strong>codeschool.com</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_building_the_project">Building the Project:</h3>
<div class="paragraph">
<p><strong>Required Components</strong></p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> DHT11 sensor.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> ESP8266 WiFi Uno Board.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Male-to-Female Jumper Wires.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> 5k Ohm Resistors.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> USB micro-B cable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Wiring</strong></p>
</div>
<div class="paragraph">
<p>Using the following diagram to assemble the circuit.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/DHT11Connect.png" alt="DHT11Connect" height="511">
</div>
<div class="title">Figure 38. Wiring the DHT11 and ESP8266 WiFi Uno Board.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-nodejs">Server Nodejs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On Server side, we need to ensure that the server can serve many clients.
If <code>path</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/update</code>: server will add new sensor data to database and display it on the screen.</p>
</li>
<li>
<p><code>/get</code>: server will return a JSON string of stored data.</p>
</li>
<li>
<p><code>/</code>: return the <code>index.html</code> file.</p>
</li>
<li>
<p>The structure of stored array on RAM: <code>[{"temp": 25, "humd":80, time: "time"}, ...]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><code>server.js</code> source code</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">//---------------------------------------------------------------------------------------------
var fs = require('fs');
var url = require('url');
var http = require('http');<i class="conum" data-value="1"></i><b>(1)</b>
var querystring = require('querystring');
var db = []; // Declare a database array variable.
//---------------------------------------------------------------------------------------------
// This function is used to handle client's request and return a response from server.
function requestHandler(request, response) {

    // An example request: http://192.168.1.7:8000/update?temp=30&amp;humd=40
    var uriData = url.parse(request.url);
    var pathname = uriData.pathname;          // /update?
    var query = uriData.query;                // temp=30.5&amp;hum=80
    var queryData = querystring.parse(query); // queryData.temp = 30.5, queryData.humd = 40
    //-----------------------------------------------------------------------------------------
    if (pathname == '/update') {
        var newData = {
            temp: queryData.temp,
            humd: queryData.humd,
            time: new Date()<i class="conum" data-value="2"></i><b>(2)</b>
        };
        db.push(newData);
        console.log(newData);
        response.end();
    //-----------------------------------------------------------------------------------------
    } else if (pathname == '/get') {<i class="conum" data-value="3"></i><b>(3)</b>
        response.writeHead(200, {
            'Content-Type': 'application/json'
        });
        response.end(JSON.stringify(db));
        db = [];
    //-----------------------------------------------------------------------------------------
    } else { <i class="conum" data-value="4"></i><b>(4)</b>
        fs.readFile('./index.html', function(error, content) {
            response.writeHead(200, {
                'Content-Type': 'text/html'
            });
            response.end(content);
        });
    }
    //-----------------------------------------------------------------------------------------
}
var server = http.createServer(requestHandler);
server.listen(8000); <i class="conum" data-value="5"></i><b>(5)</b>
console.log('Server listening on port 8000');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Explanation</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>require</code> is used to load necessary modules or libraries.
<div class="ulist">
<ul>
<li>
<p><code>fs</code>: This module helps us read file from server or upload file</p>
</li>
<li>
<p><code>url</code>: Divide URL into easy-to-access parts.</p>
</li>
<li>
<p><code>http</code>: HTTP Communication Protocol.</p>
</li>
<li>
<p><code>querystring</code>: Module have to convert string to object.</p>
</li>
<li>
<p><code>db = []</code>: An array variable to store temperature and humidity values.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This function will respond differently depending on the <code>pathname</code>. If <code>pathname=/update</code>, this function will create a <code>newData</code> variable and get data in client&#8217;s request. Then it will push data to <code>db</code> variable using <code>db.push(newData)</code> command and that data will be display on logging screen when using <code>console.log(newData)</code>. <code>Date()</code> function helps us get current time and date.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return the JSON format <code>('Content-Type': 'application/json')</code> of db variable if <code>pathname = /get</code>, then it deletes value of db. <code>response.end()</code> function returns HTTP code = 200 (OK)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Return the <code>index.html</code> file if user doesn&#8217;t use /update and /get. <code>fs</code> library is used to read <code>index.html</code> file and assign that file&#8217;s content to <code>content</code> with <code>fs.readFile('./index.html', function(error, content)</code> command. <code>response.writeHead(200, {'Content-Type': 'text/html' })</code> defines the HTTP code "200" and the response type "HTML" to read file on user&#8217;s browser.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Start the HTTP server and open port 8000 on server to listen for client&#8217;s request.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, you should change to <code>server.js</code> directory and run <code>node server.js</code> on your terminal, then visit <a href="http://localhost:8000" class="bare">localhost:8000</a> on your web browser to view your <code>index.html</code> file. Or visit <a href="http://localhost:8000/update?temp=20&amp;humd=60" class="bare">localhost:8000/update?temp=20&amp;humd=60</a> to see the result on your logging screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{ temp: '20', humd: '60', time: 2017-08-21T16:56:23.358Z }
{ temp: '20', humd: '60', time: 2017-08-21T16:57:06.277Z }
{ temp: '20', humd: '60', time: 2017-08-21T16:57:17.708Z }</pre>
</div>
</div>
<div class="paragraph">
<p>While doing the basic function above, you don&#8217;t need to understand the <code>index.html</code> and its Javascript code. Also, you&#8217;ve just handled the <code>\update</code> path, not <code>\get</code> or <code>/\*</code>. The <code>\update</code> is enough to run the basic function.
In the advanced sections, we are building a popular function of the application. That&#8217;s the data visualization on user&#8217;s web browser. To achieve that, we will create an <code>index.html</code> file with Javascript codes. Those Javascript codes will request server to return data every 2 seconds and illustrate it in graph.</p>
</div>
<div class="paragraph">
<p><strong><code>index.html</code> file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;<i class="conum" data-value="1"></i><b>(1)</b>
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;DHT11&lt;/title&gt;
    &lt;!-- Use a Javascript code at src destination to illustrate data in graph --&gt;
    &lt;script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"&gt;&lt;/script&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt; 1. TEMPERATURE AND HUMIDITY MEASUREMENTS:&lt;/h&gt;&lt;br&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;h2&gt; Temperature&lt;/h2&gt; &lt;input type="text" size="6" id="temp"&gt;&amp;#176;C&lt;br&gt;
        &lt;h2&gt; Humidity&lt;/h2&gt; &lt;input type="text" size="6" id="humd"&gt;%&lt;br&gt;
        &lt;h1&gt; 2. CHART OVER TIME: &lt;/h1&gt;&lt;br&gt;
        &lt;!-- Configure the graph's size via "ChartContainer" ID --&gt;
        &lt;div id="ChartContainer" style="height: 300px; width:80%;"&gt;&lt;/div&gt;
        &lt;script type="text/javascript"&gt;
            function httpGetAsync(theUrl, callback) { <i class="conum" data-value="4"></i><b>(4)</b>
                        var xmlHttp = new XMLHttpRequest();
                        xmlHttp.onreadystatechange = function() {
                    if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200)
                        callback(JSON.parse(xmlHttp.responseText));
                }
                xmlHttp.open("GET", theUrl, true); // true for asynchronous
                xmlHttp.send(null);
            }

            window.onload = function() {
                var dataTemp = [];
                var dataHumd = [];

                var Chart = new CanvasJS.Chart("ChartContainer", {
                    zoomEnabled: true, // Enable this attribute to zoom in the graph.
                    title: {
                        text: "Temperature &amp; Humidity" // Graph's tittle
                    },
                    toolTip: { // Display temperature and humidity simultaneously
                        shared: true
                    },
                    axisX: {
                        title: "chart updates every 2 secs" // X-axis label
                    },
                    data: [{
                            // Define the dataTemp's and dataHumd's attribute.
                            type: "line", // Choose "line" graph type.
                            xValueType: "dateTime", // Display "time" data on X axis.
                            showInLegend: true, // Display "temp" at graph legend.
                            name: "temp",
                            dataPoints: dataTemp // Choose the data source to plot. In this case, "dataTemp".
                        },
                        {
                            type: "line",
                            xValueType: "dateTime",
                            showInLegend: true,
                            name: "humd",
                            dataPoints: dataHumd
                        }
                        ],
                    });
                var yHumdVal = 0; // Declare a variable to store the humidity value on Y Axis.
                var yTempVal = 0; // Declare a variable to store the temperature value on Y Axis.
                var updateInterval = 2000; // The update interval, 2000ms = 2s
                var time = new Date(); // Get current date.

                var updateChart = function() {
                    httpGetAsync('/get', function(data) {

                        // Assign the value from localhost:8000/get to display on a textbox
                        document.getElementById("temp").value = data[0].temp;
                        document.getElementById("humd").value = data[0].humd;

                        // Print received values from localhost:8000/get to console
                        console.log(data);
                        // Update the time and get new temperature, humidity value.
                        time.setTime(time.getTime() + updateInterval);
                        yTempVal = parseInt(data[0].temp);
                        yHumdVal = parseInt(data[0].humd);
                        dataTemp.push({ // Push new data from server.
                            x: time.getTime(),
                            y: yTempVal
                        });
                        dataHumd.push({
                            x: time.getTime(),
                            y: yHumdVal
                        });
                        Chart.render(); // Convert the data to graph on screen.
                    });
                };
                updateChart(); // Run the first time
                setInterval(function() { // Update the graph every "updateInterval" seconds.
                    updateChart()
                }, updateInterval);
            }
        &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Explanation</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Some basic tags to set up your HTML file in the beginning:
<div class="ulist">
<ul>
<li>
<p><code>&lt;!DOCTYPE html&gt;</code>          : This is an instruction to the web browser about what version of HTML the page is written in.</p>
</li>
<li>
<p><code>&lt;html&gt;</code>                   : Tell the browser that this is an HTML document.</p>
</li>
<li>
<p><code>&lt;head&gt;</code>                   : This is a container for metadata. Metadata typically define the document title, character set, styles, links, scripts, and other meta information.</p>
</li>
<li>
<p><code>&lt;meta charset="UTF-8"&gt;</code>   : Define the character set used:</p>
</li>
<li>
<p><code>&lt;title&gt;DHT11&lt;/title&gt;</code>     : Define the title of the document.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use CanvasJS Chart to draw temperature and humidity graph.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create 2 text boxes in &lt;h1&gt; heading to display current value of temperature and humidity. Each text box has a unique <code>id</code> to get sensor data from server. The <code>&amp;#176;C</code> means <code>°C</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get data from server using this function.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Graph Analysis</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <code>&lt;script&gt; JS code &lt;/script&gt;</code> tag in your HTML file, you can get data from server and visualize it in graph.</p>
</li>
<li>
<p>You can get data by executing <code>httpGetAsync()</code> function. This function use <code>XMLHttpRequest</code> object to get data from server without reload webpage. Because the data <code>xmlHttp.responseText</code> returned from <code>localhost:8000/get</code> is formatted in JSON, you need to use <code>JSON.parse()</code> to convert it to <code>Object</code> type.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ESP8266 must have sent data to server, or localhost:8000/get won&#8217;t return values.
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/imageJSON.png" alt="imageJSON" width="487">
</div>
<div class="title">Figure 39. An example of data at <code>localhost:8000/get</code></div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>window.onload = function()</code> to reload the graph, we have explained at the end of each line.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Visit <a href="https://canvasjs.com/javascript-charts/" class="bare">canvasjs.com/javascript-charts/</a> for more graphs and choose suitable ones for your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>The finished HTML file</strong></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/graphHtml.png" alt="graphHtml" width="437">
</div>
<div class="title">Figure 40. An HTML interface.</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_on_esp8266">Code on ESP8266</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ESP8266 uses HTTPClient library to make a connection and send DHT11 <code>temp</code> and <code>humd</code> data to web server via <code>GET</code> method.</p>
</div>
<div class="sect2">
<h3 id="_preparation_2">Preparation:</h3>
<div class="ulist">
<ul>
<li>
<p>A local WiFi Access Point&#8217;s SSID and Password.</p>
</li>
<li>
<p>An IP and Port of Web Server.</p>
</li>
<li>
<p>A library to help us get data from DHT11. Because of the popularity of the DHTXX sensors, many libraries have been released to support users. In this project, we are using the <code>DHT sensor library</code> of Adafruit.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/install-lib.png" alt="install lib" height="900">
</div>
<div class="title">Figure 41. DHT sensor library</div>
</div>
<div class="paragraph">
<p><strong>Source code on ESP8266</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;DHT.h&gt;            // Include the DHT library to read DHT11 sensor data.
#include &lt;ESP8266WiFi.h&gt;    // Include this library to configure ESP8266 as a client.
#define DHTPIN 4            // Define the GPIO 4 to receive data from DHT11.
#define DHTTYPE DHT11       // Define the type of DHT sensor. In this case, DHT11.

DHT dht(DHTPIN, DHTTYPE);
WiFiClient client;                        // Declare the "client" variable of "WiFiClient" type.
const char* ssid = "YOUR-WIFI-SSID";      // Declare the SSID or your WiFI Access Point's name.
const char* password = "YOUR-WIFI-PASS";  // Declare the WiFi password of the above WiFi AP.
const char* server = "Your-local-IP";     // Declare your web server IP or your PC's IP.
const int port = 8000;                    // Declare the port on server to be opened for listening.
const int sendingInterval = 2 * 1000;     // Declare the interval time in microseconds between two successive measurements.

void setup() {
  Serial.begin(115200);
  dht.begin();                            // Initiate the DHT11 sensor.
  Serial.println("Connecting");


  // Configure ESP8266 as a Station and connect to a WiFi AP. Continuously print . on the terminal if it hasn't successfully connected to our WiFi AP.
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(100);
  }
  Serial.println("\r\nWiFi connected");
}

void loop() {

// Read the temperature (in Celsius Scale) and humidity. If the sensor fails to read, print out an error message and skip the current loop.
  float temp = dht.readTemperature();
  float humi = dht.readHumidity();
  if (isnan(temp) || isnan(humi)) {
    Serial.println("Failed to read from DHT sensor!");
    return;
  }

  if (client.connect(server, port)) {           // Initiate a connection to a server with a given IP and PORT.
  //---------------------------------------------------------------------------------------
    String req_uri = "/update?temp=" + String(temp, 1) + "&amp;humd=" + String(humi, 1);
    client.print("GET " + req_uri + " HTTP/1.1\n" + "Host: "+ server +"\n" + "Connection: close\n" + "Content-Length: 0\n" +"\n\n");   <i class="conum" data-value="1"></i><b>(1)</b>
  //---------------------------------------------------------------------------------------

  // Convert the temp and humi from float to string and print it on Arduino serial terminal
    Serial.printf("Nhiet do %s - Do am %s\r\n", String(temp, 1).c_str(), String(humi, 1).c_str());
  }
  client.stop();                          // Disconnect from server.

  delay(sendingInterval);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>After successfully connected to server, ESP8266 will use <code>client.print()</code> command to send a data packet to server.
A packet example:
<div class="ulist">
<ul>
<li>
<p>GET /update?temp=30.6&amp;humd=60 HTTP/1.1 :</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> is an HTTP method, which is used to request data from a specified resource.</p>
</li>
<li>
<p><code>/update?temp=30.6&amp;humd=60</code> is the data packet we want to send, it includes a pathname and sensor data.</p>
</li>
<li>
<p><code>HTTP/1.1</code> is the version of HTTP used in the project.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Host: 192.168.1.7:8000</code>: the IP and Port of server.</p>
</li>
<li>
<p><code>Connection, Content-Length</code></p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After reviewing your source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use <code>curl</code> command to view the HTTP request headers and other things:
<code>curl -v http://192.168.1.7:8000/update?temp=28.0&amp;humd=45.0</code>. Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">name@yourname:~$ curl -v http://192.168.1.7:8000/update?temp=28.0&amp;humd=45.0
[1] 9277
name@yourname:~$ *   Trying 192.168.1.7...
* Connected to 192.168.1.7 (192.168.1.7) port 8000 (#0)
&gt; GET /update?temp=28.0 HTTP/1.1    // &gt; Message sent from ESP8266
&gt; Host: 192.168.1.7:8000
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt;                                  // &lt; Message sent from server
&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 23 Aug 2017 17:22:49 GMT
&lt; Connection: keep-alive
&lt; Content-Length: 0
&lt;
* Connection #0 to host 192.168.1.7 left intact</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result will be displayed on Arduino and PC logging screen.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/esp8266-server.png" alt="esp8266 server" height="366">
</div>
<div class="title">Figure 42. The server terminal and the Arduino screen during the transmission.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_your_application">Extending your application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_esp8266_web_server_2">ESP8266 Web Server</h3>
<div class="paragraph">
<p>You should try to add some new features to the project. Here are some ideas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Measure and display temperature and humidity in real-time</p>
</li>
<li>
<p>Illustrate in graph the sensor data over time.</p>
</li>
<li>
<p>Have 2 modes: Auto and Manual.</p>
<div class="ulist">
<ul>
<li>
<p>The Auto mode: turns your fan on automatically when the temperature &gt; 35ºC or turn on a humidifier when the humidity is below 50%.</p>
</li>
<li>
<p>The Manual mode: controls your fan and humidifier manually with ON/OFF switch on web interface.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Display temperature and humidity history in a specified date interval, from aa/bb/cccc to xx/yy/zzzz.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is an example of a graphical user interface:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/04-dht11/control%20interface.png" alt="control interface" width="500">
</div>
<div class="title">Figure 43. An control interface on HTML</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary_5">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upon completion of this project, you will have an overview of building a complete sensors data logging project as well as building a web server to serve the clients from scratch. This will help you lay the foundations for many larger data logging and analyzing projects in the future.</p>
</div>
</div>
</div>
<h1 id="_wifi_config" class="sect0">WiFi configuration on ESP8266</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>When prototyping an idea with ESP8266, people usually focus on the features of that ideas, not the user&#8217;s experience. So a fully-functioning prototype could lack of a user interface, a keyboard or a touchscreen,&#8230;&#8203; That would lead to some inconveniences for users.</p>
</div>
<div class="paragraph">
<p>For example, whenever an ESP8266 wants to connect to a new WEP/WPA/WPA2 WiFi Access Point, we must manually provide the AP&#8217;s configuration, SSID and password in the source code and compile those code into a new binary file on PC. Then using a USB cable, we upload that file to the device just to change the WiFi AP!</p>
</div>
<div class="paragraph">
<p>To deal with those problems, ESP8266 provides some user-friendly alternatives to simplify the WiFi set-up process. In this chapter, we are introducing <code>SmartConfig</code>, <code>WPS</code> and <code>WiFi Manager</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smartconfig">Smartconfig</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2">Introduction</h3>
<div class="paragraph">
<p>SmartConfig protocol helps users connect ESP8266 devices to a WiFi network through simple configuration on a smartphone. With this protocol, a smartphone sends UDP packets to the Wi-Fi Access Point (AP), and encodes the SSID and password into the Length field of a sequence of UDP packets. The ESP8266 device can reach those packets, decode the information, get the SSID and password from decoded data and connect it to the network.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/smart-config.png" alt="SmartConfig" width="400">
</div>
<div class="title">Figure 44. SmartConfig with ESP8266</div>
</div>
<div class="paragraph">
<p>We should know that, when a smartphone connects to a secured wifi network, all the data between your router and your smartphone will be encrypted during the transmission. So any other devices, which are not connected to the network at the beginning, cannot decrypt and read the data packets. So how can a smartphone app send the information to the unconnected devices directly? The solution is based on 2 things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ESP8266 is capable of <code>sniffing</code> out all the packets being passed around, even the encrypted packets!</p>
</li>
<li>
<p>The content of an encrypted packet in a WiFi network cannot be read, but the length field of that packet is a constant and ESP8266 can reach that. For example, we have an unencrypted packet "A" with the length of <code>x</code>. When "A" is encrypted into "B", <code>x + n</code> is the new length of "B" and <code>n</code> is a constant.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is the ESP-TOUCH operation process sending SSID and password to an ESP8266 device:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable SmartConfig function on ESP8266 device and it starts sniffing all the packets.</p>
</li>
<li>
<p>Connect your smartphone to router.</p>
</li>
<li>
<p>Input the router&#8217;s SSID and password on phone app and it will broadcast a packet with random contents with encoded SSID and password in Length field.</p>
<div class="ulist">
<ul>
<li>
<p>For example, you have a network with SSID <code>mynetwork</code>. The first letter <code>m</code> corresponds to <code>109</code> in ASCII code. To broadcast letter <code>m</code>, that app will send a packet which has random contents and a length of 109 to router. And the process is repeated to broadcast each letter in the SSID name. This method is also used to broadcast password, smartphone&#8217;s IP address and other letters to ESP8266 devices.</p>
</li>
</ul>
</div>
</li>
<li>
<p>ESPTOUCH protocol could encrypt transmitted data in the process above but the principle is the same.</p>
</li>
<li>
<p>ESP8266 devices will sniff out those packets whose length changes over time, then decrypt the data and extract the SSID,  password and other related information.</p>
</li>
<li>
<p>When ESP8266 has successfully connected to wifi network, it will connect to user&#8217;s smartphone using the decoded IP address and send a message to notify the app of its successful connection.</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/data_packet.png" alt="A UDP packet structure" width="400">
</div>
<div class="title">Figure 45. A UDP packet structure</div>
</div>
<div class="paragraph">
<p>NOTE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It will take longer time to establish the connection with greater distance.</p>
</li>
<li>
<p>If the device cannot connect to the router within a specified time period, the App will return a configuration failure message. Users can define the overtime settings through <code>esptouch_set_timeout(uint8 time_s)</code> .</p>
</li>
<li>
<p>Your ESP8266 device should be configured as a STATION when it connects to network using SmartConfig.</p>
</li>
<li>
<p>Users can configure multiple devices to connect to the same router simultaneously.</p>
</li>
<li>
<p>ESPTOUCH supports 802.11n and 2.4GHz wireless routers .</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_smartconfig_on_esp8266">Running SmartConfig on ESP8266</h3>
<div class="paragraph">
<p>In the following example, our ESP8266 is connecting to a wifi network using SmartConfig and on Android, we are using <code>SmartConfig</code> app to input the SSID and its password. You can easily search for this app as well as other similar app on Play Store (Android) and iTunes (iOS).</p>
</div>
<div class="paragraph">
<p>First, you need to upload the compiled code to ESP8266. The key command in this program is the <code>WiFi.beginSmartConfig()</code> line and it&#8217;s provided in ESP8266WiFi library. This command allows the device to enter SmartConfig mode, sniff out the desired packets and decrypt them to connect to a wifi network.</p>
</div>
<div class="paragraph">
<p>After uploading your sketch, you should hold the GPIO0 button in 3 seconds, the built-in LED will blink faster and your device will enter SmartConfig mode. Connect your smartphone to a desired wifi network, open <code>SmartConfig</code> app, input the SSID and PASSWORD (if any), and press <strong>CONFIRM</strong>.</p>
</div>
<div class="videoblock">
<div class="title">A demo video:</div>
<div class="content">
<iframe src="https://www.youtube.com/embed/-RqMKvMLPi0?rel=0&amp;hl=en" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_2">Code</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;Arduino.h&gt;
#include &lt;ESP8266WiFi.h&gt;
#include &lt;Ticker.h&gt;
#include &lt;time.h&gt;

#define PIN_LED 16
#define PIN_BUTTON 0

#define LED_ON() digitalWrite(PIN_LED, HIGH)
#define LED_OFF() digitalWrite(PIN_LED, LOW)
#define LED_TOGGLE() digitalWrite(PIN_LED, digitalRead(PIN_LED) ^ 0x01)

Ticker ticker;

/* Button state check function*/
bool longPress()
{
  static int lastPress = 0;
  if (millis() - lastPress &gt; 3000 &amp;&amp; digitalRead(PIN_BUTTON) == 0) { // If button is pressed in more than 3 seconds then...
    return true;
  } else if (digitalRead(PIN_BUTTON) == 1) {                         //  If button is pressed in lest than 3 seconds then...
    lastPress = millis();                                            // `lastPress` variable is assigned when this condition is true.
  }
  return false;
}

void tick()
{
  int state = digitalRead(PIN_LED); // Get current LED's state (on GPIO 16)
  digitalWrite(PIN_LED, !state);    // Invert LED's state.
}

bool in_smartconfig = false;        // This variable stores the state of smartconfig mode.
                                    // "True" means this mode is running and vice versa.
//

/* Start Smartconfig mode */
void enter_smartconfig()
{
  if (in_smartconfig == false) {          // If smartconfig state variable is "false" i.e the smartconfig mode is currently off, then
    in_smartconfig = true;                // Assign "true" value to smartconfig state variable.
    ticker.attach(0.1, tick);             // Blinking in 0.1 seconds period.
    WiFi.mode(WIFI_STA);                  // Configure ESP8266 as Station mode.
    WiFi.beginSmartConfig();              // Start Smartconfig mode.
    Serial.println("Enter smartconfig");  // Print message "Enter smartconfig" to terminal's screen.
  }
}

/* Exit Smartconfig mode*/
void exit_smart()
{
  ticker.detach();                                // Stop blinking LED.
  LED_ON();                                       // Turn LED ON.
  in_smartconfig = false;                         // Reset button's state variable..
  Serial.println("Connected, Exit smartconfig");  // Print message to terminal.
}

/* Set up the serial connection, input and output */
void setup() {
  Serial.begin(115200);           // Baudrate = 115200
  Serial.setDebugOutput(true);    // Use this to enable printing debug log to terminal via serial connection.
  pinMode(PIN_LED, OUTPUT);       // Configure the OUTPUT mode for LED's GPIO. .
  pinMode(PIN_BUTTON, INPUT);     // Configure the INPUT mode for the built-in BUTTON's GPIO.
  Serial.println("Setup done");   // Print message "Setup done" to the terminal.
}

/* Main program */
void loop() {
  if (longPress()) {              // Call longPress() to check button's state
    enter_smartconfig();          // If "true", enter smartconfig mode
  }
  if (WiFi.status() == WL_CONNECTED &amp;&amp; in_smartconfig &amp;&amp; WiFi.smartConfigDone()) {
                                  // Check WiFi connection status and smartconfig's state
    exit_smart();                 // When your device has successfully connected to WiFi, exit smartconfig mode.
  }
  if (WiFi.status() == WL_CONNECTED) {
    //Your program will be executed here when your device has been connected to WiFi.
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After reviewing your code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wps">WPS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_wps">What is WPS?</h3>
<div class="paragraph">
<p>This section will introduce the WPS concept, its usage and how to use it on ESP8266.</p>
</div>
<div class="paragraph">
<p>Wi-Fi Protected Setup (WPS; originally, Wi-Fi Simple Config) is a network security standard to create a secure wireless home network and make it easy to add new devices to an existing network without searching and entering long passphrases. WPS is available to use only if both the router and your device support the WPA/WPA2 security protocol.</p>
</div>
<div class="paragraph">
<p>There are three primary approaches to network set up within Wi-Fi Protected Setup: push-button, PIN entry, and NFC - Near Field Communication (not popular yet). We are using push-button to set up WiFi in this tutorial.</p>
</div>
<div class="paragraph">
<p>Here is the process using push-button:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, push the WPS button on router and let it enter a special security mode. This mode allows connection requests from WPS-supported devices.</p>
</li>
<li>
<p>Next, push the WPS button, either an actual or virtual one, on the wireless client device. This action allows that device to connect to a router using WPS. Routers from different manufacturers have a different timeout, usually from 1 minute to 5 minutes. If it takes too long and exceeds this timeout, the connection using WPS fails.</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/wps_button.jpg" alt="WPS button" width="400">
</div>
<div class="title">Figure 46. WPS Push Button on WiFi router.</div>
</div>
</div>
<div class="sect2">
<h3 id="_connect_to_wifi_network_on_esp8266_using_wps">Connect to WiFi network on ESP8266 using WPS</h3>
<div class="paragraph">
<p>The <code>WiFi.beginWPSConfig()</code> function in <code>ESP8266WiFi</code> library help ESP8266 to configure and connect to a network using WPS. This example will configure WPS on ESP8266 without any push-buttons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- You can only connect to wifi using WPS only if your ESP8266 is in STA (station) mode.

- WPS mode must have already been configured on your router.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_3">Code</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;

void setup()
{
  // Set up the initial condition
  Serial.begin(115200);
  WiFi.mode(WIFI_STA);
  // Connect to a known WiFi AP, whose SSID and password is stored on ESP8266's FLASH memory.
  WiFi.begin("", "");
  delay(4000);


  // Check the WiFi connection. If not connected yet, use WPS to connect.
  // Your router should be in WPS mode during these commands.
  while (WiFi.status() != WL_CONNECTED)
  {
    Serial.println("\nAttempting connection ...");
    WiFi.beginWPSConfig();
    delay(6000);
  }
  // After successful connection, print out the local IP, SSID and MAC address of your device.
  Serial.println("\nConnection already established.");
  Serial.println(WiFi.localIP());
  Serial.println(WiFi.SSID());
  Serial.println(WiFi.macAddress());
}

void loop()
{
  // Main program
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After reviewing your source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wifi_manager">Wifi Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WiFiManager library allows you to easily manage the Wi-Fi connection in your ESP8266 projects via a user-friendly web interface. By starting the ESP8266 in access point mode (AP mode) with its own DNS and WebServer, you can connect to it using any WiFi device with a browser (PC, smartphone, tablet). Any connections to that AP will be redirected to a configuration portal. Using this portal, you can configure ESP8266 to scan WiFi, choose one of the APs scanned, enter password and save it for later use.</p>
</div>
<div class="sect2">
<h3 id="_how_it_works">How it works?</h3>
<div class="ulist">
<ul>
<li>
<p>When your ESP8266 starts up, it sets it up in Station mode and tries to connect to a previously saved Access Point.</p>
</li>
<li>
<p>If that connection is unsuccessful (previous APs are offline, or wrong password, or perhaps there is no known network available), it moves the ESP into Access Point mode and spins up a DNS and a Web Server (with default ip 192.168.4.1). This DNS typically points to itself, but you can configure it to point to another domain.</p>
</li>
<li>
<p>You can use any wifi enabled device with a browser (computer, phone, tablet) and connect to that newly created Access Point. This AP&#8217;s name is default and it doesn&#8217;t require a password to log in:</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/wifi_manager.png" alt="Connecting wifi manager" width="400">
</div>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/wifi_manager1.png" alt="Wifi manager interface" width="400">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When the configuration portal of ESP8266&#8217;s AP at "192.168.4.1" finishes loading, choose "Configure Wifi" or "Configure Wifi (no scan)" to set up a new WiFi connection:</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/05-wificonfig/wifi_manager2.png" alt="Connecting using wifi manager" width="400">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose a WiFi AP and enter its password.</p>
</li>
<li>
<p>If success, the Web Server on ESP8266 will turn off and the ESP8266 AP becomes unavailable. If fail to connect, you need to reconnect to ESP8266 AP, choose another AP and repeat steps above.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_preparation_3">Preparation</h3>
<div class="ulist">
<ul>
<li>
<p>Install WiFiManager library: <a href="https://github.com/tzapu/WiFiManager" class="bare">github.com/tzapu/WiFiManager</a>.</p>
</li>
<li>
<p>How to install a new library? Follow <a href="#install-library">Install arduino library</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_code">Source Code</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;          //https://github.com/esp8266/Arduino

//Include neccessary libraries.
#include &lt;DNSServer.h&gt;
#include &lt;ESP8266WebServer.h&gt;
#include "WiFiManager.h"          //https://github.com/tzapu/WiFiManager

void configModeCallback (WiFiManager *myWiFiManager)
{
  Serial.println("Entered config mode");
  Serial.println(WiFi.softAPIP());
  Serial.println(myWiFiManager-&gt;getConfigPortalSSID());
}

  // Initialize the serial communication and connect to wifi using WiFiManager.
void setup()
{
  Serial.begin(115200);

  // Declare the "wifiManager" variable. It is a 'WiFiManager' class and is defined in "WiFiManager.h".
  WiFiManager wifiManager;

  // Uncomment this command to reset settings to default.
  // wifiManager.resetSettings();

  // Set up a callback. When your device fails to connect to a known AP, it calls this callback
  // and starts its own AP station with a default SSID "ESP+chipID".
  wifiManager.setAPCallback(configModeCallback);
  if (!wifiManager.autoConnect())
  {
    Serial.println("failed to connect and hit timeout");
  // If failed to connect, reset your device and re-connect.
    ESP.reset();
    delay(1000);
  }
  // Print this message to terminal screen when your device has successfully connected to WiFi.
  Serial.println("connected...yeey :)");

}

void loop()
{
  // Main program.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After reviewing your code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extending_your_knowledge">Extending your knowledge:</h3>
<div class="paragraph">
<p>There are many available useful features in WiFiManager library such as configuration portal timeout, custom IP configuration, HTML, CSS or Javascript,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>You can find out further information on their GitHub page: <a href="https://github.com/tzapu/WiFiManager" class="bare">github.com/tzapu/WiFiManager</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary_6">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you build an IoT system in real life, you will face many challenges. One of the most important challenges is making your product easy-to-use, easy-to-configure and secure during data transmission. You should consider your purpose and your product&#8217;s functionalities to choose an appropriate solution to configure WiFi connection.</p>
</div>
<div class="paragraph">
<p>For example, if your device contains buttons or a smartphone app, you should consider choosing SmartConfig or WPS. Or, if you are making a smart light bulb with the ability to control over WiFi, then WiFIManager will be the most suitable solution. It&#8217;s up on you!</p>
</div>
</div>
</div>
<h1 id="_mqtt" class="sect0">MQTT</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/mqttorg-glow.png" alt="mqttorg glow" width="200">
</div>
</div>
<div class="paragraph">
<p>MQTT stands for Message Queuing Telemetry Transport and it is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliable networks.</p>
</div>
<div class="paragraph">
<p>These principles also turn out to make the protocol ideal of the emerging “machine-to-machine” (M2M) or “Internet of Things” world of connected devices, and for mobile applications where bandwidth and battery power are at a premium.</p>
</div>
<div class="paragraph">
<p>Facebook has implemented MQTT in Facebook Messenger for online chat</p>
</div>
<div class="paragraph">
<p>There are many free online resources to help gain an in-depth understanding of MQTT. In this section, we will introduce some basics of MQTT:
<strong>"subscribe", "publish", "qos", "retain", "last will and testament (lwt)"</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_publish_subscribe">Publish, subscribe</h3>
<div class="paragraph">
<p>The clients in an MQTT system connects to an MQTT server called the broker. Each client has to <strong>"subscribe"</strong> to some topics. For example, "/client1/channel1", "/client1/channel2",&#8230;&#8203; This process is similar to the subscription feature on Youtube. When each client <strong>"publishes"</strong> a message to the broker, the broker will deliver all messages with the matching topic to the client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_qos">QoS</h3>
<div class="paragraph">
<p>You will have 3 levels of <strong>QoS (Qualities of service)</strong> when you "publish" and "subscribe":</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>QoS0</strong> : The message is delivered <strong>at most once</strong> to the receiver. This message is only guaranteed by the underlying TCP protocol and this is often called "fire and forget".</p>
</li>
<li>
<p><strong>QoS1</strong> : The message is always delivered <strong>at least once</strong> to the receiver. If the sender does not receive an acknowledgment, the message is sent again until an acknowledgment is received. As a result, the same message can be sent multiple times, and the receiver might process it multiple times.</p>
</li>
<li>
<p><strong>QoS2</strong> : The message is always delivered <strong>exactly once</strong> to the receiver, and this QoS is a 4-step handshake transmission.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Read more:</strong>: <a href="https://code.google.com/p/mqtt4erl/wiki/QualityOfServiceUseCases" class="bare">code.google.com/p/mqtt4erl/wiki/QualityOfServiceUseCases</a></p>
</div>
<div class="paragraph">
<p>A message can be sent in any QoS mode and the clients can also subscribe in any QoS mode - i.e., the clients will select the highest QoS available to receive the message.</p>
</div>
<div class="paragraph">
<p>For example, if a message is published in QoS2 and a client subscribes with QoS0, the broker will send that message to client with QoS0. Another client, who subscribes to this topic with QoS2, will be sent with QoS2 from broker.</p>
</div>
<div class="paragraph">
<p>Another example, if a client subscribes with QoS2 and the message is sent in QoS0, that client will be sent a message in QoS0 from broker.</p>
</div>
<div class="paragraph">
<p>The higher QoS, the more reliability, latency and bandwidth.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retain">Retain</h3>
<div class="paragraph">
<p>If the retained flag is set to true, the broker <strong>MUST</strong> store the last retained message and the corresponding QoS. That message will be sent to every new subscriber in future. Each client that subscribes to a topic pattern, which matches the topic of the retained message, will receive the last message with RETAIN = 1 immediately after subscribing.
If the Broker receives a new message with QoS = 0 and RETAIN = 1, it will delete all stored retained message and save the new one. For each topic only one retained message will be stored by the broker.</p>
</div>
<div class="paragraph">
<p>When publishing a message to clients, the brokers must set the RETAIN to 1 to notify the successful subscribing to client (it is similar to the ACK message when the subscribing is successful). If we don&#8217;t need to notify the result of subscribing process. set RETAIN to 0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lwt">LWT</h3>
<div class="paragraph">
<p>LWT messages are not really concerned about detecting whether a client has gone offline or not (that task is handled by keepAlive messages). LWT messages are about what happens after the client has gone offline.</p>
</div>
<div class="paragraph">
<p><strong>An example</strong></p>
</div>
<div class="paragraph">
<p>I have a sensor, which sends crucial data, but very infrequently. It has formulated a last will statement in topic: <strong>/node/gone-offline</strong> with its unique <strong>id</strong>. I also have subscribed to the the topic <strong>node/gone-offline</strong>, which will send a SMS to my phone every time a message is published on that channel.</p>
</div>
<div class="paragraph">
<p>During normal operation, the sensor will keep the connection to the MQTT-broker open by sending periodic keepAlive messages. If the sensor goes offline, the connection to the broker will time out, due to the lack of keepAlives.</p>
</div>
<div class="paragraph">
<p>This is where LWT comes in: If no LWT is specified, the broker doesn&#8217;t care and just closes the connection. In our case however, the broker will execute the sensor&#8217;s last will and publish the LWT-message "id" to <strong>node/gone-offline</strong>. Because I have subscribed to that topic, the message will then be sent to phone and I will be notified of the sensor&#8217;s ID via SMS so that I can check up on what&#8217;s going on.</p>
</div>
<div class="paragraph">
<p><strong>In short</strong></p>
</div>
<div class="paragraph">
<p>Instead of just closing the connection after a client has gone offline, LWT messages can be leveraged to define a message to be published by the broker on behalf of the client, since the client is offline and cannot publish anymore.</p>
</div>
</div>
<div class="sect1">
<h2 id="_mqtt_client">MQTT Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Như chúng ta đã tìm hiểu ở phần trước, 2 thành phần publisher và In the previous section, we have discovered 2 fundamental components of MQTT protocol: "publisher" and "subscriber". an MQTT Client doesn&#8217;t transmit directly to other clients, every sent packet is distributed to an appropriate subscriber by an MQTT Broker. In this section, we are introducing some common MQTT Clients to demonstrate the MQTT concepts you have learned. We are also introducing some free and popular MQTT Broker: <a href="http://test.mostquitto.org" class="bare">test.mostquitto.org</a> and <a href="http://cloudmqtt.com" class="bare">cloudmqtt.com</a>.</p>
</div>
<div class="sect2">
<h3 id="_mqtt_lens">MQTT Lens</h3>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>MQTT Lens is a Chrome Extension and it uses Chrome to connect to an MQTT Broker and tests the publish/subscribe features of MQTT. This is a very useful tool to test the connection and transmission to an MQTT Broker.</p>
</div>
<div class="paragraph">
<p>Here are some information about MQTT Lens:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<caption class="title">Table 2. Short Profile</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chrome App</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating Systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows, Linux &amp; MacOSX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Website</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"https</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Setup</strong></p>
</div>
<div class="paragraph">
<p>We will using this tools to connect to an MQTT Broker service at iot.eclipse.org in the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Install the Chrome Web Browser, log in to your Google account, visit <a href="https://chrome.google.com/webstore/category/extensions" class="bare">chrome.google.com/webstore/category/extensions</a> and type "MQTTlens" in the search box.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/searchMQTTlens.png" alt="searchMQTTlens" width="600">
</div>
<div class="title">Figure 47. The MQTTLens of Chrome Web Store</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Add to Chrome and run MQTT lens.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/addMQTTlens.png" alt="addMQTTlens" width="600">
</div>
<div class="title">Figure 48. Add and run MQTT lens.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 3: Add a new connection to Eclipse MQTT Broker service.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/createATopic.png" alt="createATopic" width="600">
</div>
<div class="title">Figure 49. Add a new connection</div>
</div>
<div class="paragraph">
<p><strong>Explanation</strong></p>
</div>
<div class="paragraph">
<p>We are adding a connection named "eclipse MQTT" to MQTT Broker host at <code>iot.eclipse.org</code>. This broker distributes data between clients and listens on port 1883( This port uses MQTT protocol and doesn&#8217;t encrypt data. To use other ports, visit <a href="https://test.mosquitto.org" class="bare">test.mosquitto.org</a> for more information).
This connection subscribes to the topic <code>Home/garden/sensor/#</code> (The # symbol allows it to subscribe <code>Home/garden/sensor/1</code> , <code>Home/garden/sensor/2</code> , etc). Then we publish a packet with a message: <code>"Temp in garden: 27degree Celcius "</code> to topic <code>Home/garden/sensor/1</code> .</p>
</div>
<div class="paragraph">
<p><strong>Result</strong>: In the Subscription panel, the MQTT Lens shows the received messages because it has subscribed to topic <code>Home/garden/sensor/#</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/connect2Clients.png" alt="connect2Clients" width="600">
</div>
<div class="title">Figure 50. The received data after publishing.</div>
</div>
<div class="paragraph">
<p><strong>Extensions</strong></p>
</div>
<div class="paragraph">
<p>Create more connections to subscribe and publish message with Eclipse Broker service and test the QoS and LWT.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mqtt_js">MQTT.js</h3>
<div class="paragraph">
<p>MQTT.js is an MQTT Client library written in JavaScript and Node.js platform. And it supports MQTT Over Websocket (MOW)</p>
</div>
<div class="paragraph">
<p>MQTT.js is an opensource project, you can get the latest release at <a href="https://github.com/mqttjs/MQTT.js.git" class="bare">github.com/mqttjs/MQTT.js.git</a></p>
</div>
<div class="paragraph">
<p><strong>Setup</strong></p>
</div>
<div class="paragraph">
<p>Step 1: The first, you we have to check the the operating system supported by Node.js before install MQTT.js. Install Node.js before installing MQTT.js. You can download here: <a href="https://nodejs.org/en/" class="bare">nodejs.org/en/</a></p>
</div>
<div class="paragraph">
<p>Step 2: Create a Node.js project:
We suggest creating a new folder for this project to store and conveniently manage NodeJS modules and .js file. Navigate to this folder and open Terminal (on Linux OS) or Command Prompt (on Windows OS) and run:</p>
</div>
<div class="paragraph">
<p><code>npm init</code></p>
</div>
<div class="paragraph">
<p>After running this command, you will have to provide some basic project information such as name, version, keywords, authors,&#8230;&#8203; When you finish, a new file named <code>package.json</code> will be created in your project folder. This file contains the information you provided above and the package you will use later.</p>
</div>
<div class="paragraph">
<p>Step 3: Install <code>MQTT.js</code>:</p>
</div>
<div class="paragraph">
<p>Run:
<code>npm install mqtt --save</code></p>
</div>
<div class="paragraph">
<p>When the installation finishes, you can use <code>mqtt</code> module to connect a Client to a Broker, publish message or subscribe to a topic. All the associated files of the <code>mqtt</code> module are stored in folder <code>node_modules</code> of project folder.
To understand how MQTT.js works, in next step, we are adding 2 new JavaScript files <code>client-a.js</code> and <code>client-b.js</code> to subscribe and publish messages.</p>
</div>
<div class="paragraph">
<p>Step 4: Create 2 new clients to subscribe and publish separately:</p>
</div>
<div class="paragraph">
<p>Those clients are connected to the same MQTT Broker. Client A subscribes to the topic <code>/client-a/sub</code> and if any messages are published to this topic, client A will publish message <code>Hello from client A</code> to topic <code>/client-b/sub</code> and then close connection and exit. The other client subscribes to the topic <code>/client-b/sub</code> and if any messages are published to this topic, client B will close connection and exit. After connecting to the broker, client B will immediately publish a message <code>Hello from client B</code> to the topic <code>/client-a/sub</code>.</p>
</div>
<div class="paragraph">
<p><strong>Client A&#8217;s source code</strong></p>
</div>
<div class="listingblock">
<div class="title">client-a.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// declare a "mqtt" variable to use mqtt module's features.
var mqtt = require('mqtt')
// declare a "client" variable and use the "connect" attribute to connect to a MQTT broker with hostname mqtt://iot.eclipse.org
var client = mqtt.connect('mqtt://iot.eclipse.org')
// This function subscribes to a topic after successfully connecting to broker.
client.on('connect', function() {
    console.log('Client A connected')
    // subscribe to the topic /client-a/sub
    client.subscribe('/client-a/sub')
})
// This function sends a message to subscribed topic.
client.on('message', function(topic, message) {
    // print to console a "string" type message.
    console.log(message.toString())
    // publish the message 'Hello from client A' to topic /client-b/sub
    client.publish('/client-b/sub', 'Hello from client A')
    // disconnect from server
    client.end()
})
console.log('Client A started')</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Client B&#8217;s source code</strong></p>
</div>
<div class="listingblock">
<div class="title">client-b.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// declare a "mqtt" variable to use mqtt module's features.
var mqtt = require('mqtt')
// declare a "client" variable and use the "connect" attribute to connect to a MQTT broker with hostname mqtt://iot.eclipse.org
var client = mqtt.connect('mqtt://iot.eclipse.org')
// This function will subscribe to a topic after successfully connecting to broker.
client.on('connect', function() {
    console.log('Client B connected')
    // subscribe to the topic /client-b/sub
    client.subscribe('/client-b/sub')
    // publish the message 'Hello from client B' to topic /client-a/sub
    client.publish('/client-a/sub', 'Hello from client B')
})
client.on('message', function(topic, message) {
    // print to console a "string" type message.
    console.log(message.toString())
    // disconnect from server
    client.end()
})
console.log('Client B started')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is shown below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/MQTTjsConsole.png" alt="MQTTjsConsole" width="511">
</div>
<div class="title">Figure 51. The result after running the clients' code</div>
</div>
<div class="paragraph">
<p>Furthermore, MQTT.js provides many commands to interact with Broker via Terminal. To do this, you need to install MQTT.js as a global module by using:</p>
</div>
<div class="paragraph">
<p><code>npm install mqtt -g</code>.</p>
</div>
<div class="paragraph">
<p>You can open 2 terminals to test the codes. The 1st terminal subscribes to the topic "topicA" by running:</p>
</div>
<div class="paragraph">
<p><code>mqtt sub -t 'topicA' -h 'test.mosquitto.org' -v</code></p>
</div>
<div class="paragraph">
<p>The 2nd terminal publishes a message "Hello subscriber" to "topicA":</p>
</div>
<div class="paragraph">
<p><code>mqtt pub -t 'topicA' -h 'test.mosquitto.org' -m 'hello subscriber'</code></p>
</div>
<div class="paragraph">
<p>The options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-t</code> : MQTT topic, pushlish a message.</p>
</li>
<li>
<p><code>-h</code> : Specifies the server will connect</p>
</li>
<li>
<p><code>-m</code> : Sends a message using the command line.</p>
</li>
<li>
<p><code>-v</code> : verbose, The option allows you to record the activity log of the files in the configuration file.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/MQTTjsCommand.png" alt="MQTTjsCommand" width="600">
</div>
<div class="title">Figure 52. The published message when using Command Line</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need help on other APIs of MQTT.js, run: <code>mqtt help [command]</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_esp8266_mqtt_client">ESP8266 MQTT Client</h3>
<div class="paragraph">
<p>There are many MQTT library for ESP8266 on Arduino IDE and in this section, we are using 2 popular libraries: <code>PubSubClient</code> and <code>ESP8266MQTTClient</code></p>
</div>
<div class="sect3">
<h4 id="_pubsubclient">PubSubClient</h4>
<div class="paragraph">
<p>In this section, we are connecting ESP8266 WiFi Uno to a Broker using PubSubClient library.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 1 :</strong> Download PubSubClient library at <a href="https://github.com/knolleary/pubsubclient" class="bare">github.com/knolleary/pubsubclient</a> and include it in the Arduino IDE. You can also import this library to Arduino IDE by searching the library with the keyword <code>PubSubClient</code>, author <code>Nick O'Leary</code> and install it.</p>
</li>
<li>
<p><strong>Step 2 :</strong> Compile the following source code for ESP8266.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;PubSubClient.h&gt;

const char* ssid = "........";
const char* password = ".........";
const char* mqtt_server = "broker.mqtt-dashboard.com";

WiFiClient espClient;
PubSubClient client(espClient);

void setup() {
  pinMode(16, OUTPUT);
  Serial.begin(115200);
  // Setup wifi connection and print the ESP8266's IP to terminal.
  setup_wifi();
  // Setup MQTT server "broker.mqtt-dashboard.com" and listen to client on port 1883.
  client.setServer(mqtt_server, 1883);
  // Call "callback" function to publish/subscribe
  client.setCallback(callback);
  // Call "reconnect()" function to restart the connection to server when it losts connection.
  reconnect();
}

void setup_wifi() {
  delay(10);
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(ssid);
  // Connect to a given WiFi
  WiFi.begin(ssid, password);
  // Print . during WiFi connecting process
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  // Print "WiFi connected" and ESP8266's IP to terminal
  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
}

void callback(char* topic, byte* payload, unsigned int length) {
  // Print the topic's header and content published from MQTT lens
  Serial.print("Message arrived [");
  Serial.print(topic);
  Serial.print("] ");
  for (int i = 0; i &lt; length; i++) {
    Serial.print((char)payload[i]);
  }
  // Verify the data from topic "ESP8266/LED_GPIO16/status".
  // If the string is "ON", turn on the LED. And vice versa
  if ((char)payload[0] == 'o' &amp;&amp; (char)payload[1] == 'n') //on
    digitalWrite(16, LOW);
  else if ((char)payload[0] == 'o' &amp;&amp; (char)payload[1] == 'f' &amp;&amp; (char)payload[2] == 'f') //off
    digitalWrite(16, HIGH);
  Serial.println();
}

void reconnect() {
  // Keep attempting to connect to MQTT broker until the connection is recovered.
  while (!client.connected()) {
    Serial.print("Attempting MQTT connection...");
    if (client.connect("ESP8266")) {
      Serial.println("connected");
      // publish "Connected!" message to topic ESP8266/connection/board
      client.publish("ESP8266/connection/board", "Connected!");
      // Subscribe to topic ESP8266/LED_GPIO16/status
      client.subscribe("ESP8266/LED_GPIO16/status");

    } else {
      // Print the client's state if it can't connect to MQTT broker.
      Serial.print("failed, rc=");
      Serial.print(client.state());
      Serial.println(" try again in 5 seconds");
      // delay 5 seconds
      delay(5000);
    }
  }
}

void loop() {
  // Check the ESP8266 connection. Reconnect to broker if connection isn't ready yet
  if (!client.connected()) {
  if (!client.connected()) {
    reconnect();
  }
  client.loop();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Source code explanation:</strong></p>
</div>
<div class="paragraph">
<p>We declare a <code>espClient</code> variable in <code>WiFiClient</code> class. It is an MQTT Client and use the attributes of <code>PubSubClient</code> library.</p>
</div>
<div class="paragraph">
<p>The <code>setup()</code> function configures the ESP8266 as a station and connects to wifi. In addition, the <code>setup ()</code> function will also auto-reconnect to MQTT Broker when a connection is lost. The <code>reconnect()</code> subscribes to the given topic and publishes its state to another topic.
The <code>callback()</code> function gets a message from publishers and then sent it the topic. The client, which has subscribed to that topic earlier, receives and checks the message to control the LED on GPIO16.</p>
</div>
<div class="paragraph">
<p>The <code>loop()</code> function connects the Client (ESP8266) to a Broker. Then it publishes a message and subscribes to a topic.</p>
</div>
<div class="paragraph">
<p>The <code>client.loop()</code> function tests the connectivity by using <code>KEEP_ALIVE</code> packet and returns a boolean value to notify the connection state. It also processes the incoming messages in the buffers and sends those to clients.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 3 :</strong> Run MQTT lens on Chrome browser, add a new connection with hostname <code>broker.mqtt-dashboard.com</code> using port 1883. Publish messages to the topic <code>ESP8266/LED_GPIO16/status</code>. If the message is <code>ON</code>, the ESP8266 will light its  built-in LED up and vice versa. Other messages cannot control the LED state and will be displayed on the Arduino Terminal. The result is shown below:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/MQTTLEnsPubSUb.png" alt="MQTTLEnsPubSUb" width="897">
</div>
<div class="title">Figure 53. The result on Serial Terminal and on MQTT lens when using PubSubClient library.</div>
</div>
</div>
<div class="sect3">
<h4 id="_esp8266mqttclient">ESP8266MQTTClient</h4>
<div class="paragraph">
<p>The developer community reviews the ESP8266MQTTClient is more stable and easier to use than the PubSubClient library. The following project is using the ESP8266MQTTClient to control the built-in LED on ESP8266 WiFi Uno by a smartphone app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 1 :</strong> Download <code>ESP8266MQTTClient</code> library at <a href="https://github.com/tuanpmt/ESP8266MQTTClient" class="bare">github.com/tuanpmt/ESP8266MQTTClient</a> and include it in Arduino. You can also import this library to Arduino IDE by searching the library with the keyword <code>ESP8266MQTT</code>, author <code>Tuan PM</code>, version <code>1.3</code> and install it.</p>
</li>
<li>
<p><strong>Step 2 :</strong> Compile the following source code for ESP8266.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266MQTTClient.h&gt;
#include &lt;ESP8266WiFi.h&gt;

#define ledPin 16   //Led on board ESP8266 WiFi Uno

MQTTClient mqtt;

const char* ssid = "Your SSID";
const char* password = "Your password";

void setup() {
  Serial.begin(115200);
  pinMode(ledPin, OUTPUT);

  // Turn off LED at the beginning
  digitalWrite(ledPin, HIGH);

  // Configure ESP8266 as a Station and connect to wifi
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);
  Serial.print("\nConnecting to ");
  Serial.println(ssid);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());

  // Connect to the MQTT server, print the "esp8266/GPIO16" topic's id
  // and subscribe to "hello/esp8266" topic with QoS 0
  mqtt.onConnect([]() {
    Serial.printf("MQTT: Connected\r\n");
    Serial.printf("Subscribe id: %d\r\n", mqtt.subscribe("esp8266/GPIO16", 0));
    mqtt.subscribe("esp8266/GPIO16", 0);
  });

   // Publish a message to subscriber's
  mqtt.onSubscribe([](int sub_id) {
   // Print the subscribed topic's id: "hello/esp8266" and "MQTTlens/test/#"
    Serial.printf("Subscribe topic id: %d ok\r\n", sub_id);

    // Publish "hello app" message to "Broker/app" topic with QoS0 and retain flag 0
    mqtt.publish("Broker/app", "hello app", 0, 0);
  });

  // Handle the received data from subscribed's topic
  mqtt.onData([](String topic, String data, bool cont) {
    Serial.printf("Data received, topic: %s, data: %s\r\n", topic.c_str(), data.c_str());

    // If the received string is 'ON', the LED on ESP8266 WiFI Uno will turn on. And vice versa.
    if (topic == "esp8266/GPIO16" &amp;&amp; data[0] == 'o' &amp;&amp; data[1] == 'n' &amp;&amp; data[2] == '\0') {
      digitalWrite(ledPin, LOW);
      Serial.println("Turn on the led on board");
    } else if (topic == "esp8266/GPIO16" &amp;&amp; data[0] == 'o' &amp;&amp; data[1] == 'f' &amp;&amp; data[2] == 'f' &amp;&amp; data[3] == '\0' ) {
      digitalWrite(ledPin, HIGH);
      Serial.println("Turn off the led on board");
    }
  });
  // Begin the MQTT broker "iot.eclipse.org" using WebSocket and listen to client's request at port 80.
  mqtt.begin("ws://iot.eclipse.org:80/ws");
}

void loop() {
  // Initiate MQTT, verify and handle data from the topics,
  // verify the protocol's attributes: keep-a-live packet, QoS packet, topic's id,...
  mqtt.handle();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Source Code Explanation</strong></p>
</div>
<div class="paragraph">
<p>The <code>mqtt</code> variable is in class <code>MQTTClient</code> which is defined in ESP8266MQTTClient library. The library&#8217;s functions are explained in the source code.</p>
</div>
<div class="paragraph">
<p>The <code>setup()</code> function configures ESP8266 as a Station and connects to a wifi network.</p>
</div>
<div class="paragraph">
<p>The <code>mqtt.onConnect()</code> function subscribes to the topic <code>esp8266/GPIO16</code>.</p>
</div>
<div class="paragraph">
<p>The <code>mqtt.onSubscribe()</code> publishes the messages to a specified topic <code>Broker/app</code>.</p>
</div>
<div class="paragraph">
<p>The <code>mqtt.onData()</code> receives, verifies and processes the messages from the subscribed topic. We use a public MQTT Broker <code>iot.eclipse.org</code> and Websocket protocol to listen for MQTT Clients on the default port 80. Transmission using Websocket can reduce the bandwidth and the latency when using MQTT. The detail on Websocket will be introduced later in this book.</p>
</div>
<div class="paragraph">
<p>In <code>loop()</code> function, we just need to call <code>handle()</code> to initiate and verify the attributes of protocol. The <code>handle()</code> also processes, sends and receives messages from public and subscribed topic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details on this library, visit <a href="https://github.com/tuanpmt/ESP8266MQTTClient/tree/master/src" class="bare">github.com/tuanpmt/ESP8266MQTTClient/tree/master/src</a>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 3 :</strong> Install the app and use it to control LED.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Search on App Store (iOS) or CH Play (Android) and install the <code>IoT Smartconfig</code> app of <code>Tuan PM</code> developer.
Here is an overview of the app:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/iotSmartConfig.png" alt="iotSmartConfig" width="600">
</div>
<div class="title">Figure 54. IoT Smartconfig App on iOS and Android</div>
</div>
<div class="paragraph">
<p>This app can be used with ESP8266 or ESP32. Besides the basic <code>publish/subscribe</code> function of MQTT, this app can use <code>smartconfig</code> to easily configure different networks for ESP8266/ESP32 without recompiling the source code.</p>
</div>
<div class="paragraph">
<p>Next, swipe to the MQTT section and press the <code>connect</code> button to connect to the MQTT Broker server <code>ws://iot.eclipse.org:80/ws</code>. Subscribe to the topic <code>Broker/app</code> and publish the message to the topic <code>esp8266/GPIO16</code>. If the message is <code>ON</code>, the ESP8266 will light its built-in LED up and vice versa. Other messages to topic <code>Broker/app</code> will be displayed on the app screen. The result is shown below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/MQTTApp.png" alt="MQTTApp" width="300">
</div>
<div class="title">Figure 55. Subscribing and Publishing on the App</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/MQTTArduino.png" alt="MQTTArduino" width="600">
</div>
<div class="title">Figure 56. On Arduino&#8217;s Terminal</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mqtt_broker">MQTT Broker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the previous part, we have practised free MQTT Broker services, but we may need to pay for service fee in case of huge application which require high bandwidth and high responsive, additionally data may be attached because of low level security. So, in this article, we will build a MQTT Broker ourself. By setting up a MQTT Broker helps us to use MQTT protocol locally without connection to MQTT Broker services on the internet. The sending, receiving and processing data will be performed in high speed, and securely protect user&#8217;s information. However, to set up a MQTT Broker with full features of MQTT protocol require us a good knowledge on MQTT protocol and supported programming languages to build it up. To start up, we will create a simple MQTT Broker by using an exist supported module named <code>Mosca</code>.</p>
</div>
<div class="sect2">
<h3 id="_mosca">MOSCA</h3>
<div class="paragraph">
<p>Mosca is one of many MQTT Broker server of MQTT protocol. It can be list out other servers such as: HiveMQ, Apache Apollo, Mosquitto, Mongoose. Mosca has some special characters as below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is a Node.js Broker, written by JavaScript then can build a MQTT Broker, we need Node.js to run. Mosca can embedded into your application if it is written by Node.js</p>
</li>
<li>
<p>Mosce is a multi-transport MQTT Broker, means it supported all publish, subscribe features of other brokers. List of supported publish/subscribe brokers includes: RabbitMQ, Redis, Mosquitto, ZeroMQ. In this article we will create a simple MQTT Broker using Mosca with supporting by <code>Mongodb</code> database.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_objectives">Objectives</h4>
<div class="ulist">
<ul>
<li>
<p>We will create a MQTT Client by ESP8266 and a MQTT Client on the computer by MQTT.js in order to connect to MQTT Broker, subscribing topics and publishing messages.</p>
</li>
<li>
<p>Using Mosca to create MQTT Broker on personal computer to broadcast messages to MQTT Clients.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performing_steps">Performing steps</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Step 1 :</strong> First, we should create a folder to set up a MQTT Broker on local. Navigate to this folder, create package.js file by <code>npm init</code> command and configure project&#8217;s information. Next, install mosca module by <code>npm install mosca --save</code> command. To listening connections from clients and saving data about connections and messages content, we need the <code>MongoDB</code>, you can choose Redis, Mosquitto, RabbitMQ, etc. and study about the advantages, disadvantages of these databases. To install MongoDB, we will access to <a href="https://docs.mongodb.com/manual/administration/install-community/" class="bare">docs.mongodb.com/manual/administration/install-community/</a>, base on your OS, choose the suitable installer package. After installation, we will open port 27017 (dafault port for using mongodb, we can change the port at configuration file of mongodb) to listening to connections from clients via
<code>sudo service mongod start</code> command. On Linux, connections on system can be checked by <code>Netstat</code> command as shown in bellow image:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/netstatPort.png" alt="netstatPort" width="600">
</div>
<div class="title">Figure 57. Image of the port 27017 is successfully opened and listening to connections</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 2 :</strong> Create Javascript file to write the source code for MQTT Broker. Example of serverMosca.js file source code is written bellow:</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_servermosca_js_file_source_code">serverMosca.js file source code</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// declare a "mosca" variable to use mosca module's features.
var mosca = require('mosca');
// Using ascoltatore library to publish a message, subscribe to a topic on Broker/Protocol.
var ascoltatore = {
    type: 'mongo',
    url: 'mongodb://localhost:27017/mqtt', // url of MongoDB, server will listen for
    // client's request at localhost:27017
    pubsubCollection: 'ascoltatori', // pubsubCollection: Store MongoDB's message
    mongo: {} // mongo: MongoDB connection setting. Don't use this parameter in this project.
};
var settings = {
    port: 1883, // Server's port
    backend: ascoltatore // "ascoltatore" will be called and executed to initiate connections when a server is created.
};
// Declare "server" variable using mosca.
var server = new mosca.Server(settings);
// This function setups and prints message to console when the Mosca server is ready.
server.on('ready', setup);

function setup() {
    console.log('Mosca server is up and running');
}
// This function prints "Client connected" and client's id to console when a client successfully connects to a server.
server.on('clientConnected', function(client) {
    console.log('client connected', client.id);
});
// This function prints "Client disconnected" and client's id to console when a client disconnects from server.
server.on('clientDisconnected', function(client) {
    console.log('client disconnected', client.id);
});
// This function prints the content of client's message to console in "string" when a client published a message.
server.on('published', function(packet, client) {
    console.log('Published', packet.payload.toString());
});</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 3 :</strong> Write the source code for ESP8266. For quickly study, we will use ESP8266MQTTClient library&#8217;s source code wrote at the previous article. Modify the MQTT Broker&#8217;s address from <code>mqtt.begin("mqtt://iot.eclipse.org:1883");</code> to <code>mqtt.begin("mqtt://your-local-ip:1883");</code> with your-local-ip is the IP address of computer (ex:192.168.1.7), notice that ESP8266 and MQTT Broker must connect to the same local WiFi network.</p>
</li>
<li>
<p><strong>Step 4 :</strong> Create MQTT Client using MQTT.js. We will create a folder to containing MQTT Client&#8217;s files. Similar to step 1, using <code>npm init</code> to create package.js file and configure project&#8217;s information. Next, install mqtt module by <code>npm install mqtt --save</code> command and create the Javascript file to write the content of MQTT Client. Example of <code>moscaClient.js</code> file source code is shown bellow:</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_moscaclient_js_file_source_code">moscaClient.js file source code</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// declare a "mqtt" variable to use mqtt module's features.
var mqtt = require('mqtt');
// Connect to port 1883 on 192.168.1.7 using MQTT protocol
var client = mqtt.connect('mqtt://192.168.1.7:1883');
// When a "connect" event arrives at server, client will subscribe the topic "MQTTlens/test/3"
// and publish a message "on" to topic "hello/world" to turn on LED on ESP8266 WiFi Uno.
client.on('connect', function() {
    client.subscribe('Broker/app');
    client.publish('esp8266/GPIO16', 'on');
})
// When a message is delivered to a client, client will convert data in buffer to string
// and print the content to console and close connection.
client.on('message', function(topic, message) {
    // message is Buffer
    console.log(message.toString());
    //client.end();
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_result">Result</h4>
<div class="paragraph">
<p>On terminal, navigate to the folder contains <code>moscaServer.js</code> file and launch the server by <code>node moscaServer.js</code> command. Server will start and listen to connections from MQTT Clients. Next, load the program on Arduino to ESP8266, the run the MQTT Client on the computer by <code>node moscaClient.js</code> command. When there are connections, disconnection, publishing a message or subscribing a topic comes from clients then on server side will display the content and information. Terminals display the result as in the figure bellow:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/moscarServer.png" alt="moscarServer" width="600">
</div>
<div class="title">Figure 58. Image of information received from clients at mosca server</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/06-mqtt/mqttjsArduino.png" alt="mqttjsArduino" width="600">
</div>
<div class="title">Figure 59. Image of information received from mqtt.js client and ESP8266 client</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_some_mqtt_brokers_used_for_real_life_products">Some MQTT Brokers used for real life products</h3>
<div class="sect3">
<h4 id="_mosquitto">Mosquitto</h4>
<div class="paragraph">
<p>Mosquitto is a MQTT Broker written by C programming language. Some special characters of mosquitto is high speed of data transmission and data processing, good stability, widely used and suitable for embedded applications. Suitable for small systems run on local such as Raspberry Pi, moreover Mosquitto also supported TLS/SSL protocols (protocol for server and client authorising purpose, encrypting messages for data protection).</p>
</div>
<div class="paragraph">
<p>Some disadvantages of mosquitto are difficult to design when using for huge applications and poor of devices authority methods, so the ability of security is not optimized.</p>
</div>
</div>
<div class="sect3">
<h4 id="_emq">EMQ</h4>
<div class="paragraph">
<p>EMQ (Erlang MQTT Broker) is a MQTT Broker written by Erlang programming language. Advantages of EMQ is high stability, suitable for design huge systems because of easy to expand the application, easy to install. Moreover, EMQ also support a bunch of users authentication methods, developing and features update frequently by developers community. But, disadvantages of this MQTT broker is difficult for new users. Information about EMQ can be seen at <a href="http://emqttd-docs.readthedocs.io/en/latest/#" class="bare">emqttd-docs.readthedocs.io/en/latest/#</a></p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_summary_7" class="sect0">Summary:</h1>
<div class="openblock partintro">
<div class="content">
After reading this chapter, you should understand the basic principle of MQTT protocol and its role in IoT applications. Because of its importance and usefulness, you should spend more time to explore the QoS, Keep Alive message, the account verification and the data security when using MQTT.
</div>
</div>
<h1 id="_websocket" class="sect0">Websocket</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>WebSokets is an advanced technology that support two-ways communication between client and server by using TCP socket to create a  continuous, effective, and low cost connection. Although, it is built for web applications, developers might using it for any kind of projects.</p>
</div>
<div class="paragraph">
<p>WebSockets is newly introduced in HTML5, allowing bidirectional parallel communications and supported by most of web browsers. Communication is opened via an HTTP request, including special headers that notice Server (supported) switch to WebSocket connection. This connection is maintained then you can send and receive data continuously, no interruption, without any other HTTP header needed.</p>
</div>
<div class="paragraph">
<p>WebSockets supports most popular web browsers such as: Google Chrome, Microsoft Edge, Internet Explorer, Firefox, Safari and Opera.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advantages">Advantages</h3>
<div class="paragraph">
<p>WebSockets provides the ability on bidirectional connections which is continuously maintained, low latency, easy to communicate between Client and Server. That is why WebSockets is proper for real-time applications, end user do not need to reload their browser to update data like HTTP protocol.</p>
</div>
</div>
<div class="sect2">
<h3 id="_disadvantages">Disadvantages</h3>
<div class="paragraph">
<p>WebSockets protocol has not been supported by all web browsers already. WebSockets also require to supported by web applications on server.</p>
</div>
</div>
<div class="sect1">
<h2 id="_using_esp8266_as_websockets_server">Using ESP8266 as WebSockets Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article, we will configure application using ESP8266 as a WebSockets Server and browsers as WebSockets Client to update the status of a button, also control an LED on real-time board via web browser.</p>
</div>
<div class="sect2">
<h3 id="_requirement">Requirement</h3>
<div class="ulist">
<ul>
<li>
<p>Launch a WebServer (WebSockets supported) on ESP8266 MCU.</p>
</li>
<li>
<p>When access to IP address of ESP8266, it will return a HTML file including the content of Javascript that is create WebSockets connection to ESP8266, also listen to data packages from ESP8266 server.</p>
</li>
<li>
<p>When press the button on board, ESP8266 will send the button&#8217;s status to web browser to display with checkbox, pressed is checked, not pressed not checked.</p>
</li>
<li>
<p>At the same time, when checkbox clicked on browser it will change status of the LED on ESP8266 board.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prepare">Prepare</h3>
<div class="paragraph">
<p>Install libraries, for more information <a href="#install-library">Install arduino library</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/me-no-dev/ESPAsyncWebServer" class="bare">github.com/me-no-dev/ESPAsyncWebServer</a></p>
</li>
<li>
<p><a href="https://github.com/me-no-dev/ESPAsyncTCP" class="bare">github.com/me-no-dev/ESPAsyncTCP</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_introduction_about_espasyncwebserver_library">Introduction about ESPAsyncWebServer library</h4>
<div class="paragraph">
<p>ESPAsyncWebServer is used to configure HTTP server and WebSockets server for ESP8266 module, and process events on server-client.</p>
</div>
<div class="paragraph">
<p>In order to use ESPAsyncWebserver and run applications, we need to use ESPAsyncTCP.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_javascript_snippet_code_to_create_web_socket_connection">Javascript snippet code to create Web Socket connection</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">//Basic steps to create a websocket:

var ws = new WebSocket('ws://domain.com:8000/'); // create a websocket
ws.onopen = function() //
{
   // callback when websocket is successfully opened
};

ws.onmessage = function(evt)
{
    // callback when client received data from server
};
ws.onclose = function() {
    // callback when websocket is closed
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_html_file_include_js_code_into_esp8266">Embedded HTML file include JS code into ESP8266</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;ESP8266 WebSocket&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt; Webscoket status &lt;span id="status" style="font-weight: bold;"&gt; disconnected &lt;/span&gt; &lt;/div&gt;
    &lt;div&gt; ESP8266 Button Status &lt;input type="checkbox" id="btn" name="btn" /&gt; &lt;/div&gt;
    &lt;div&gt; Control LED &lt;input type="checkbox" id="led" name="led" disabled="true" /&gt; &lt;/div&gt;

    &lt;script type="text/javascript"&gt;
        var button = document.getElementById('btn');
        var led = document.getElementById('led');
        var url = window.location.host; // return current page's url and port
        var ws = new WebSocket('ws://' + url + '/ws'); // open a websocket at port 8000
        ws.onopen = function() // this function is executed when websocket is opened
        {
            document.getElementById('status').innerHTML = 'Connected';
            led.disabled = false; // until websocket is opened, it is allowed
        };

        ws.onmessage = function(evt) // event triggered when client received data from server
        {
            if(evt.data == 'BTN_PRESSED') {
                button.checked = true;
            } else if(evt.data == 'BTN_RELEASE') {
                button.checked = false;
            }
        };
        ws.onclose = function() { // this function is executed when close websocket
            led.disabled = true;
            document.getElementById('status').innerHTML = 'Disconnected';
        };

        led.onchange = function() { // to turn on/off LED
            var status = 'LED_OFF';
            if (led.checked) {
                status = 'LED_ON';
            }
            ws.send(status)
        }

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_completed_program_for_esp8266">Completed program for ESP8266</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESPAsyncWebServer.h&gt;

const char* ssid = "******";
const char* password = "*********";
const int LED = 16;
const int BTN = 0;

// to embedded HTML code into Arduino program, HTML need to be converted to char

const char index_html[] PROGMEM = ""
"&lt;!DOCTYPE HTML&gt;"
"&lt;html&gt;"
"&lt;head&gt;"
"    &lt;title&gt;ESP8266 WebSocket&lt;/title&gt;"
"&lt;/head&gt;"
"&lt;body&gt;"
"    &lt;div&gt; Webscoket status &lt;span id=\"status\" style=\"font-weight: bold;\"&gt; disconnected &lt;/span&gt; &lt;/div&gt;"
"    &lt;div&gt; ESP8266 Button Status &lt;input type=\"checkbox\" id=\"btn\" name=\"btn\" /&gt; &lt;/div&gt;"
"    &lt;div&gt; Control LED &lt;input type=\"checkbox\" id=\"led\" name=\"led\" disabled=\"true\" /&gt; &lt;/div&gt;"
"    &lt;script type=\"text/javascript\"&gt;"
"        var button = document.getElementById('btn');"
"        var led = document.getElementById('led');"
"        var status = document.getElementById('status');"
"        var url = window.location.host;"
"        var ws = new WebSocket('ws://' + url + '/ws');"
"        ws.onopen = function()"
"        {"
"            status.text = 'Connected';"
"            led.disabled = false;"
"        };"
"        ws.onmessage = function(evt)"
"        {"
"            if(evt.data == 'BTN_PRESSED') {"
"                button.checked = true;"
"            } else if(evt.data == 'BTN_RELEASE') {"
"                button.checked = false;"
"            }"
"        };"
"        ws.onclose = function() {"
"            led.disabled = true;"
"            status.text = 'Disconnected';"
"        };"
"        led.onchange = function() {"
"            var status = 'LED_OFF';"
"            if (led.checked) {"
"                status = 'LED_ON';"
"            }"
"            ws.send(status)"
"        }"
"    &lt;/script&gt;"
"&lt;/body&gt;"
"&lt;/html&gt;";

AsyncWebServer server(8000);
AsyncWebSocket ws("/ws");


// Event handler function on Server when browser client trigger an event
void onWsEvent(AsyncWebSocket * server, AsyncWebSocketClient * client, AwsEventType type, void * arg, uint8_t *data, size_t len) {
  if (type == WS_EVT_DATA &amp;&amp; len &gt; 0) { // type: type of event received by server. If event comes from websocket, start to process
    data[len] = 0;
    String data_str = String((char*)data); // casting from char to String
    if (data_str == "LED_ON") {
      digitalWrite(LED, 0); // When client trigger event"LED_ON" server turn on the LED
    } else if (data_str == "LED_OFF") {
      digitalWrite(LED, 1); // When client trigger event "LED_OFF" server turn off the LED
    }
  }

}
void setup()
{
  pinMode(LED, OUTPUT);
  pinMode(BTN, INPUT);
  Serial.begin(115200);
  Serial.setDebugOutput(true);
  WiFi.mode(WIFI_AP_STA);
  WiFi.begin(ssid, password);
  if (WiFi.waitForConnectResult() != WL_CONNECTED) {
    Serial.printf("STA: Failed!\n");
    WiFi.disconnect(false);
    delay(1000);
    WiFi.begin(ssid, password);
  }


  ws.onEvent(onWsEvent); // onWsEvent is called
  server.addHandler(&amp;ws);
  server.on("/", HTTP_GET, [](AsyncWebServerRequest * request) {

    request-&gt;send_P(200, "text/html", index_html); // return index.html file on browser interface when browser access to server's IP address
  });
    server.begin(); // turn on server

}


void loop()
{
  static bool isPressed = false;
  if (!isPressed &amp;&amp; digitalRead(BTN) == 0) { // GPIO0 button pressed
    isPressed = true;
    ws.textAll("BTN_PRESSED");
  } else if (isPressed &amp;&amp; digitalRead(BTN)) { // GPIO0 button released
    isPressed = false;
    ws.textAll("BTN_RELEASE");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute after check the source code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a></p>
</li>
<li>
<p><a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_result_2">Result</h3>
<div class="paragraph">
<p>After completing compile code onto Arduino, open web browser, access into the IP address of ESP8266 returned on Serial Monitor with port configured on server, in this case is 192.168.1.65:8000</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/07-websocket/websocketBrowser.png" alt="websocketBrowser" width="500">
</div>
<div class="title">Figure 60. Web browser can control ESP8266 via Web Socket</div>
</div>
</div>
<div class="sect2">
<h3 id="_result_video">Result video</h3>
<div class="videoblock">
<div class="content">
<iframe src="https://www.youtube.com/embed/pN3YSLiWbHk?rel=0&amp;hl=en" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_esp8266_as_websocket_client">Using ESP8266 as Websocket Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some other applications, we have a WebSockets server to perform real-time tasks such as mobile applications, web applications. In this case, ESP8266 can directly connect to these servers as a WebSocket Client to receive, or send data via WebSockets.</p>
</div>
<div class="paragraph">
<p>Some famous services use WebSockets such as messenger service <a href="https://slack.com">Slack</a>, real-time database service <a href="https://firebase.google.com">Firebase</a></p>
</div>
<div class="paragraph">
<p>In this part, we will use Node.js to build a Web server, it plays the roll of a WebSocket server. Which has features on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide the file <code>index.html</code> including javascript snippet code to create a WebSockets connection between browser and Server, it is like <a href="#server-nodejs">Server Nodejs</a></p>
</li>
<li>
<p>Allow WebSockets connections, from web browsers, or from ESP8266</p>
</li>
<li>
<p>Server will broadcast all data packages from any client to all other clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the features above, you can imagine like this: If web browser windows has WebSockets connections to Server, when a checkbox is checked, it send to server the checkbox status. For example <code>LED_ON</code>, after received, server will broadcast data <code>LED_ON</code> to all other browser (or ESP8266), and all other browser will display checkbox status as checked.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/07-websocket/same-ctrl.png" alt="same ctrl" width="600">
</div>
<div class="title">Figure 61. Two browser windows will display checkbox&#8217;s status the same when checked status changes</div>
</div>
<div class="sect2">
<h3 id="_websocket_client_javascript_on_web_browser">Websocket Client Javascript on web browser</h3>
<div class="paragraph">
<p>With <code>index.html</code> file which includes Javascript code to create connection to WebSockets, placed in the same directory with <code>server.js</code></p>
</div>
<div class="listingblock">
<div class="title">index.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;ESP8266 WebSocket&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt; Webscoket status &lt;span id="status" style="font-weight: bold;"&gt; disconnected &lt;/span&gt; &lt;/div&gt;
    &lt;div&gt; ESP8266 Button Status &lt;input type="checkbox" id="btn" name="btn" /&gt; &lt;/div&gt;
    &lt;div&gt; Control LED &lt;input type="checkbox" id="led" name="led" disabled="true" /&gt; &lt;/div&gt;

    &lt;script type="text/javascript"&gt;
        var button = document.getElementById('btn');
        var led = document.getElementById('led');
        var url = window.location.host; // return current page's url and port
        var ws = new WebSocket('ws://' + url + '/ws'); // create a websocket with port 8000
        console.log('connecting...')
        ws.onopen = function() // this function is executed when websocket is opened
        {
            document.getElementById('status').innerHTML = 'Connected';
            led.disabled = false; // until websocket is opened, it is allowed
            console.log('connected...')
        };

        ws.onmessage = function(evt) // event triggered when client received data from server
        {
            console.log(evt.data)
            if(evt.data == 'BTN_PRESSED') {
                button.checked = true;
            } else if(evt.data == 'BTN_RELEASE') {
                button.checked = false;
            } else if(evt.data == 'LED_OFF') {
                led.checked = false;
            } else if(evt.data == 'LED_ON') {
                led.checked = true;
            }
        };
        ws.onclose = function() { // this function is executed when close websocket
            led.disabled = true;
            document.getElementById('status').innerHTML = 'Connected';
        };

        led.onchange = function() { // to turn on/off LED
            var led_status = 'LED_OFF';
            if (led.checked) {
                led_status = 'LED_ON';
            }
            ws.send(led_status)
        }

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_node_js_websocket_server">Node.js Websocket Server</h3>
<div class="paragraph">
<p>In this article, we use WebSockets library <code>ws</code> <a href="https://github.com/websockets/ws" class="bare">github.com/websockets/ws</a>. You can install by run the command line:</p>
</div>
<div class="paragraph">
<p><code>npm install ws</code></p>
</div>
<div class="listingblock">
<div class="title">server.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var fs = require('fs');
var url = require('url');
var http = require('http');
var WebSocket = require('ws');


// function to send the response from server side, or receive the request from client
function requestHandler(request, response) {
    fs.readFile('./index.html', function(error, content) {
        response.writeHead(200, {
            'Content-Type': 'text/html'
        });
        response.end(content);
    });

}

// create http server
var server = http.createServer(requestHandler);
var ws = new WebSocket.Server({ server });
var clients = [];

function broadcast(socket, data) {
    console.log(clients.length);
    for(var i=0; i&lt;clients.length; i++) {
        if(clients[i] != socket) {
            clients[i].send(data);
        }
    }
}
ws.on('connection', function(socket, req) {
    clients.push(socket);

    socket.on('message', function(message) {
        console.log('received: %s', message);
        broadcast(socket, message);
    });

    socket.on('close', function() {
        var index = clients.indexOf(socket);
        clients.splice(index, 1);
        console.log('disconnected');
    });
});

server.listen(8000);
console.log('Server listening on port 8000');</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_esp8266_websocket_client">ESP8266 Websocket Client</h3>
<div class="paragraph">
<p><a href="https://github.com/Links2004/arduinoWebSockets" class="bare">github.com/Links2004/arduinoWebSockets</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;Arduino.h&gt;

#include &lt;ESP8266WiFi.h&gt;
#include &lt;WebSocketsClient.h&gt; //https://github.com/Links2004/arduinoWebSockets
WebSocketsClient webSocket;

const char* ssid = "...";
const char* password = "...";
const int LED = 16;
const int BTN = 0;

void webSocketEvent(WStype_t type, uint8_t * payload, size_t length) {
  switch (type) {
    case WStype_DISCONNECTED:
      Serial.printf("[WSc] Disconnected!\n");
      break;
    case WStype_CONNECTED:
      {
        Serial.printf("[WSc] Connected to url: %s\n",  payload);
      }
      break;
    case WStype_TEXT:
      Serial.printf("[WSc] get text: %s\n", payload);
      if(strcmp((char*)payload, "LED_ON") == 0) {
        digitalWrite(LED, 0); // When client trigger event"LED_ON" server turn on the LED
      } else if(strcmp((char*)payload, "LED_OFF") == 0) {
        digitalWrite(LED, 1); // When client trigger event "LED_OFF" server turn off the LED
      }
      break;
    case WStype_BIN:
      Serial.printf("[WSc] get binary length: %u\n", length);
      break;
  }
}

void setup() {
  pinMode(LED, OUTPUT);
  pinMode(BTN, INPUT);
  Serial.begin(115200);
  Serial.println("ESP8266 Websocket Client");
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  webSocket.begin("192.168.0.106", 8000);
  webSocket.onEvent(webSocketEvent);

}

void loop() {
  webSocket.loop();
  static bool isPressed = false;
  if (!isPressed &amp;&amp; digitalRead(BTN) == 0) { // GPIO0 button pressed
    isPressed = true;
    webSocket.sendTXT("BTN_PRESSED");
  } else if (isPressed &amp;&amp; digitalRead(BTN)) { // GPIO0 button released
    isPressed = false;
    webSocket.sendTXT("BTN_RELEASE");
  }
}</code></pre>
</div>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/07-websocket/browser-esp.png" alt="browser esp" width="600">
</div>
<div class="title">Figure 62. Click the checkbox will change LED&#8217;s status on board</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary_8">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using WebSocket protocol has bunch of advantages on two-ways connections, stable and minor latency.</p>
</div>
</div>
</div>
<h1 id="_fota" class="sect0">Firmware update over the air (FOTA)</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Among nowadays software development and products development processes, partially periodically public the result bring the most effective, products will earlier derive to end user, earlier get user&#8217;s feedback, and more reasonable customized. The early public make products poor of features and need to update, and enrich products' quality in the future.</p>
</div>
<div class="paragraph">
<p>Applications update over the air on mobile phone and PC is already popular. Software applications are updated weekly, monthly&#8230;&#8203; to fix issues, upgrade features.</p>
</div>
<div class="paragraph">
<p>It is similar with hardware products, features should be updated over the air since the development phase. Beside the easy to update features in the future, issues fixing, system upgrade over the air will save a lot of costs and resources.</p>
</div>
<div class="paragraph">
<p>In this article, we will study methods to update over the air for ESP8266, how to wireless flash the firmware for module, how ESP8266 can automatically download the firmware, how ESP8266 can automatically boots up an HTTP server to get the web interface then upload firmware onto chip.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firmware_update_over_the_air">Firmware update over the air</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Firmware update OTA (Over the Air) is the process of uploading a new firmware onto ESP8266 module instead of using serial ports. This feature is very useful in cases of limited physical connect to ESP Module.</p>
</div>
<div class="paragraph">
<p>OTA is available on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Arduino IDE</p>
</li>
<li>
<p>Web Browser</p>
</li>
<li>
<p>HTTP Server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using OTA with Arduino IDE option during development phase, testing, the rest 2 options is suitable for real application deployment, provide OTA update via web or by using HTTP server.</p>
</div>
<div class="paragraph">
<p>In all cases, OTA supported firmware need to be uploaded the first time via serial ports, if it works fluently, OTA logic applied properly then firmware update OTA is now possible.</p>
</div>
<div class="paragraph">
<p>There is not security guarantee for the OTA update what can be hacked. It is depends on the development company who ensure the legal and authorised update. When updating is completed, ESP8266 will reboot and execute the new code. Developers must make sure that real applications on module are terminated and restart safely. Bellow content provide additional information about security, and safety for OTA update process.</p>
</div>
<div class="sect2">
<h3 id="_security">Security</h3>
<div class="paragraph">
<p>When ESP8266 is allowed to perform OTA, that means it is wireless connected and be able to update the new Sketch. So, the ability of being attacked is higher and the probability of being flashed another code onto ESP8266 is more than higher. To reduce the risk of being attacked, it need to considering to protect your update with a password, stable fixed different port, etc.</p>
</div>
<div class="paragraph">
<p>Frequently check features provided by ArduinoOTA library, it can be upgraded the secure ability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void setPort(uint16_t port);
void setHostname(const char* hostname);
void setPassword(const char* password);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some secure features are already built-in and do not require any encryption from developers. ArduinoOTA and espota.py use Digest-MD5 to authorise uploading firmware. Simply ensure the integrity of firmware by calculating MD5.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s analyze the risk for your own application and base on your application to decide which features and libraries to execute. If need, consider to effectuate protecting procedure against hacked, for example OTA update only allowed to upload follow specific schedule, activating OTA is only when user press the dedicated button "update", etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_safety">Safety</h3>
<div class="paragraph">
<p>OTA procedure consumes resource and bandwidth of ESP8266 when uploaded. After that ESP8266 is restarted and executes an new Sketch. It need to analyze and check the affect of this process to old features and the new Sketch of ESP module.</p>
</div>
<div class="paragraph">
<p>If ESP is placed far away and controlling some devices, we should take care on slave devices if it is unexpected stop due to update process. So that, we should confirm the normal working status of devices before update process. For example, module is used to control water supplier system in the garden. If during operation process, controlling system is suddenly terminated and valves are opened, then all the garden will be flooded.</p>
</div>
<div class="paragraph">
<p>Below functions are provided by ArduinoOTA library and used to handle applications during OTA update process or handle if OTA is failed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void onStart(OTA_CALLBACK(fn));
void onEnd(OTA_CALLBACK(fn));
void onProgress(OTA_CALLBACK_PROGRESS(fn));
void onError(OTA_CALLBACK_ERROR (fn));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fundamental_requirements">Fundamental requirements</h3>
<div class="paragraph">
<p>Flash memory must has enough space for both the old sketch (operating the system) and the new sketch (OTA update).</p>
</div>
<div class="paragraph">
<p>Files and EEPROM are also need enough free space.</p>
</div>
<div class="paragraph">
<p><strong>Function</strong> <code>ESP.getFreeSketchSpace();</code> is used to check the free space for the new sketch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update_process_memory_view">Update process - memory view</h3>
<div class="ulist">
<ul>
<li>
<p>The new sketch  will be saved in the free space between old sketch and spiff.</p>
</li>
<li>
<p>In the next reboot, “eboot” bootloader checks command lines.</p>
</li>
<li>
<p>New sketch will be copied.</p>
</li>
<li>
<p>New sketch start.</p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/update.png" alt="update" width="400">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ota_using_arduino_ide">OTA using Arduino IDE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OTA update with Arduino IDE should be done only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To upload firmware for ESP8266 module via WiFi without serial ports</p>
</li>
<li>
<p>ESP8266 and PC which run Arduino IDE are connected to the same local WiFi network</p>
</li>
<li>
<p>ESP8266 is successfully connected to WiFi network</p>
</li>
<li>
<p>Supported OTA firmware is flashed via serial ports previously</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before start, it is needed to ensure that the latest version of Arduino IDE is installed, including ESP8266 pack for Arduino, and Python 2.7</p>
</div>
<div class="sect2">
<h3 id="ota-step1">Step 1: Upload OTA supported firmware via serial ports</h3>
<div class="paragraph">
<p>Open sample sketch <code>BasicOTA.ino</code>. Open File &gt; Examples &gt; ArduinoOTA.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/00.png" alt="00" width="400">
</div>
<div class="title">Figure 63. Open OTA sample sketch</div>
</div>
<div class="paragraph">
<p>Provide the proper SSID and password of WiFi network for ESP8266 to connect</p>
</div>
<div class="listingblock">
<div class="title">Provide SSID and password</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">const char* ssid = "..........";
const char* password = "..........";</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Base on IDE&#8217;s version and using ESP board, you can see ``Upload Using:`` in menu. This option will not take effect to your choice. This feature is compatible with older OTA versions and be uninstall in platform package version 2.2.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Upload sketch <code>Ctrl+U</code> When completed, open Serial Monitor <code>Ctrl+Shift+M</code> (reference <a href="#arudino-term">using Arduino IDE Serial Monitor</a>) and check if module is accessed to WiFi or not</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/basicota.png" alt="basicota" width="600">
</div>
<div class="title">Figure 64. Check if ESP8266 module is accessed to local WiFi network or not</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ESP module should be resetted after complete uploading firmware
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESP8266mDNS.h&gt;
#include &lt;WiFiUdp.h&gt;
#include &lt;ArduinoOTA.h&gt;

const char* ssid = "...";
const char* password = "...";

void setup() {
  Serial.begin(115200);
  Serial.println("Booting");
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);
  while (WiFi.waitForConnectResult() != WL_CONNECTED) {
    Serial.println("Connection Failed! Rebooting...");
    delay(5000);
    ESP.restart();
  }
  ArduinoOTA.onStart([]() {
    String type;
    if (ArduinoOTA.getCommand() == U_FLASH)
      type = "sketch";
    else // U_SPIFFS
      type = "filesystem";

    // NOTE: if updating SPIFFS this would be the place to unmount SPIFFS using SPIFFS.end()
    Serial.println("Start updating " + type);
  });
  ArduinoOTA.onEnd([]() {
    Serial.println("\nEnd");
  });
  ArduinoOTA.onProgress([](unsigned int progress, unsigned int total) {
    Serial.printf("Progress: %u%%\r", (progress / (total / 100)));
  });
  ArduinoOTA.onError([](ota_error_t error) {
    Serial.printf("Error[%u]: ", error);
    if (error == OTA_AUTH_ERROR) Serial.println("Auth Failed");
    else if (error == OTA_BEGIN_ERROR) Serial.println("Begin Failed");
    else if (error == OTA_CONNECT_ERROR) Serial.println("Connect Failed");
    else if (error == OTA_RECEIVE_ERROR) Serial.println("Receive Failed");
    else if (error == OTA_END_ERROR) Serial.println("End Failed");
  });
  ArduinoOTA.setPassword((const char *)"ota-pass");
  ArduinoOTA.begin();
  Serial.println("Ready");
  Serial.print("IP address: ");
  Serial.println(WiFi.localIP());
}

void loop() {
  ArduinoOTA.handle();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_chose_uploading_port_via_ota">Step 2: Chose uploading port via OTA</h3>
<div class="paragraph">
<p>When module is successfully connected to WiFi network, after some seconds, esp8266-ota port will appear on Arduino IDE. Now you can totally remove the serial connection from the board to your computer. Arduino IDE can flash new firmwares via WiFi. chose the port with IP address as shown in the Serial Monitor at the previous step.</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/select-port.png" alt="select port" width="400">
</div>
<div class="title">Figure 65. Chose the flashing port from Network</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If OTA port does not appear, you neet to close Arduino IDE and restart. Check the OTA port again. If OTA port still not appears, check the computer firewall and other configurations on router.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_modify_new_firmware_and_re_upload_via_wifi">Step 3: Modify new firmware and re-upload via WiFi</h3>
<div class="paragraph">
<p>After chose the correct OTA flash port, you are totally able to modify the new firmware and re-upload via WiFi, but need to notice that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New firmware must safely keeps the connection to WiFi (wrong-password-update for example)</p>
</li>
<li>
<p>New firmware must contains the OTA initialize and OTA processing like <a href="#ota-step1">Step 1: Upload OTA supported firmware via serial ports</a></p>
</li>
</ul>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/ota-ok.png" alt="ota ok" width="400">
</div>
<div class="title">Figure 66. Success uploading firmware via OTA</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_password">Using password</h3>
<div class="paragraph">
<p>Protecting OTA uploading process is quite simple. All you need to do is add the bellow code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ArduinoOTA.setPassword((const char *)"your-password");</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, re-upload the sketch again (using OTA). After completely compile and upload, password requirement window will be shown:</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/ota-pass.png" alt="ota pass" width="300">
</div>
<div class="title">Figure 67. Password for OTA</div>
</div>
<div class="paragraph">
<p>Enter password, if correct, result is the notice <code>Authenticating...OK</code> and uploading process runs normally.</p>
</div>
<div class="paragraph">
<p>Next uplading times, Arduino IDE remember the password and does not ask again, except you change the OTA password, and the authentication step is not success, Arduino IDE will ask it again.</p>
</div>
<div class="paragraph">
<p>Keep in mind that password is easy to see, if IDE is not closed after the last uploading time. This can be done by <code>Show verbose ouput during: upload</code> in <code>File &gt; Preferences</code> and upload to module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_common_errors">Common errors</h3>
<div class="paragraph">
<p>If OTA update is failed, the first step you need to do is check the error message at Arduino IDE&#8217;s Log windows. If it can not help, let&#8217;s upload again after check informations of ESP on serial port.</p>
</div>
<div class="paragraph">
<p>Popular causes of OTA error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is not enough free space on chip (ESP01 with 512KB flash memory is not enough for OTA).</p>
</li>
<li>
<p>Data zone for SPIFFS is too big, not enough space for firmware, in case you have 4MB Flash, this situation will not occur.</p>
</li>
<li>
<p>Memory zize for firmware is too small, minimum size should be 512KB</p>
</li>
<li>
<p>Do not reset ESP after the first uploading via serial port.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firmware_using_web_browser">Firmware using Web Browser</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When updating firmware using Web Browser, ESP8266 will lunch an HTTP Server, with an uploading form. When access the correct address, you will get an interface to chose binary file, and upload to chip. This is useful if not using Arduino IDE for updating, using the already available browser. Or integrate into an application which you might want to update in the future.</p>
</div>
<div class="paragraph">
<p>Updating via web browser is done by <code>ESP8266HTTPUpdateServer</code> library and 2 other libraries <code>ESP8266WebServer</code> and <code>ESP8266mDNS</code> for recognizing ESP8266 in the local network.</p>
</div>
<div class="sect2">
<h3 id="_implementation">Implementation</h3>
<div class="paragraph">
<p>Open sample: <code>File &gt; Examples &gt; ESP8266HTTPUpdateServer &gt; WebUpdater</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;ESP8266WiFi.h&gt;
#include &lt;WiFiClient.h&gt;
#include &lt;ESP8266WebServer.h&gt;
#include &lt;ESP8266mDNS.h&gt;
#include &lt;ESP8266HTTPUpdateServer.h&gt;

const char* host = "esp8266-webupdate";
const char* ssid = "...";
const char* password = "...";

ESP8266WebServer httpServer(80);
ESP8266HTTPUpdateServer httpUpdater;

void setup(void){

  Serial.begin(115200);
  Serial.println();
  Serial.println("Booting Sketch...");
  WiFi.mode(WIFI_AP_STA);
  WiFi.begin(ssid, password);

  while(WiFi.waitForConnectResult() != WL_CONNECTED){
    WiFi.begin(ssid, password);
    Serial.println("WiFi failed, retrying.");
  }

  MDNS.begin(host);
  httpUpdater.setup(&amp;httpServer);
  httpServer.begin();

  MDNS.addService("http", "tcp", 80);
  Serial.printf("HTTPUpdateServer ready! Open http://%s.local/update in your browser\n", host);
}

void loop(void){
  httpServer.handleClient();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Provide the correct SSID, WiFi password you are using, flash firmware <code>WebUpdater</code> onto ESP8266 <a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a> and <a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice that the computer should be in the same WiFi network with ESP8266
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you can not access to module ESP8266 via serial port, to recognize module&#8217;s IP address in LAN, you can run the service mDNS on your computer. This service is already available in MacOS, however, in Linux, you should install Avahi: <a href="https://avahi.org/" class="bare">avahi.org/</a>, and Bonjour for Windows: <a href="https://support.apple.com/downloads/bonjour_for_windows" class="bare">support.apple.com/downloads/bonjour_for_windows</a></p>
</div>
<div class="paragraph">
<p>With mDNS service on the computer, you can easily access to ESP8266 via <a href="http://esp8266-webupdate.local/update" class="bare">esp8266-webupdate.local/update</a></p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/web-updater.png" alt="web updater" width="600">
</div>
<div class="title">Figure 68. Web interface to update firmware</div>
</div>
<div class="paragraph">
<p>By choosing file and press update, ESP8266 will update the new firmware you upload. This file can be exportd by <code>Sketch &gt; Export compiled Binary</code>, and the .bin file will be placed in the folder of Sketch</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/export-fw.png" alt="export fw" width="400">
</div>
<div class="title">Figure 69. Export Binary file</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you enter <a href="http://esp8266-webupdate.local/update" class="bare">esp8266-webupdate.local/update</a> but it is not affect, let&#8217;s change esp8266-webupdate with the new IP address of module (you can find it at modem/router, or Serial Terminal). For example, if module&#8217;s IP is <code>192.168.1.100</code> then the URL should be <a href="http://192.168.1.100/update" class="bare">192.168.1.100/update</a>. This method is useful incase of host software which installed at step 1 does not work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If all above step works properly, on web browser and Serial Terminal (if opened) should look like this</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/finish.png" alt="finish" width="600">
</div>
<div class="title">Figure 70. Successfully update firmware using WebUpdater</div>
</div>
</div>
<div class="sect2">
<h3 id="_security_2">Security</h3>
<div class="paragraph">
<p>If you include WebUpdater into your product, of course you do not want any one else upload another firmware. Let&#8217;s use the method <code>httpUpdater.setup(&amp;httpServer, update_path, update_username, update_password);</code> with parameters username, password which you must enter the correctly to upload the new firmware.</p>
</div>
<div class="paragraph">
<p>Open the sample: <code>File &gt; Examples &gt; ESP8266HTTPUpdateServer &gt; SecureWebUpdater</code> for details</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_server">HTTP Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With 2 above methods, you can easily update Firmware via local WiFi network. However, when deploy real life applications, we need to update Firmware OTA via Internet, and need a server to stored firmware, and manage all versions.</p>
</div>
<div class="paragraph">
<p>A common scrip which usually being done is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When ESP8266 start (after an interval of time - 1 day for example), it will connect to server, provide it&#8217;s current version</p>
</li>
<li>
<p>When server relize that the current version should be upgraded, it return the new fimrware</p>
</li>
<li>
<p>If current version of ESP8266 is not need to update, it return the 304 code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to do this, we need to perform on both ESP8266 and from server side. Practice for this, we will use Node.js to built a server. You are surely execute this snippet code and assign for domain then access everywhere.</p>
</div>
<div class="sect2">
<h3 id="esp8266-ESPhttpUpdate">ESP8266 ESPhttpUpdate</h3>
<div class="paragraph">
<p>By execute <code>ESPhttpUpdate.update("your-domain.com", 8000, "/fimrware.bin");</code>, ESP8266 will automatically connect to server at <a href="http://your-domain.com:8000/fimrware.bin" class="bare">your-domain.com:8000/fimrware.bin</a> to download the new fimrware. HTTP Status Code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(Code) 200: If the new firmware exists, and the file&#8217;s content will be transfered accompanyly after that</p>
</li>
<li>
<p>(Code) 304: Notice that there is no update available.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Snippet code can easily be found at <code>File &gt; Examples &gt; ESPhttpUpdate &gt; httpUpdate</code></p>
</div>
<div class="paragraph">
<p>You need to provide SSID, correct WiFi password, execute <a href="#select-arduino-board">Select Board ESP8266 WiFi Uno in Arduino IDE</a> and <a href="#arduino-flash">Load the program file into the board using the Arduino IDE</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;Arduino.h&gt;
#include &lt;ESP8266WiFi.h&gt;
#include &lt;ESP8266HTTPClient.h&gt;
#include &lt;ESP8266httpUpdate.h&gt;

const char* ssid = "...";
const char* password = "...";
const char *currentVersion = "1.0"; <i class="conum" data-value="1"></i><b>(1)</b>
const char *serverUrl = "http://192.168.0.106:8000/firmware.bin"; <i class="conum" data-value="2"></i><b>(2)</b>
void setup() {

  Serial.begin(115200);
  Serial.println();
  Serial.println();
  Serial.print("ESP8266 http update, current version: ");
  Serial.println(currentVersion);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  t_httpUpdate_return ret = ESPhttpUpdate.update(serverUrl, currentVersion);
  switch (ret) {
    case HTTP_UPDATE_FAILED:
      Serial.printf("HTTP_UPDATE_FAILD Error (%d): %s", ESPhttpUpdate.getLastError(), ESPhttpUpdate.getLastErrorString().c_str());
      break;

    case HTTP_UPDATE_NO_UPDATES:
      Serial.println("HTTP_UPDATE_NO_UPDATES");
      break;
    case HTTP_UPDATE_OK:
      Serial.println("HTTP_UPDATE_OK");
      break;
  }

}

void loop() {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Your fimrware, assume that you modify as <code>2.0</code> and place on server, after that you undo to <code>1.0</code> and upload onto board</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The path to your firmware, web address, or domain</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_node_js_ota_server">Node.js OTA Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When ESP8266 connected to web server. it provide Header&#8217;s information and base on that, server evaluate the fimrware if it is needs to update or not. Headers example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">[HTTP_USER_AGENT] =&gt; ESP8266-http-Update
[HTTP_X_ESP8266_STA_MAC] =&gt; 18:FE:AA:AA:AA:AA
[HTTP_X_ESP8266_AP_MAC] =&gt; 1A:FE:AA:AA:AA:AA
[HTTP_X_ESP8266_FREE_SPACE] =&gt; 671744
[HTTP_X_ESP8266_SKETCH_SIZE] =&gt; 373940
[HTTP_X_ESP8266_SKETCH_MD5] =&gt; a56f8ef78a0bebd812f62067daf1408a
[HTTP_X_ESP8266_CHIP_SIZE] =&gt; 4194304
[HTTP_X_ESP8266_SDK_VERSION] =&gt; 1.3.0
[HTTP_X_ESP8266_VERSION] =&gt; 1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Base on the knowledge at <a href="#server-nodejs">Server Nodejs</a>, we can build a OTA server using Node.js as below</p>
</div>
<div class="listingblock">
<div class="title">server.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var fs = require('fs');
var url = require('url');
var http = require('http');
var querystring = require('querystring');
var crypto = require('crypto');
// function send request(response) from server side or receive the request from client
function requestHandler(request, response) {

    // Assume that firmware address http://192.168.1.7:8000/firmware.bin
    var uriData = url.parse(request.url);
    var pathname = uriData.pathname;          // /firmware.bin

    if (pathname == '/firmware.bin') {
        var ver = request.headers['x-esp8266-version'];
        console.log('Client request update, version ', ver);
        if(ver == '1.0') {
            console.log('Send firmware 2.0 to client');
            fs.readFile('./esp8266-firmware-2.0.bin', function(error, content) {
                response.writeHead(200, {
                    'Content-Type': 'binary/octet-stream',
                    'Content-Length': Buffer.byteLength(content),
                    'x-MD5': crypto.createHash('md5').update(content).digest("hex")
                });
                response.end(content);
            });
        } else {
            response.statusCode = 304;
            response.end();
        }
    }
}
var server = http.createServer(requestHandler);
server.listen(8000);
console.log('Server listening on port 8000');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute <code>node server.js</code> to start server</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you work with different programing languages, always make sure that data send to client must contains enough header&#8217;s information <code>Content-Length</code> and <code>x-MD5</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need <code>esp8266-firware-2.0.bin</code> file at folder <a href="#esp8266-ESPhttpUpdate">ESP8266 ESPhttpUpdate</a> compiled with <code>currentVersion = "2.0"</code> which placed at the same folder with <code>server.js</code> file
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you follow all above steps, the result should look like this</p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/08-fota/http-ota.png" alt="http ota" width="600">
</div>
<div class="title">Figure 71. Result of OTA by using HTTP Server</div>
</div>
</div>
</div>
<h1 id="_cheat_sheet" class="sect0">Cheatsheet</h1>
<div class="openblock partintro">
<div class="content">
This article provides information for quickly tracking functions that can be used with Arduino, ESP8266 and the C programming language. There are many libraries for Arduino which provides useful APIs, this brief content only mention about the most popular libraries. If you use another library, you can easily check its user guide. Normally, opened source library on <a href="https://github.com">Github</a> included the README.md file, which contains all the information.
</div>
</div>
<div class="sect1">
<h2 id="_arduino_esp8266_cheatsheet">Arduino - ESP8266 Cheatsheet</h2>
<div class="sectionbody">
<table class="tableblock frame-none grid-none spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* BASIC STRUCTURE OF A SKETCH */
void setup() {
  /*
   * This function is called at the starting point of
   * sketch. Using to initialize variables, ports
   * configuration, import libraries, etc. This
   * code runs only one time (boots up or reset board)
   */
}
void loop() {
  // Infinitely repeated inside loop()
}

/* CONDITIONAL STATEMENTS */
if (x &lt; 5)      // execute if x&lt;5
 { code }
else if (x &gt; 10)// execute if x&gt;10
	{ code }
else { code }   // execute in other cases

switch (var) {
case 1:
...
break;
case 2:
...
break;
default:
...
}

/* LOOPS */
while (x &lt; 5) { code };
do { code } while(x &lt; 0);
/* Initialize i, execute code then increase i
 * if i &lt; 10
 */
for (int i = 0; i &lt; 10; i++) { code };
/* Quit the loop (for, while, do-while) instantly */
break;
/* Jump to the next cycle of current loop */
continue;

/* FUNCTIONAL DEFINITIONS */
&lt;ret. type&gt; &lt;name&gt;(&lt;params&gt;) { ... }
int func_name(int x) { return x*2; }
return x; // x must match the return type of the function
return;   // return type for void function

/* INCLUDE */
/* include standard library */
#include &lt;stdio.h&gt;
/* include user’s library */
#include "your-library.h"</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* STRING DATA TYPE */
/* String included the end of string character \0 */
char str1[8] = {'A','r','d','u','i','n','o','\0'};
/* Compiler automatically add the character \0 into the
 * end of string
 */
char str2[8] = {'A','r','d','u','i','n','o'};
/* String delcareation, without the number of children
 * and assign the value
 */
char str3[] = "Arduino";
char str4[8] = "Arduino";

/* ARRAY DATA TYPE */
/* Declare an array of int with 6 children and assign
 * values for each
 */
int myPins[] = {2, 4, 8, 3, 6};
/* integer array of 6 children without values
 * assignment
 */
int myInts[6];
/* Assign the value of 42 for the first child */
myInts[0] = 42;
/* FAILED ! array index is only from 0 to 5 */
myInts[6] = 12;

/* Qualifiers */
static   // Does not change the value
volatile // In RAM (Usually used with interrupt)
const    // Constant (read only)
PROGMEM  // Allow to save data in FLASH instead of SRAM

/* OPERATOS, OPERATIONS */
/* Popular operators */
=   assignment operator
+   addition operator
-   subtraction operator
*   multiply operator
/   division operator
%   modulus operator
==  equality operator
!=  inequality operator (different)
&lt;   less than operator
&gt;   greater than operator
&lt;=  less or equal operator
&gt;=  greater or equal operator &amp;&amp;  logical AND operator (AND)
||  logical OR operator (OR)
!   logical NOT operator (NOT)

/* Compound assignment operators */
++ increment operator
-- subtraction operator
+= addition assignment operator</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">   ex: x = 5; x+= 1; //x = 6
-= subtraction assignment operator
   ex: x = 5; x-= 1; //x = 4
*= multiplication assignment operator
   ex: x = 5; x*= 3; //x = 15
/= division assignment operator
   ex: x = 6; x/= 2; //x = 3
&amp;= logical AND assignment operator
   ex: x = 0b1010; x&amp;= 0110; //x =0b0010
|= logical OR assignment operator
   ex: x = 0b1010; x&amp;= 0110; //x =0b1110

/* Bitwise operators */
&amp;   and          ^   xor
&lt;&lt;  bitwise left shift
&gt;&gt;  bitwise right shift
|  or           ~   not

/* Pointer operators */
&amp;reference:  // address-of
*dereference:// value-of

/* CONSTANS AND DATA TYPES */
123     Decimal number
0b0111  Binary number
0173    Octal - base 8
0x7B    Hexal - base 16
123U    Unsigned integer
123L    Signed integer 4 bytes
123UL   Unsigned integer 4bytes
123.0   Real number
1.23e6  Real number with exponential
ex: 1.23*10^3 = 1230

/* DATA TYPE RANGE */
boolean       true | false
char          -128        - 127, 'a' '$' etc.
unsigned char 0           - 255
byte          0           - 255
int           -32768      - 32767
unsigned int  0           - 65535
word          0           - 65535
long          -2147483648 - 2147483647
unsigned long 0           - 4294967295
float         -3.4028e+38 - 3.4028e+38
double        -3.4028e+38 - 3.4028e+38
void          i.e., no return value

/* VARIABLES DECLARATION */
int       a;
int       a = 0b01111011, b = 0123, c = 1, d;
float     fa = 1.0f;
double    da = 1.0;
char      *pointer;
char      *other_pointer = NULL;

/**
 * BUILT-IN FUNCTIONS
 * Pin Input/Output
 * Digital I/O - pins 0-13 A0-A5
 */

/* Ports configuration */
pinMode(pin,[INPUT, OUTPUT, INPUT_PULLUP])
/* Read the value of port pin_6 and assign to a */
int a = digitalRead(pin_6);</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* Configure the HIGH/LOW level for pin_5 */
digitalWrite(pin_5, [HIGH, LOW])
/* Read values of pins and assign to a, pin A0--&gt;A5 */
int a = analogRead(pin)

/* PWM output - pins 3 5 6 9 10 11
 * ESP8266: pin 0..16, range = 0..1023, 1KHz default
 */
/* Assign PWM for pin */
analogWrite(pin, value)
/* ESP8266: change the PWM RANGE output */
analogWriteRange(new_range)
/* ESP8266: PWM frequency output */
analogWriteFreq(new_frequency)

/* ADVANCED I/O */
/* Generate the square wave with frequency freq_Hz and
 * duty cycle=50%
 */
tone(pin, freq_Hz)
/* Generate the square wave with frequency freq_Hz,
 * duration mili second
 */
tone(pin, freq_Hz, duration_ms)
/* Stop generate the square wave with frequency
 * tone().
 */
noTone(pin)
/* Shift 1 byte, 1 bit each, left end first */
shiftOut(dataPin, clockPin,[MSBFIRST, LSBFIRST], value)
/* Return (ms) of pulse HIGH/LOW on port */
unsigned long pulseIn(pin,[HIGH, LOW])

/* INTERRUPT FUNCTION */
/* Configure interrupt function on ports */
attachInterrupt(interrupt, func, mode)
/*
 * interrupt: number of interruption (normally interrupt
 * ports).
 * func : called on interrupt (notice : there is no
 * attributes and return type).
 * mode : including LOW,CHANGE, RISING, FALLING.
 * Interruption will be triggered when the interrupt
 * ports match the corresponding mode.
 */
/* Disable interrupt */
detachInterrupt(interrupt)
/* Disable all interrupts */
noInterrupts()
/* Allow interrupt after unsigned noInterrupts() */
interrupts()

/*************************************************
 *            POPULAR LIBRARIES                 *
 *************************************************/

/*************************************************
 *                     Serial                    *
 *Library to communicate with PC or via RX/TX*
 *************************************************/
/* Configure the connection serial-UART with speed */
begin(long speed)
/* Disable serial connection */
end()
/* Return number of bytes to read */
int available()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* read data from serial (return the first byte of
 * serial data or -1 if there is no data
 */
int read()
/* Wait for the completion of serial data transfer */
flush()
/* Output data to serial port (with any type of
 * configured data
 */
print(data)
/* Same with print(data) but after print serial-port,
 * cursor jump to the next line
 */
println(data)
/* Send data value/string/array to serial port */
write(byte)
/* Function called when data comes from RX pin */
SerialEvent()

/*************************************************
 *                  Servo.h                      *
 *     Library support to control servo motor *
 *************************************************/
/*
 * Setup port to connect with servo, the pulse’s width
 * pin : Port to connect with servo
 * [min_uS, max_uS] : Pulse’s width by us accompany with
 * rotation angle from 0 to 180
 */
attach(pin, [min_uS, max_uS])
/* Write rotation angle data 0~180 */
write(angle)
/* Write the value to control rotation angle for servo,
 * value from 700 ~ 2300
 */
writeMicroseconds(uS)
/* Read the value of rotation angle (0 to 180) */
int read()
/* Return true if servo connected to pin */
bool attached()
/* Detach servo variable from the connected pin */
detach()

/*************************************************
 *                       Wire.h                  *
 *               Used with I2C connection        *
 *************************************************/
/* Master initialize the Wire lib with I2C connection */
begin()
/* Slave join the i2C connection, addr is the 7 address
 * bits of slave
 */
begin(addr)
/*
 * Master request some bytes from slave:
 * address: 7bits of address of slave.
 * count: Number of requested bytes from master.
 * stop: Boolean, if true, master stop after request and
 * release I2C bus, if false, master request to restart
 * to keep the connection.
 */
requestFrom(address, count, stop)
/* Send the begin signal, data send to the slave with
 * address addr.
 */
beginTransmission(addr)
/* Send data (1 byte) to slave */</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">send(byte)
/* Send data (string) to slave */
send(char * string)
/* Send data (an array )with number of byte is size */
send(byte * data, size)
/* Send stop signal to slave */
endTransmission()
/* Return available byte after read by read() */
int available()
/* Access to 1 byte transmitted from slave to master
 * Or in the reverse direction when received the
 * requestFrom. Return the next received byte
 */
byte receive()
/* handl function is called when slave received data */
onReceive(handl)
/* Handler is called when master request data */
onRequest(handler)

/*************************************************
 *                    ESP8266                   *
 *************************************************/

/* Use when the program need to executes multiple tasks
 * at the same time, support library &lt;Scheduler.h&gt;
 */
void yield();
/* Reset ESP */
void ESP.reset();
/* Return the size of free memory in heap */
uint32_t ESP.getFreeHeap();
/* Return ID of ESP chip */
uint32_t ESP.getChipId();

/*  WIFI STATION CONFIGURATION MODE */
/* Station mode configuration */
WiFi.mode(WIFI_STA);
/* Connect to AP */
WiFi.begin(ssid, password);
/* Disconnect to the current network wifi */
bool WiFi.disconnect();
/* Return IP address of current station */
WiFi.localIP();
/* Return connection status when connected to AP */
WiFi.status();
/* Return the name of connected network WiFi */
WiFi.SSID();
/* Return strength of WiFi (dBm) */
WiFi.RSSI();
/* Begin configure WPS mode */
WiFi.beginWPSConfig();
/* Begin configure the smart configure mode */
WiFi.beginSmartConfig();

/* WIFI SOFT ACCESS POINT (AP) MODE */
/* Declare an AP with name and password */
WiFi.softAP(ssid, password);
/* Declare an AP and set up the AP with IP address,
 * gateway and subnet
 */
WiFi.softAPConfig (local_ip, gateway, subnet);
/* Return the number of stations connected to AP */
WiFi.softAPgetStationNum();
/* Disconnect stations */
WiFi.softAPdisconnect(wifioff);
/* Return IP address of AP */
WiFi.softAPIP();</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">WiFi.softAPIP();
/* Return MAC address of AP */
WiFi.softAPmacAddress(mac);

/* WIFI FEATURES */
/* SCAN */
/* Set up station mode */
WiFi.mode(WIFI_STA);
/* Scan and return the number of available network */
WiFi.scanNetworks();
/* Return name of network(string format)at num */
WiFi.SSID(num).c_str();
/* Return information of all networks */
WiFi.getNetworkInfo(networkItem,&amp;ssid,
&amp;encryptionType, &amp;RSSI,*&amp;BSSID, &amp;channel, &amp;isHidden)

/* DIAGNOSTICS */
/* Objectives : Analyze, provide information an repair
 * when there is no connection to WiFi network.
 */
/* Print out serially diagnostic result of network */
WiFi.printDiag(Serial);
/* Enable debug mode */
Serial.setDebugOutput(true);

/* WEBSERVER */
/* Create a host TCP at port 80 response HTTP requests
 * from client
 */
ESP8266WebServer server (80);
/* Server begins to listen clients */
server.begin();
/* Write data to clients */
server.write(buf, len)
/* Set up server at URL, handleRoot is the content or
 * function will be executed
 */
server.on ( "URL", handleRoot );
/* Server react with clients to send, receive data */
server.handleClient();
/* Return 1 if val is exist on server */
server.hasArg(val)
/* Get value of variable val on server */
server.arg(val);
/* Request update data from server:
 * code : HTTP code
 * text/html : Returned format is HTML
 * content: Content returned from server
 */
server.send (code, "text/html",content);</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* MQTT */
/*
 * Libraries which support MQTT prototype for ESP8266
 * on arduino usually used is ESP8266MQTTClient and
 * PubSubClient. Bellow content explain functions of
 * libraries.
 */

/* Functions of ESP8266MQTTClient library*/
/* Declare a MQTTClient variable mqtt */
MQTTClient mqtt;
/* Get data from subscribed topic */
mqtt.onData([](String topic, String data, bool cont)
/* Unsubscribe topic /qos0 */
mqtt.unSubscribe("/qos0");
/* Subscribe topic and publish messages */
mqtt.onSubscribe([](int sub_id)
/* Publish a message "qos0" to topic /qos0 with QoS =0,
 * and Retain = 0
 */
mqtt.publish("/qos0", "qos0", 0, 0);
/* Connect to server MQTT */
mqtt.onConnect([]()
/* Subscribe topic and receive message at topic /qos0 */
mqtt.subscribe("/qos0", 0)
/* Begin to transfer data with broker MQTT at url
 * mqtt://test.mosquitto.org port 1883
 */
mqtt.begin("mqtt://test.mosquitto.org:1883")
/* Function called inside loop() to initialize MQTT,
 * check and process data from topics, check attributes
 * of prototypes such as keep-a-live, QoS...
 */
mqtt.handle();

/* Functions of PubSubClient library */
/* Declare PubSubClient variable espClient */
PubSubClient client(espClient);
/* Publish data pack "Connected!" to topic ESP8266 */
client.publish("ESP8266", "Connected!");
/* Subscribe to receive messages from topic ESP8266 */
client.subscribe("ESP8266");
/* Set up server to listen client at port 1883 */
client.setServer(url_server, 1883);
/* Callback function to publish/subscribe */
client.setCallback(callback);
/* Function called inside loop() to initialize MQTT,
 * check and process data from topics, check attributes
 * of prototypes such as keep-a-live, QoS data pack...
 */
client.loop();</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_c_cheatsheet">C - Cheatsheet</h2>
<div class="sectionbody">
<table class="tableblock frame-none grid-none spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* BASIC STRUCTURE */
Comment on one line using //
 ex: x++ ; // increase x by 1
/* */ Comment on multiple lines.
ex : /************************
      *      Comment on      *
      *     multiple lines   *
      ************************/
/* PROGRAM STRUCTURE */

#include &lt;stdio.h&gt; // include the C standard library
#include "iLib.h"  // include user’s library
int global_var;    // global variable
/* Declare begin function, return type is integer.
 * Attribute arg of type integer
 */
int main (int arg){
 float local_var ; // Local variable for main function
 Statement 1
 ...
 Statement n ;
return 0; //program successfully run then return
}

/*DATA TYPE AND RANGE */
boolean       true | false
char          -128         -  127, 'a' '$' etc.
unsigned char 0            -  255
byte          0            -  255
int           -32768       -  32767
unsigned int  0            -  65535
word          0            -  65535
long          -2147483648  -  2147483647
unsigned long 0            -  4294967295
float         -3.4028e+38  -  3.4028e+38
double        -3.4028e+38  -  3.4028e+38
void          i.e., no return value

/* VARIABLE NAMING */
/* Correct naming */
int x;            // A variable
int x = 1;        // Variable declared and initialized
float x, y, z;    // Multiple variables with float type
const int x = 88; // Constant variable, can not override
int tenBien1ok;   // Correct naming
int ten_bien_nay_ok;
/* Incorrect naming */

int 2001_tensai;
int ten-sai;      // '-' is not alphanumberic
int while;        // Wrong, using keyword while

/* CONSTANTS AND DATA TYPES */
123     Decimal number
0b0111  Binary number
0173    Octal - base 8</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">0x7B    Hexal - base 16
123U    Unsigned integer
123L    Signed integer 4 bytes
123UL   Unsigned integer 4bytes
123.0   Real number
1.23e6  Real number with exponential
ex: 1.23*10^3 = 1230
/* Define integer constant a, with value 1 */
const int a = 1;
/* Define float constant x, with value 4.0 */
const float x = 4;
/* Define integer constant c with value 49 */
const c = ‘1’;
/* Define str  as a pointer constant, pointed to string
 * “Cheasheet C”
 */
const char * str = “Cheasheet C”;

/* VARIABLE DECLAREATION */
/* Declare integer variable a without assign value */
int a;
/* Declare binary variable a, base8 b, integer c,
 * integer without assign value d
 */
int a = 0b01111011, b = 0123, c = 1, d;
/* Declare float variable fa */
float fa = 1.0f;
/* Declare double variable da */
double da = 1.0;
/* Declare pointer variable point to an undefined memory
 * address.
 */
char *pointer;
/* Declare pointer variable pointed to NULL (0) */
char *other_pointer = NULL;

/* CHARACTERS */
/* String include the end of string character \0 (null) */
char str1[8] = {'A','r','d','u','i','n','o','\0'};
/* Compiler automatically add the character \0 to the
 * end.
 */
char str2[8] = {'A','r','d','u','i','n','o'};
/* String declaration, without the number of children
 * and assign the value
 */
char str3[] = "Arduino";
/* Declare and assign the value for string */
char str4[8] = "Arduino";
/* Common functions to process string of characters ?
/* Connect source string to the end of dest string */
strcat(dest, source)
/* Find the position of first c in source, return
 * pointer to c or null if there is no c in source
 */
strchr(source, c)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">strlen(st)
/* Copy and replace characters of source into dest */
strcpy(dest, source)
/* Copy characters from begin to n from source to dest*/
strncpy(dest, source, n)

/* ARRAY */
/* Declare an array of integer with 6 children and
 * assign values for each
 */
int myPins[] = {2, 4, 8, 3, 6};
/* integer array of 6 children without values
 * assignment
 */
int myInts[6];
/* Assign the value of 42 for the first child */
myInts[0] = 42;
/* FAILED ! array index is only from 0 to 5 */
myInts[6] = 12;
/* Get the value of 3rd child in myInts array */
int c = myInts[2]; // Can use *(myInts + 2)
/* Get the address of 3rd child in myInts array */
int c = &amp;myInts[2]; // Can use c = myInts + int
/* Return the length of myInts array */
int length = sizeof(myInts) / sizeof(myInts[0]);
/* Declare 2 float arrays, arr1 has 5 children,
 * arr2 has 10
 */
float arr1[5], arr2[10];
/* Declare integer array has 2 rows and 5 columns.
 * Totally, 10 children
 */
int a[2][5];

/* CODE BLOCK AND LOOP'S COMMANDS */
{} // Include a block of code, usually used in functions

/* Goto : programs jump to the label (label must be
 * included in goto command)
 */
goto label;

/* Continue : Only used in loops. Program jump to the
 * next cycle of the most deep loop
 */
continue;

/* Break : Used to quit the most deep loop, or use with
 * switch..case loop to quit the corresponding case
 */
break;

/* Return */
/* Used for void functions */
return;

/* Value can be a constant, a variable, a formula, or
 * call to an other method which returns the value
 */
return &lt;value&gt;;

/* CONDITIONAL STATEMENTS */
if (x &lt; 5)      // execute if x&lt;5
 { code }
else if (x &gt; 10)// execute if x&gt;10</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">	{ code }
else { code }   // execute in other cases
/* execute the case which match the value of var */
switch (var) {
case 1:
...
break;
case 2:
...
break;
default:
...
}

/* LOOPS */
/* While: Execute if x&lt;5 */
while (x &lt; 5) { code };
/* Do-While : Execute code, evaluate, if x&lt;0 continue
 * the code
 */
do { code } while(x &lt; 0);
/* for : Initialize i, execute code then increase i
 * if i &lt; 10
 */
for (int i = 0; i &lt; 10; i++) { code };

/* OPERATOS, OPERATIONS */
/* Popular operators */
=   assignment operator
+   addition operator
-   subtraction operator
*   multiply operator
/   division operator
%   modulus operator
==  equality operator
!=  inequality operator (different)
&lt;   less than operator
&gt;   greater than operator
&lt;=  less or equal operator
&gt;=  greater or equal operator &amp;&amp;  logical AND operator (AND)
||  logical OR operator (OR)
!   logical NOT operator (NOT)

/* Compound assignment operators */
++ increment operator
-- subtraction operator
+= addition assignment operator
   ex: x = 5; x+= 1; //x = 6
-= subtraction assignment operator
   ex: x = 5; x-= 1; //x = 4
*= multiplication assignment operator
   ex: x = 5; x*= 3; //x = 15
/= division assignment operator
   ex: x = 6; x/= 2; //x = 3
&amp;= logical AND assignment operator
   ex: x = 0b1010; x&amp;= 0110; //x =0b0010
|= logical OR assignment operator
   ex: x = 0b1010; x&amp;= 0110; //x =0b1110

/* Bitwise operators */
&amp;   and          ^   xor
&lt;&lt;  bitwise left shift
&gt;&gt;  bitwise right shift
|  or           ~   not

/* POINTER OPERATORS */</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">&amp;reference:  // address-of
*dereference:// value-of
/* declare a pointer variable points to variable a */
int a = 5; int *pointer = &amp;a;

/* CONTROLLING CHARACTERS AND SPECIAL CHARACTERS */
\n  Jump to the first column of the next line
\t  Jump to the next horizontal tab
\r  Jump to the start to current line
\a  Bip
\\  Print out the \ character
\"  Print out the " character
\'  Print out the ' character
%%: Print out the % character
\b ~ backspace (delete the right before character)

/* FUNCTIONS AND RELATED PROBLEMS */

/* Declare prototype of max function, which has 2
 * integer input parameter a and b, it's return type is
 * also integer
 */
int max(int a, int b);

/* Declare the variable c, which is the return value of
 * max function
 */
int c = max(5,4);

/* Declare prototype of non-parameter, non-return
 * function (void)
 */
void none();

/* TYPEDEF- Definition of data type */
/* Define the type of unsigned char is BYTE, declare
 * BYTE type variables a, b
 */
typedef unsigned char BYTE;  BYTE  a, b;

/* LIST DATA TYPE - ENUMERATION (enum) */
/* Declare enum data type weekdays */
enum daysOfWeek { sunday, monday, tuesday, wednesday };
/* Declare the variable toDay belongs to daysOfWeek data
 * type and assign the value
 */
daysOfWeek toDay = wednesday;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">/* STRUCT - DATA TYPE DEFINED BY USER */
/* Define struct student */
struct student{
  char studentName;
  char studentID;
  int studentAge;
};
/* Access to the parameter studentID in student struct*/
student.studentID;
/* Rename the struct student to a variable named
 * STUDENT.
 */
typedef struct student STUDENT;
STUDENT studentA;

/* FILE PROCESSING COMMANDS (#include &lt;stdio.h&gt;) */
/* Declare a pointer variable is a file path */
const char *filePath = "file/path/document.txt";
/* Declare a pointer variable of FILE type */
FILE *file;
/* Open a file at filePath and read the data */
file = fopen(filePath, "r");// Return NULL if failed
/* Close the opened file, return 0 if success,
 * otherwise return EOF
 */
fclose(file);
/* Write the c character onto opening file, return OEF
 * if failed, return ASCII code of c if success
 */
int fputc(int c, FILE *f);
/* Write the string "hello" onto opening file */
int c = fputs("hello", file);
/* Read (255-1) characters on opening file, the result
 * will be saved into str array, reading process will
 * be closed if meet the '\n' or EOL character
 */
fgets(str, 255, file);
/* Change the position of cursor in file, internal file
 * position indicator jump to the starting point of file
 */
int fseek(file, 0, SEEK_SET);
/* Return the size of file's content */
ftell(file);</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="https://www.cheatography.com/ashlyn-black/cheat-sheets/c-reference/" class="bare">www.cheatography.com/ashlyn-black/cheat-sheets/c-reference/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_ending">The ending</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contributors">Contributors.</h3>
<div class="paragraph">
<p>To complete the content of the book also contributed by the following members:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://twitter.com/tuanpmt">Phạm Minh Tuấn (TuanPM)</a></p>
</li>
<li>
<p><a href="https://github.com/lamnhatquan">Lâm Nhật Quân</a></p>
</li>
<li>
<p><a href="https://github.com/trinhduc">Trịnh Hoàng Đức</a></p>
</li>
<li>
<p>Lê Phương Trình - Internship at IoT Maker Vietnam - Telecommunications electronics, Ho Chi Minh City University of Technology University, course 2014.</p>
</li>
<li>
<p>Trần Phúc Vinh - Internship at IoT Maker Vietnam - Electrical engineering, Ho Chi Minh City University of Technology University, course 2014.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And translated to English group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trần Thiên Hoàng, from Electrical Engineering, International University.</p>
</li>
<li>
<p>Lương Hoàng Thiện, from Telecommunications engineering, Ho Chi Minh City University of Technology.</p>
</li>
<li>
<p><a href="https://github.com/duchieu1307">Đức Hiếu</a>, manager at <a href="https://www.facebook.com/NguyenPhongIOT/">NguyenPhong IOT</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And use the community contributions at <a href="https://arduino.esp8266.vn" class="bare">arduino.esp8266.vn</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_thank_you">Thank you</h3>
<div class="paragraph">
<p>Glad you went with us to the end of this book. The purpose of the book is to help beginners learn about <code>Internet Of Things (IoT)</code> with the basic knowledge and precise effectioncy to study IoT more quickly. Hope the book will come to hand many of you are passionate about the new but very potential technology. Wish you success on the road that you have chosen.</p>
</div>
<div class="paragraph">
<p>Although tried to finish the best content for the book, however, inevitably the shortcomings. Any suggestions for opening issues at: <a href="https://github.com/tuanpmt/iot-for-beginners-book" class="bare">github.com/tuanpmt/iot-for-beginners-book</a></p>
</div>
<div class="paragraph">
<p>Some websites contribute to the community (wish to receive your contribution and contribution to the community of IoT Vietnam in particular as well as the technical community is developing more):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. About ESP8266 with Arduino: <a href="https://arduino.esp8266.vn/" class="bare">arduino.esp8266.vn/</a></p>
</li>
<li>
<p>2. About ESP32: <a href="https://esp32.vn" class="bare">esp32.vn</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_license_to_use_documents">License to use documents.</h3>
<div class="paragraph">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="bare">creativecommons.org/licenses/by-nc-sa/4.0/</a></p>
</div>
<div class="imageblock center" style="text-align: center">
<div class="content">
<img src="images/contributions/Cc-by-nc-sa_icon.svg" alt="Cc by nc sa icon" width="200">
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-01-02 14:33:15 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>